diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/.DS_Store b/packages/official-plugins/comfyui/src/local_overrides/comfyui/.DS_Store
deleted file mode 100644
index b459f51..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/.DS_Store and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/.git b/packages/official-plugins/comfyui/src/comfyui/.git
index afdcb42..17fd3ee 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/.git
+++ b/packages/official-plugins/comfyui/src/comfyui/.git
@@ -1 +1 @@
-gitdir: ../../../.git/modules/sidecars/comfyui/comfyui
+gitdir: ../../../../../.git/modules/packages/official-plugins/comfyui/src/comfyui
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/README.md b/packages/official-plugins/comfyui/src/comfyui/README.md
index bae955b..b0f6269 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/README.md
+++ b/packages/official-plugins/comfyui/src/comfyui/README.md
@@ -119,6 +119,9 @@ ComfyUI follows a weekly release cycle targeting Monday but this regularly chang
 
 1. **[ComfyUI Core](https://github.com/comfyanonymous/ComfyUI)**
    - Releases a new stable version (e.g., v0.7.0) roughly every week.
+   - Starting from v0.4.0 patch versions will be used for fixes backported onto the current stable release.
+   - Minor versions will be used for releases off the master branch.
+   - Patch versions may still be used for releases on the master branch in cases where a backport would not make sense.
    - Commits outside of the stable release tags may be very unstable and break many custom nodes.
    - Serves as the foundation for the desktop release
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/context_windows.py b/packages/official-plugins/comfyui/src/comfyui/comfy/context_windows.py
index 2979b3c..1e0f860 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/context_windows.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/context_windows.py
@@ -143,7 +143,7 @@ class IndexListContextHandler(ContextHandlerABC):
         # if multiple conds, split based on primary region
         if self.split_conds_to_windows and len(cond_in) > 1:
             region = window.get_region_index(len(cond_in))
-            logging.info(f"Splitting conds to windows; using region {region} for window {window[0]}-{window[-1]} with center ratio {window.center_ratio:.3f}")
+            logging.info(f"Splitting conds to windows; using region {region} for window {window.index_list[0]}-{window.index_list[-1]} with center ratio {window.center_ratio:.3f}")
             cond_in = [cond_in[region]]
         # cond object is a list containing a dict - outer list is irrelevant, so just loop through it
         for actual_cond in cond_in:
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/lumina/model.py b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/lumina/model.py
index 5628e2b..e80b1c1 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/lumina/model.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/lumina/model.py
@@ -625,7 +625,7 @@ class NextDiT(nn.Module):
             if pooled is not None:
                 pooled = self.clip_text_pooled_proj(pooled)
             else:
-                pooled = torch.zeros((1, self.clip_text_dim), device=x.device, dtype=x.dtype)
+                pooled = torch.zeros((x.shape[0], self.clip_text_dim), device=x.device, dtype=x.dtype)
 
             adaln_input = self.time_text_embed(torch.cat((t, pooled), dim=-1))
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/qwen_image/model.py b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/qwen_image/model.py
index 902af30..00c5975 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/qwen_image/model.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/qwen_image/model.py
@@ -61,7 +61,7 @@ def apply_rotary_emb(x, freqs_cis):
 
 
 class QwenTimestepProjEmbeddings(nn.Module):
-    def __init__(self, embedding_dim, pooled_projection_dim, dtype=None, device=None, operations=None):
+    def __init__(self, embedding_dim, pooled_projection_dim, use_additional_t_cond=False, dtype=None, device=None, operations=None):
         super().__init__()
         self.time_proj = Timesteps(num_channels=256, flip_sin_to_cos=True, downscale_freq_shift=0, scale=1000)
         self.timestep_embedder = TimestepEmbedding(
@@ -72,9 +72,19 @@ class QwenTimestepProjEmbeddings(nn.Module):
             operations=operations
         )
 
-    def forward(self, timestep, hidden_states):
+        self.use_additional_t_cond = use_additional_t_cond
+        if self.use_additional_t_cond:
+            self.addition_t_embedding = operations.Embedding(2, embedding_dim, device=device, dtype=dtype)
+
+    def forward(self, timestep, hidden_states, addition_t_cond=None):
         timesteps_proj = self.time_proj(timestep)
         timesteps_emb = self.timestep_embedder(timesteps_proj.to(dtype=hidden_states.dtype))
+
+        if self.use_additional_t_cond:
+            if addition_t_cond is None:
+                addition_t_cond = torch.zeros((timesteps_emb.shape[0]), device=timesteps_emb.device, dtype=torch.long)
+            timesteps_emb += self.addition_t_embedding(addition_t_cond, out_dtype=timesteps_emb.dtype)
+
         return timesteps_emb
 
 
@@ -320,11 +330,11 @@ class QwenImageTransformer2DModel(nn.Module):
         num_attention_heads: int = 24,
         joint_attention_dim: int = 3584,
         pooled_projection_dim: int = 768,
-        guidance_embeds: bool = False,
         axes_dims_rope: Tuple[int, int, int] = (16, 56, 56),
         default_ref_method="index",
         image_model=None,
         final_layer=True,
+        use_additional_t_cond=False,
         dtype=None,
         device=None,
         operations=None,
@@ -342,6 +352,7 @@ class QwenImageTransformer2DModel(nn.Module):
         self.time_text_embed = QwenTimestepProjEmbeddings(
             embedding_dim=self.inner_dim,
             pooled_projection_dim=pooled_projection_dim,
+            use_additional_t_cond=use_additional_t_cond,
             dtype=dtype,
             device=device,
             operations=operations
@@ -375,27 +386,33 @@ class QwenImageTransformer2DModel(nn.Module):
         patch_size = self.patch_size
         hidden_states = comfy.ldm.common_dit.pad_to_patch_size(x, (1, self.patch_size, self.patch_size))
         orig_shape = hidden_states.shape
-        hidden_states = hidden_states.view(orig_shape[0], orig_shape[1], orig_shape[-2] // 2, 2, orig_shape[-1] // 2, 2)
-        hidden_states = hidden_states.permute(0, 2, 4, 1, 3, 5)
-        hidden_states = hidden_states.reshape(orig_shape[0], (orig_shape[-2] // 2) * (orig_shape[-1] // 2), orig_shape[1] * 4)
+        hidden_states = hidden_states.view(orig_shape[0], orig_shape[1], orig_shape[-3], orig_shape[-2] // 2, 2, orig_shape[-1] // 2, 2)
+        hidden_states = hidden_states.permute(0, 2, 3, 5, 1, 4, 6)
+        hidden_states = hidden_states.reshape(orig_shape[0], orig_shape[-3] * (orig_shape[-2] // 2) * (orig_shape[-1] // 2), orig_shape[1] * 4)
+        t_len = t
         h_len = ((h + (patch_size // 2)) // patch_size)
         w_len = ((w + (patch_size // 2)) // patch_size)
 
         h_offset = ((h_offset + (patch_size // 2)) // patch_size)
         w_offset = ((w_offset + (patch_size // 2)) // patch_size)
 
-        img_ids = torch.zeros((h_len, w_len, 3), device=x.device)
-        img_ids[:, :, 0] = img_ids[:, :, 1] + index
-        img_ids[:, :, 1] = img_ids[:, :, 1] + torch.linspace(h_offset, h_len - 1 + h_offset, steps=h_len, device=x.device, dtype=x.dtype).unsqueeze(1) - (h_len // 2)
-        img_ids[:, :, 2] = img_ids[:, :, 2] + torch.linspace(w_offset, w_len - 1 + w_offset, steps=w_len, device=x.device, dtype=x.dtype).unsqueeze(0) - (w_len // 2)
-        return hidden_states, repeat(img_ids, "h w c -> b (h w) c", b=bs), orig_shape
+        img_ids = torch.zeros((t_len, h_len, w_len, 3), device=x.device)
+
+        if t_len > 1:
+            img_ids[:, :, :, 0] = img_ids[:, :, :, 0] + torch.linspace(0, t_len - 1, steps=t_len, device=x.device, dtype=x.dtype).unsqueeze(1).unsqueeze(1)
+        else:
+            img_ids[:, :, :, 0] = img_ids[:, :, :, 0] + index
+
+        img_ids[:, :, :, 1] = img_ids[:, :, :, 1] + torch.linspace(h_offset, h_len - 1 + h_offset, steps=h_len, device=x.device, dtype=x.dtype).unsqueeze(1).unsqueeze(0) - (h_len // 2)
+        img_ids[:, :, :, 2] = img_ids[:, :, :, 2] + torch.linspace(w_offset, w_len - 1 + w_offset, steps=w_len, device=x.device, dtype=x.dtype).unsqueeze(0).unsqueeze(0) - (w_len // 2)
+        return hidden_states, repeat(img_ids, "t h w c -> b (t h w) c", b=bs), orig_shape
 
-    def forward(self, x, timestep, context, attention_mask=None, guidance=None, ref_latents=None, transformer_options={}, **kwargs):
+    def forward(self, x, timestep, context, attention_mask=None, ref_latents=None, additional_t_cond=None, transformer_options={}, **kwargs):
         return comfy.patcher_extension.WrapperExecutor.new_class_executor(
             self._forward,
             self,
             comfy.patcher_extension.get_all_wrappers(comfy.patcher_extension.WrappersMP.DIFFUSION_MODEL, transformer_options)
-        ).execute(x, timestep, context, attention_mask, guidance, ref_latents, transformer_options, **kwargs)
+        ).execute(x, timestep, context, attention_mask, ref_latents, additional_t_cond, transformer_options, **kwargs)
 
     def _forward(
         self,
@@ -403,8 +420,8 @@ class QwenImageTransformer2DModel(nn.Module):
         timesteps,
         context,
         attention_mask=None,
-        guidance: torch.Tensor = None,
         ref_latents=None,
+        additional_t_cond=None,
         transformer_options={},
         control=None,
         **kwargs
@@ -423,12 +440,17 @@ class QwenImageTransformer2DModel(nn.Module):
             index = 0
             ref_method = kwargs.get("ref_latents_method", self.default_ref_method)
             index_ref_method = (ref_method == "index") or (ref_method == "index_timestep_zero")
+            negative_ref_method = ref_method == "negative_index"
             timestep_zero = ref_method == "index_timestep_zero"
             for ref in ref_latents:
                 if index_ref_method:
                     index += 1
                     h_offset = 0
                     w_offset = 0
+                elif negative_ref_method:
+                    index -= 1
+                    h_offset = 0
+                    w_offset = 0
                 else:
                     index = 1
                     h_offset = 0
@@ -458,14 +480,7 @@ class QwenImageTransformer2DModel(nn.Module):
         encoder_hidden_states = self.txt_norm(encoder_hidden_states)
         encoder_hidden_states = self.txt_in(encoder_hidden_states)
 
-        if guidance is not None:
-            guidance = guidance * 1000
-
-        temb = (
-            self.time_text_embed(timestep, hidden_states)
-            if guidance is None
-            else self.time_text_embed(timestep, guidance, hidden_states)
-        )
+        temb = self.time_text_embed(timestep, hidden_states, additional_t_cond)
 
         patches_replace = transformer_options.get("patches_replace", {})
         patches = transformer_options.get("patches", {})
@@ -513,6 +528,6 @@ class QwenImageTransformer2DModel(nn.Module):
         hidden_states = self.norm_out(hidden_states, temb)
         hidden_states = self.proj_out(hidden_states)
 
-        hidden_states = hidden_states[:, :num_embeds].view(orig_shape[0], orig_shape[-2] // 2, orig_shape[-1] // 2, orig_shape[1], 2, 2)
-        hidden_states = hidden_states.permute(0, 3, 1, 4, 2, 5)
+        hidden_states = hidden_states[:, :num_embeds].view(orig_shape[0], orig_shape[-3], orig_shape[-2] // 2, orig_shape[-1] // 2, orig_shape[1], 2, 2)
+        hidden_states = hidden_states.permute(0, 4, 1, 2, 5, 3, 6)
         return hidden_states.reshape(orig_shape)[:, :, :, :x.shape[-2], :x.shape[-1]]
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/wan/vae.py b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/wan/vae.py
index ccbb258..08315f1 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/ldm/wan/vae.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/ldm/wan/vae.py
@@ -227,6 +227,7 @@ class Encoder3d(nn.Module):
     def __init__(self,
                  dim=128,
                  z_dim=4,
+                 input_channels=3,
                  dim_mult=[1, 2, 4, 4],
                  num_res_blocks=2,
                  attn_scales=[],
@@ -245,7 +246,7 @@ class Encoder3d(nn.Module):
         scale = 1.0
 
         # init block
-        self.conv1 = CausalConv3d(3, dims[0], 3, padding=1)
+        self.conv1 = CausalConv3d(input_channels, dims[0], 3, padding=1)
 
         # downsample blocks
         downsamples = []
@@ -331,6 +332,7 @@ class Decoder3d(nn.Module):
     def __init__(self,
                  dim=128,
                  z_dim=4,
+                 output_channels=3,
                  dim_mult=[1, 2, 4, 4],
                  num_res_blocks=2,
                  attn_scales=[],
@@ -378,7 +380,7 @@ class Decoder3d(nn.Module):
         # output blocks
         self.head = nn.Sequential(
             RMS_norm(out_dim, images=False), nn.SiLU(),
-            CausalConv3d(out_dim, 3, 3, padding=1))
+            CausalConv3d(out_dim, output_channels, 3, padding=1))
 
     def forward(self, x, feat_cache=None, feat_idx=[0]):
         ## conv1
@@ -449,6 +451,7 @@ class WanVAE(nn.Module):
                  num_res_blocks=2,
                  attn_scales=[],
                  temperal_downsample=[True, True, False],
+                 image_channels=3,
                  dropout=0.0):
         super().__init__()
         self.dim = dim
@@ -460,11 +463,11 @@ class WanVAE(nn.Module):
         self.temperal_upsample = temperal_downsample[::-1]
 
         # modules
-        self.encoder = Encoder3d(dim, z_dim * 2, dim_mult, num_res_blocks,
+        self.encoder = Encoder3d(dim, z_dim * 2, image_channels, dim_mult, num_res_blocks,
                                  attn_scales, self.temperal_downsample, dropout)
         self.conv1 = CausalConv3d(z_dim * 2, z_dim * 2, 1)
         self.conv2 = CausalConv3d(z_dim, z_dim, 1)
-        self.decoder = Decoder3d(dim, z_dim, dim_mult, num_res_blocks,
+        self.decoder = Decoder3d(dim, z_dim, image_channels, dim_mult, num_res_blocks,
                                  attn_scales, self.temperal_upsample, dropout)
 
     def encode(self, x):
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_base.py b/packages/official-plugins/comfyui/src/comfyui/comfy/model_base.py
index 6b8a845..c4f3c06 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_base.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/model_base.py
@@ -1110,7 +1110,7 @@ class Lumina2(BaseModel):
             if 'num_tokens' not in out:
                 out['num_tokens'] = comfy.conds.CONDConstant(cross_attn.shape[1])
 
-        clip_text_pooled = kwargs["pooled_output"]  # Newbie
+        clip_text_pooled = kwargs.get("pooled_output", None)  # NewBie
         if clip_text_pooled is not None:
             out['clip_text_pooled'] = comfy.conds.CONDRegular(clip_text_pooled)
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_detection.py b/packages/official-plugins/comfyui/src/comfyui/comfy/model_detection.py
index 7148c77..539e296 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_detection.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/model_detection.py
@@ -430,8 +430,9 @@ def detect_unet_config(state_dict, key_prefix, metadata=None):
             dit_config["rope_theta"] = 10000.0
             dit_config["ffn_dim_multiplier"] = 4.0
             ctd_weight = state_dict.get('{}clip_text_pooled_proj.0.weight'.format(key_prefix), None)
-            if ctd_weight is not None:
+            if ctd_weight is not None:  # NewBie
                 dit_config["clip_text_dim"] = ctd_weight.shape[0]
+                # NewBie also sets axes_lens = [1024, 512, 512] but it's not used in ComfyUI
         elif dit_config["dim"] == 3840:  # Z image
             dit_config["n_heads"] = 30
             dit_config["n_kv_heads"] = 30
@@ -620,6 +621,9 @@ def detect_unet_config(state_dict, key_prefix, metadata=None):
         dit_config["num_layers"] = count_blocks(state_dict_keys, '{}transformer_blocks.'.format(key_prefix) + '{}.')
         if "{}__index_timestep_zero__".format(key_prefix) in state_dict_keys:  # 2511
             dit_config["default_ref_method"] = "index_timestep_zero"
+        if "{}time_text_embed.addition_t_embedding.weight".format(key_prefix) in state_dict_keys:  # Layered
+            dit_config["use_additional_t_cond"] = True
+            dit_config["default_ref_method"] = "negative_index"
         return dit_config
 
     if '{}visual_transformer_blocks.0.cross_attention.key_norm.weight'.format(key_prefix) in state_dict_keys: # Kandinsky 5
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_management.py b/packages/official-plugins/comfyui/src/comfyui/comfy/model_management.py
index 40717b1..1889ab0 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/model_management.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/model_management.py
@@ -26,6 +26,7 @@ import importlib
 import platform
 import weakref
 import gc
+import os
 
 class VRAMState(Enum):
     DISABLED = 0    #No vram present: no need to move models to vram
@@ -333,13 +334,15 @@ except:
 SUPPORT_FP8_OPS = args.supports_fp8_compute
 
 AMD_RDNA2_AND_OLDER_ARCH = ["gfx1030", "gfx1031", "gfx1010", "gfx1011", "gfx1012", "gfx906", "gfx900", "gfx803"]
+AMD_ENABLE_MIOPEN_ENV = 'COMFYUI_ENABLE_MIOPEN'
 
 try:
     if is_amd():
         arch = torch.cuda.get_device_properties(get_torch_device()).gcnArchName
         if not (any((a in arch) for a in AMD_RDNA2_AND_OLDER_ARCH)):
-            torch.backends.cudnn.enabled = False  # Seems to improve things a lot on AMD
-            logging.info("Set: torch.backends.cudnn.enabled = False for better AMD performance.")
+            if os.getenv(AMD_ENABLE_MIOPEN_ENV) != '1':
+                torch.backends.cudnn.enabled = False  # Seems to improve things a lot on AMD
+                logging.info("Set: torch.backends.cudnn.enabled = False for better AMD performance.")
 
         try:
             rocm_version = tuple(map(int, str(torch.version.hip).split(".")[:2]))
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sampler_helpers.py b/packages/official-plugins/comfyui/src/comfyui/comfy/sampler_helpers.py
index e46971a..9134e6d 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sampler_helpers.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/sampler_helpers.py
@@ -122,20 +122,20 @@ def estimate_memory(model, noise_shape, conds):
     minimum_memory_required = model.model.memory_required([noise_shape[0]] + list(noise_shape[1:]), cond_shapes=cond_shapes_min)
     return memory_required, minimum_memory_required
 
-def prepare_sampling(model: ModelPatcher, noise_shape, conds, model_options=None):
+def prepare_sampling(model: ModelPatcher, noise_shape, conds, model_options=None, force_full_load=False):
     executor = comfy.patcher_extension.WrapperExecutor.new_executor(
         _prepare_sampling,
         comfy.patcher_extension.get_all_wrappers(comfy.patcher_extension.WrappersMP.PREPARE_SAMPLING, model_options, is_model_options=True)
     )
-    return executor.execute(model, noise_shape, conds, model_options=model_options)
+    return executor.execute(model, noise_shape, conds, model_options=model_options, force_full_load=force_full_load)
 
-def _prepare_sampling(model: ModelPatcher, noise_shape, conds, model_options=None):
+def _prepare_sampling(model: ModelPatcher, noise_shape, conds, model_options=None, force_full_load=False):
     real_model: BaseModel = None
     models, inference_memory = get_additional_models(conds, model.model_dtype())
     models += get_additional_models_from_model_options(model_options)
     models += model.get_nested_additional_models()  # TODO: does this require inference_memory update?
     memory_required, minimum_memory_required = estimate_memory(model, noise_shape, conds)
-    comfy.model_management.load_models_gpu([model] + models, memory_required=memory_required + inference_memory, minimum_memory_required=minimum_memory_required + inference_memory)
+    comfy.model_management.load_models_gpu([model] + models, memory_required=memory_required + inference_memory, minimum_memory_required=minimum_memory_required + inference_memory, force_full_load=force_full_load)
     real_model = model.model
 
     return real_model, conds, models
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/samplers.py b/packages/official-plugins/comfyui/src/comfyui/comfy/samplers.py
index 8340d37..1989ef1 100755
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/samplers.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/samplers.py
@@ -984,9 +984,6 @@ class CFGGuider:
         self.inner_model, self.conds, self.loaded_models = comfy.sampler_helpers.prepare_sampling(self.model_patcher, noise.shape, self.conds, self.model_options)
         device = self.model_patcher.load_device
 
-        if denoise_mask is not None:
-            denoise_mask = comfy.sampler_helpers.prepare_mask(denoise_mask, noise.shape, device)
-
         noise = noise.to(device)
         latent_image = latent_image.to(device)
         sigmas = sigmas.to(device)
@@ -1013,6 +1010,24 @@ class CFGGuider:
         else:
             latent_shapes = [latent_image.shape]
 
+        if denoise_mask is not None:
+            if denoise_mask.is_nested:
+                denoise_masks = denoise_mask.unbind()
+                denoise_masks = denoise_masks[:len(latent_shapes)]
+            else:
+                denoise_masks = [denoise_mask]
+
+            for i in range(len(denoise_masks), len(latent_shapes)):
+                denoise_masks.append(torch.ones(latent_shapes[i]))
+
+            for i in range(len(denoise_masks)):
+                denoise_masks[i] = comfy.sampler_helpers.prepare_mask(denoise_masks[i], latent_shapes[i], self.model_patcher.load_device)
+
+            if len(denoise_masks) > 1:
+                denoise_mask, _ = comfy.utils.pack_latents(denoise_masks)
+            else:
+                denoise_mask = denoise_masks[0]
+
         self.conds = {}
         for k in self.original_conds:
             self.conds[k] = list(map(lambda a: a.copy(), self.original_conds[k]))
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sd.py b/packages/official-plugins/comfyui/src/comfyui/comfy/sd.py
index 1cad98a..7de7dd9 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sd.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/sd.py
@@ -55,6 +55,8 @@ import comfy.text_encoders.hunyuan_image
 import comfy.text_encoders.z_image
 import comfy.text_encoders.ovis
 import comfy.text_encoders.kandinsky5
+import comfy.text_encoders.jina_clip_2
+import comfy.text_encoders.newbie
 
 import comfy.model_patcher
 import comfy.lora
@@ -321,6 +323,7 @@ class VAE:
         self.latent_channels = 4
         self.latent_dim = 2
         self.output_channels = 3
+        self.pad_channel_value = None
         self.process_input = lambda image: image * 2.0 - 1.0
         self.process_output = lambda image: torch.clamp((image + 1.0) / 2.0, min=0.0, max=1.0)
         self.working_dtypes = [torch.bfloat16, torch.float32]
@@ -435,6 +438,7 @@ class VAE:
                 self.memory_used_decode = lambda shape, dtype: (1000 * shape[2] * 2048) * model_management.dtype_size(dtype)
                 self.latent_channels = 64
                 self.output_channels = 2
+                self.pad_channel_value = "replicate"
                 self.upscale_ratio = 2048
                 self.downscale_ratio =  2048
                 self.latent_dim = 1
@@ -546,7 +550,9 @@ class VAE:
                     self.downscale_index_formula = (4, 8, 8)
                     self.latent_dim = 3
                     self.latent_channels = 16
-                    ddconfig = {"dim": dim, "z_dim": self.latent_channels, "dim_mult": [1, 2, 4, 4], "num_res_blocks": 2, "attn_scales": [], "temperal_downsample": [False, True, True], "dropout": 0.0}
+                    self.output_channels = sd["encoder.conv1.weight"].shape[1]
+                    self.pad_channel_value = 1.0
+                    ddconfig = {"dim": dim, "z_dim": self.latent_channels, "dim_mult": [1, 2, 4, 4], "num_res_blocks": 2, "attn_scales": [], "temperal_downsample": [False, True, True], "image_channels": self.output_channels, "dropout": 0.0}
                     self.first_stage_model = comfy.ldm.wan.vae.WanVAE(**ddconfig)
                     self.working_dtypes = [torch.bfloat16, torch.float16, torch.float32]
                     self.memory_used_encode = lambda shape, dtype: (1500 if shape[2]<=4 else 6000) * shape[3] * shape[4] * model_management.dtype_size(dtype)
@@ -582,6 +588,7 @@ class VAE:
                 self.memory_used_decode = lambda shape, dtype: (shape[2] * shape[3] * 87000) * model_management.dtype_size(dtype)
                 self.latent_channels = 8
                 self.output_channels = 2
+                self.pad_channel_value = "replicate"
                 self.upscale_ratio = 4096
                 self.downscale_ratio = 4096
                 self.latent_dim = 2
@@ -690,17 +697,28 @@ class VAE:
             raise RuntimeError("ERROR: VAE is invalid: None\n\nIf the VAE is from a checkpoint loader node your checkpoint does not contain a valid VAE.")
 
     def vae_encode_crop_pixels(self, pixels):
-        if not self.crop_input:
-            return pixels
-
-        downscale_ratio = self.spacial_compression_encode()
+        if self.crop_input:
+            downscale_ratio = self.spacial_compression_encode()
+
+            dims = pixels.shape[1:-1]
+            for d in range(len(dims)):
+                x = (dims[d] // downscale_ratio) * downscale_ratio
+                x_offset = (dims[d] % downscale_ratio) // 2
+                if x != dims[d]:
+                    pixels = pixels.narrow(d + 1, x_offset, x)
+
+        if pixels.shape[-1] > self.output_channels:
+            pixels = pixels[..., :self.output_channels]
+        elif pixels.shape[-1] < self.output_channels:
+            if self.pad_channel_value is not None:
+                if isinstance(self.pad_channel_value, str):
+                    mode = self.pad_channel_value
+                    value = None
+                else:
+                    mode = "constant"
+                    value = self.pad_channel_value
 
-        dims = pixels.shape[1:-1]
-        for d in range(len(dims)):
-            x = (dims[d] // downscale_ratio) * downscale_ratio
-            x_offset = (dims[d] % downscale_ratio) // 2
-            if x != dims[d]:
-                pixels = pixels.narrow(d + 1, x_offset, x)
+                pixels = torch.nn.functional.pad(pixels, (0, self.output_channels - pixels.shape[-1]), mode=mode, value=value)
         return pixels
 
     def decode_tiled_(self, samples, tile_x=64, tile_y=64, overlap = 16):
@@ -992,6 +1010,7 @@ class CLIPType(Enum):
     OVIS = 21
     KANDINSKY5 = 22
     KANDINSKY5_IMAGE = 23
+    NEWBIE = 24
 
 
 def load_clip(ckpt_paths, embedding_directory=None, clip_type=CLIPType.STABLE_DIFFUSION, model_options={}):
@@ -1022,6 +1041,7 @@ class TEModel(Enum):
     MISTRAL3_24B_PRUNED_FLUX2 = 15
     QWEN3_4B = 16
     QWEN3_2B = 17
+    JINA_CLIP_2 = 18
 
 
 def detect_te_model(sd):
@@ -1031,6 +1051,8 @@ def detect_te_model(sd):
         return TEModel.CLIP_H
     if "text_model.encoder.layers.0.mlp.fc1.weight" in sd:
         return TEModel.CLIP_L
+    if "model.encoder.layers.0.mixer.Wqkv.weight" in sd:
+        return TEModel.JINA_CLIP_2
     if "encoder.block.23.layer.1.DenseReluDense.wi_1.weight" in sd:
         weight = sd["encoder.block.23.layer.1.DenseReluDense.wi_1.weight"]
         if weight.shape[-1] == 4096:
@@ -1191,6 +1213,9 @@ def load_text_encoder_state_dicts(state_dicts=[], embedding_directory=None, clip
         elif te_model == TEModel.QWEN3_2B:
             clip_target.clip = comfy.text_encoders.ovis.te(**llama_detect(clip_data))
             clip_target.tokenizer = comfy.text_encoders.ovis.OvisTokenizer
+        elif te_model == TEModel.JINA_CLIP_2:
+            clip_target.clip = comfy.text_encoders.jina_clip_2.JinaClip2TextModelWrapper
+            clip_target.tokenizer = comfy.text_encoders.jina_clip_2.JinaClip2TokenizerWrapper
         else:
             # clip_l
             if clip_type == CLIPType.SD3:
@@ -1246,6 +1271,17 @@ def load_text_encoder_state_dicts(state_dicts=[], embedding_directory=None, clip
         elif clip_type == CLIPType.KANDINSKY5_IMAGE:
             clip_target.clip = comfy.text_encoders.kandinsky5.te(**llama_detect(clip_data))
             clip_target.tokenizer = comfy.text_encoders.kandinsky5.Kandinsky5TokenizerImage
+        elif clip_type == CLIPType.NEWBIE:
+            clip_target.clip = comfy.text_encoders.newbie.te(**llama_detect(clip_data))
+            clip_target.tokenizer = comfy.text_encoders.newbie.NewBieTokenizer
+            if "model.layers.0.self_attn.q_norm.weight" in clip_data[0]:
+                clip_data_gemma = clip_data[0]
+                clip_data_jina = clip_data[1]
+            else:
+                clip_data_gemma = clip_data[1]
+                clip_data_jina = clip_data[0]
+            tokenizer_data["gemma_spiece_model"] = clip_data_gemma.get("spiece_model", None)
+            tokenizer_data["jina_spiece_model"] = clip_data_jina.get("spiece_model", None)
         else:
             clip_target.clip = sdxl_clip.SDXLClipModel
             clip_target.tokenizer = sdxl_clip.SDXLTokenizer
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sd1_clip.py b/packages/official-plugins/comfyui/src/comfyui/comfy/sd1_clip.py
index 962948d..c512ca5 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/sd1_clip.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/sd1_clip.py
@@ -466,7 +466,7 @@ def load_embed(embedding_name, embedding_directory, embedding_size, embed_key=No
     return embed_out
 
 class SDTokenizer:
-    def __init__(self, tokenizer_path=None, max_length=77, pad_with_end=True, embedding_directory=None, embedding_size=768, embedding_key='clip_l', tokenizer_class=CLIPTokenizer, has_start_token=True, has_end_token=True, pad_to_max_length=True, min_length=None, pad_token=None, end_token=None, min_padding=None, pad_left=False, tokenizer_data={}, tokenizer_args={}):
+    def __init__(self, tokenizer_path=None, max_length=77, pad_with_end=True, embedding_directory=None, embedding_size=768, embedding_key='clip_l', tokenizer_class=CLIPTokenizer, has_start_token=True, has_end_token=True, pad_to_max_length=True, min_length=None, pad_token=None, end_token=None, min_padding=None, pad_left=False, disable_weights=False, tokenizer_data={}, tokenizer_args={}):
         if tokenizer_path is None:
             tokenizer_path = os.path.join(os.path.dirname(os.path.realpath(__file__)), "sd1_tokenizer")
         self.tokenizer = tokenizer_class.from_pretrained(tokenizer_path, **tokenizer_args)
@@ -513,6 +513,8 @@ class SDTokenizer:
         self.embedding_size = embedding_size
         self.embedding_key = embedding_key
 
+        self.disable_weights = disable_weights
+
     def _try_get_embedding(self, embedding_name:str):
         '''
         Takes a potential embedding name and tries to retrieve it.
@@ -547,7 +549,7 @@ class SDTokenizer:
         min_padding = tokenizer_options.get("{}_min_padding".format(self.embedding_key), self.min_padding)
 
         text = escape_important(text)
-        if kwargs.get("disable_weights", False):
+        if kwargs.get("disable_weights", self.disable_weights):
             parsed_weights = [(text, 1.0)]
         else:
             parsed_weights = token_weights(text, 1.0)
diff --git a/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/jina_clip_2.py b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/jina_clip_2.py
new file mode 100644
index 0000000..0cffb6d
--- /dev/null
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/jina_clip_2.py
@@ -0,0 +1,219 @@
+# Jina CLIP v2 and Jina Embeddings v3 both use their modified XLM-RoBERTa architecture. Reference implementation:
+# Jina CLIP v2 (both text and vision): https://huggingface.co/jinaai/jina-clip-implementation/blob/39e6a55ae971b59bea6e44675d237c99762e7ee2/modeling_clip.py
+# Jina XLM-RoBERTa (text only): http://huggingface.co/jinaai/xlm-roberta-flash-implementation/blob/2b6bc3f30750b3a9648fe9b63448c09920efe9be/modeling_xlm_roberta.py
+
+from dataclasses import dataclass
+
+import torch
+from torch import nn as nn
+from torch.nn import functional as F
+
+import comfy.model_management
+import comfy.ops
+from comfy import sd1_clip
+from .spiece_tokenizer import SPieceTokenizer
+
+class JinaClip2Tokenizer(sd1_clip.SDTokenizer):
+    def __init__(self, embedding_directory=None, tokenizer_data={}):
+        tokenizer = tokenizer_data.get("spiece_model", None)
+        # The official NewBie uses max_length=8000, but Jina Embeddings v3 actually supports 8192
+        super().__init__(tokenizer, pad_with_end=False, embedding_size=1024, embedding_key='jina_clip_2', tokenizer_class=SPieceTokenizer, has_start_token=True, has_end_token=True, pad_to_max_length=False, max_length=8192, min_length=1, pad_token=1, end_token=2, tokenizer_args={"add_bos": True, "add_eos": True}, tokenizer_data=tokenizer_data)
+
+    def state_dict(self):
+        return {"spiece_model": self.tokenizer.serialize_model()}
+
+class JinaClip2TokenizerWrapper(sd1_clip.SD1Tokenizer):
+    def __init__(self, embedding_directory=None, tokenizer_data={}):
+        super().__init__(embedding_directory=embedding_directory, tokenizer_data=tokenizer_data, tokenizer=JinaClip2Tokenizer, name="jina_clip_2")
+
+# https://huggingface.co/jinaai/jina-embeddings-v3/blob/343dbf534c76fe845f304fa5c2d1fd87e1e78918/config.json
+@dataclass
+class XLMRobertaConfig:
+    vocab_size: int = 250002
+    type_vocab_size: int = 1
+    hidden_size: int = 1024
+    num_hidden_layers: int = 24
+    num_attention_heads: int = 16
+    rotary_emb_base: float = 20000.0
+    intermediate_size: int = 4096
+    hidden_act: str = "gelu"
+    hidden_dropout_prob: float = 0.1
+    attention_probs_dropout_prob: float = 0.1
+    layer_norm_eps: float = 1e-05
+    bos_token_id: int = 0
+    eos_token_id: int = 2
+    pad_token_id: int = 1
+
+class XLMRobertaEmbeddings(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        embed_dim = config.hidden_size
+        self.word_embeddings = ops.Embedding(config.vocab_size, embed_dim, padding_idx=config.pad_token_id, device=device, dtype=dtype)
+        self.token_type_embeddings = ops.Embedding(config.type_vocab_size, embed_dim, device=device, dtype=dtype)
+
+    def forward(self, input_ids=None, embeddings=None):
+        if input_ids is not None and embeddings is None:
+            embeddings = self.word_embeddings(input_ids)
+
+        if embeddings is not None:
+            token_type_ids = torch.zeros(embeddings.shape[1], device=embeddings.device, dtype=torch.int32)
+            token_type_embeddings = self.token_type_embeddings(token_type_ids)
+            embeddings = embeddings + token_type_embeddings
+        return embeddings
+
+class RotaryEmbedding(nn.Module):
+    def __init__(self, dim, base, device=None):
+        super().__init__()
+        inv_freq = 1.0 / (base ** (torch.arange(0, dim, 2, device=device, dtype=torch.float32) / dim))
+        self.register_buffer("inv_freq", inv_freq, persistent=False)
+        self._seq_len_cached = 0
+        self._cos_cached = None
+        self._sin_cached = None
+
+    def _update_cos_sin_cache(self, seqlen, device=None, dtype=None):
+        if seqlen > self._seq_len_cached or self._cos_cached is None or self._cos_cached.device != device or self._cos_cached.dtype != dtype:
+            self._seq_len_cached = seqlen
+            t = torch.arange(seqlen, device=device, dtype=torch.float32)
+            freqs = torch.outer(t, self.inv_freq.to(device=t.device))
+            emb = torch.cat((freqs, freqs), dim=-1)
+            self._cos_cached = emb.cos().to(dtype)
+            self._sin_cached = emb.sin().to(dtype)
+
+    def forward(self, q, k):
+        batch, seqlen, heads, head_dim = q.shape
+        self._update_cos_sin_cache(seqlen, device=q.device, dtype=q.dtype)
+
+        cos = self._cos_cached[:seqlen].view(1, seqlen, 1, head_dim)
+        sin = self._sin_cached[:seqlen].view(1, seqlen, 1, head_dim)
+
+        def rotate_half(x):
+            size = x.shape[-1] // 2
+            x1, x2 = x[..., :size], x[..., size:]
+            return torch.cat((-x2, x1), dim=-1)
+
+        q_embed = (q * cos) + (rotate_half(q) * sin)
+        k_embed = (k * cos) + (rotate_half(k) * sin)
+        return q_embed, k_embed
+
+class MHA(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        embed_dim = config.hidden_size
+        self.num_heads = config.num_attention_heads
+        self.head_dim = embed_dim // config.num_attention_heads
+
+        self.rotary_emb = RotaryEmbedding(self.head_dim, config.rotary_emb_base, device=device)
+        self.Wqkv = ops.Linear(embed_dim, 3 * embed_dim, device=device, dtype=dtype)
+        self.out_proj = ops.Linear(embed_dim, embed_dim, device=device, dtype=dtype)
+
+    def forward(self, x, mask=None, optimized_attention=None):
+        qkv = self.Wqkv(x)
+        batch_size, seq_len, _ = qkv.shape
+        qkv = qkv.view(batch_size, seq_len, 3, self.num_heads, self.head_dim)
+        q, k, v = qkv.unbind(2)
+
+        q, k = self.rotary_emb(q, k)
+
+        # NHD -> HND
+        q = q.transpose(1, 2)
+        k = k.transpose(1, 2)
+        v = v.transpose(1, 2)
+
+        out = optimized_attention(q, k, v, heads=self.num_heads, mask=mask, skip_reshape=True)
+        return self.out_proj(out)
+
+class MLP(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        self.fc1 = ops.Linear(config.hidden_size, config.intermediate_size, device=device, dtype=dtype)
+        self.activation = F.gelu
+        self.fc2 = ops.Linear(config.intermediate_size, config.hidden_size, device=device, dtype=dtype)
+
+    def forward(self, x):
+        x = self.fc1(x)
+        x = self.activation(x)
+        x = self.fc2(x)
+        return x
+
+class Block(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        self.mixer = MHA(config, device=device, dtype=dtype, ops=ops)
+        self.dropout1 = nn.Dropout(config.hidden_dropout_prob)
+        self.norm1 = ops.LayerNorm(config.hidden_size, eps=config.layer_norm_eps, device=device, dtype=dtype)
+        self.mlp = MLP(config, device=device, dtype=dtype, ops=ops)
+        self.dropout2 = nn.Dropout(config.hidden_dropout_prob)
+        self.norm2 = ops.LayerNorm(config.hidden_size, eps=config.layer_norm_eps, device=device, dtype=dtype)
+
+    def forward(self, hidden_states, mask=None, optimized_attention=None):
+        mixer_out = self.mixer(hidden_states, mask=mask, optimized_attention=optimized_attention)
+        hidden_states = self.norm1(self.dropout1(mixer_out) + hidden_states)
+        mlp_out = self.mlp(hidden_states)
+        hidden_states = self.norm2(self.dropout2(mlp_out) + hidden_states)
+        return hidden_states
+
+class XLMRobertaEncoder(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        self.layers = nn.ModuleList([Block(config, device=device, dtype=dtype, ops=ops) for _ in range(config.num_hidden_layers)])
+
+    def forward(self, hidden_states, attention_mask=None):
+        optimized_attention = comfy.ldm.modules.attention.optimized_attention_for_device(hidden_states.device, mask=attention_mask is not None, small_input=True)
+        for layer in self.layers:
+            hidden_states = layer(hidden_states, mask=attention_mask, optimized_attention=optimized_attention)
+        return hidden_states
+
+class XLMRobertaModel_(nn.Module):
+    def __init__(self, config, device=None, dtype=None, ops=None):
+        super().__init__()
+        self.embeddings = XLMRobertaEmbeddings(config, device=device, dtype=dtype, ops=ops)
+        self.emb_ln = ops.LayerNorm(config.hidden_size, eps=config.layer_norm_eps, device=device, dtype=dtype)
+        self.emb_drop = nn.Dropout(config.hidden_dropout_prob)
+        self.encoder = XLMRobertaEncoder(config, device=device, dtype=dtype, ops=ops)
+
+    def forward(self, input_ids, attention_mask=None, embeds=None, num_tokens=None, intermediate_output=None, final_layer_norm_intermediate=True, dtype=None, embeds_info=[]):
+        x = self.embeddings(input_ids=input_ids, embeddings=embeds)
+        x = self.emb_ln(x)
+        x = self.emb_drop(x)
+
+        mask = None
+        if attention_mask is not None:
+            mask = 1.0 - attention_mask.to(x.dtype).reshape((attention_mask.shape[0], 1, 1, attention_mask.shape[-1]))
+            mask = mask.masked_fill(mask.to(torch.bool), -torch.finfo(x.dtype).max)
+
+        sequence_output = self.encoder(x, attention_mask=mask)
+
+        # Mean pool, see https://huggingface.co/jinaai/jina-clip-implementation/blob/39e6a55ae971b59bea6e44675d237c99762e7ee2/hf_model.py
+        pooled_output = None
+        if attention_mask is None:
+            pooled_output = sequence_output.mean(dim=1)
+        else:
+            attention_mask = attention_mask.to(sequence_output.dtype)
+            pooled_output = (sequence_output * attention_mask.unsqueeze(-1)).sum(dim=1) / attention_mask.sum(dim=-1, keepdim=True)
+
+        # Intermediate output is not yet implemented, use None for placeholder
+        return sequence_output, None, pooled_output
+
+class XLMRobertaModel(nn.Module):
+    def __init__(self, config_dict, dtype, device, operations):
+        super().__init__()
+        self.config = XLMRobertaConfig(**config_dict)
+        self.model = XLMRobertaModel_(self.config, device=device, dtype=dtype, ops=operations)
+        self.num_layers = self.config.num_hidden_layers
+
+    def get_input_embeddings(self):
+        return self.model.embeddings.word_embeddings
+
+    def set_input_embeddings(self, embeddings):
+        self.model.embeddings.word_embeddings = embeddings
+
+    def forward(self, *args, **kwargs):
+        return self.model(*args, **kwargs)
+
+class JinaClip2TextModel(sd1_clip.SDClipModel):
+    def __init__(self, device="cpu", dtype=None, model_options={}):
+        super().__init__(device=device, dtype=dtype, textmodel_json_config={}, model_class=XLMRobertaModel, special_tokens={"start": 0, "end": 2, "pad": 1}, enable_attention_masks=True, return_attention_masks=True, model_options=model_options)
+
+class JinaClip2TextModelWrapper(sd1_clip.SD1ClipModel):
+    def __init__(self, device="cpu", dtype=None, model_options={}):
+        super().__init__(device=device, dtype=dtype, clip_model=JinaClip2TextModel, name="jina_clip_2", model_options=model_options)
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/text_encoders/llama.py b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/llama.py
index 0d07ac8..ed29e01 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/text_encoders/llama.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/llama.py
@@ -3,7 +3,6 @@ import torch.nn as nn
 from dataclasses import dataclass
 from typing import Optional, Any
 import math
-import logging
 
 from comfy.ldm.modules.attention import optimized_attention_for_device
 import comfy.model_management
@@ -177,7 +176,7 @@ class Gemma3_4B_Config:
     num_key_value_heads: int = 4
     max_position_embeddings: int = 131072
     rms_norm_eps: float = 1e-6
-    rope_theta = [10000.0, 1000000.0]
+    rope_theta = [1000000.0, 10000.0]
     transformer_type: str = "gemma3"
     head_dim = 256
     rms_norm_add = True
@@ -186,8 +185,8 @@ class Gemma3_4B_Config:
     rope_dims = None
     q_norm = "gemma3"
     k_norm = "gemma3"
-    sliding_attention = [False, False, False, False, False, 1024]
-    rope_scale = [1.0, 8.0]
+    sliding_attention = [1024, 1024, 1024, 1024, 1024, False]
+    rope_scale = [8.0, 1.0]
     final_norm: bool = True
 
 class RMSNorm(nn.Module):
@@ -370,7 +369,7 @@ class TransformerBlockGemma2(nn.Module):
         self.pre_feedforward_layernorm = RMSNorm(config.hidden_size, eps=config.rms_norm_eps, add=config.rms_norm_add, device=device, dtype=dtype)
         self.post_feedforward_layernorm = RMSNorm(config.hidden_size, eps=config.rms_norm_eps, add=config.rms_norm_add, device=device, dtype=dtype)
 
-        if config.sliding_attention is not None:  # TODO: implement. (Not that necessary since models are trained on less than 1024 tokens)
+        if config.sliding_attention is not None:
             self.sliding_attention = config.sliding_attention[index % len(config.sliding_attention)]
         else:
             self.sliding_attention = False
@@ -387,7 +386,12 @@ class TransformerBlockGemma2(nn.Module):
         if self.transformer_type == 'gemma3':
             if self.sliding_attention:
                 if x.shape[1] > self.sliding_attention:
-                    logging.warning("Warning: sliding attention not implemented, results may be incorrect")
+                    sliding_mask = torch.full((x.shape[1], x.shape[1]), float("-inf"), device=x.device, dtype=x.dtype)
+                    sliding_mask.tril_(diagonal=-self.sliding_attention)
+                    if attention_mask is not None:
+                        attention_mask = attention_mask + sliding_mask
+                    else:
+                        attention_mask = sliding_mask
                 freqs_cis = freqs_cis[1]
             else:
                 freqs_cis = freqs_cis[0]
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/text_encoders/lumina2.py b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/lumina2.py
index 7a6cfda..b29a7cc 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy/text_encoders/lumina2.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/lumina2.py
@@ -14,7 +14,7 @@ class Gemma2BTokenizer(sd1_clip.SDTokenizer):
 class Gemma3_4BTokenizer(sd1_clip.SDTokenizer):
     def __init__(self, embedding_directory=None, tokenizer_data={}):
         tokenizer = tokenizer_data.get("spiece_model", None)
-        super().__init__(tokenizer, pad_with_end=False, embedding_size=2560, embedding_key='gemma3_4b', tokenizer_class=SPieceTokenizer, has_end_token=False, pad_to_max_length=False, max_length=99999999, min_length=1, tokenizer_args={"add_bos": True, "add_eos": False}, tokenizer_data=tokenizer_data)
+        super().__init__(tokenizer, pad_with_end=False, embedding_size=2560, embedding_key='gemma3_4b', tokenizer_class=SPieceTokenizer, has_end_token=False, pad_to_max_length=False, max_length=99999999, min_length=1, tokenizer_args={"add_bos": True, "add_eos": False}, disable_weights=True, tokenizer_data=tokenizer_data)
 
     def state_dict(self):
         return {"spiece_model": self.tokenizer.serialize_model()}
@@ -33,6 +33,11 @@ class Gemma2_2BModel(sd1_clip.SDClipModel):
 
 class Gemma3_4BModel(sd1_clip.SDClipModel):
     def __init__(self, device="cpu", layer="hidden", layer_idx=-2, dtype=None, attention_mask=True, model_options={}):
+        llama_quantization_metadata = model_options.get("llama_quantization_metadata", None)
+        if llama_quantization_metadata is not None:
+            model_options = model_options.copy()
+            model_options["quantization_metadata"] = llama_quantization_metadata
+
         super().__init__(device=device, layer=layer, layer_idx=layer_idx, textmodel_json_config={}, dtype=dtype, special_tokens={"start": 2, "pad": 0}, layer_norm_hidden_state=False, model_class=comfy.text_encoders.llama.Gemma3_4B, enable_attention_masks=attention_mask, return_attention_masks=attention_mask, model_options=model_options)
 
 class LuminaModel(sd1_clip.SD1ClipModel):
diff --git a/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/newbie.py b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/newbie.py
new file mode 100644
index 0000000..db23245
--- /dev/null
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy/text_encoders/newbie.py
@@ -0,0 +1,62 @@
+import torch
+
+import comfy.model_management
+import comfy.text_encoders.jina_clip_2
+import comfy.text_encoders.lumina2
+
+class NewBieTokenizer:
+    def __init__(self, embedding_directory=None, tokenizer_data={}):
+        self.gemma = comfy.text_encoders.lumina2.Gemma3_4BTokenizer(embedding_directory=embedding_directory, tokenizer_data={"spiece_model": tokenizer_data["gemma_spiece_model"]})
+        self.jina = comfy.text_encoders.jina_clip_2.JinaClip2Tokenizer(embedding_directory=embedding_directory, tokenizer_data={"spiece_model": tokenizer_data["jina_spiece_model"]})
+
+    def tokenize_with_weights(self, text:str, return_word_ids=False, **kwargs):
+        out = {}
+        out["gemma"] = self.gemma.tokenize_with_weights(text, return_word_ids, **kwargs)
+        out["jina"] = self.jina.tokenize_with_weights(text, return_word_ids, **kwargs)
+        return out
+
+    def untokenize(self, token_weight_pair):
+        raise NotImplementedError
+
+    def state_dict(self):
+        return {}
+
+class NewBieTEModel(torch.nn.Module):
+    def __init__(self, dtype_gemma=None, device="cpu", dtype=None, model_options={}):
+        super().__init__()
+        dtype_gemma = comfy.model_management.pick_weight_dtype(dtype_gemma, dtype, device)
+        self.gemma = comfy.text_encoders.lumina2.Gemma3_4BModel(device=device, dtype=dtype_gemma, model_options=model_options)
+        self.jina = comfy.text_encoders.jina_clip_2.JinaClip2TextModel(device=device, dtype=dtype, model_options=model_options)
+        self.dtypes = {dtype, dtype_gemma}
+
+    def set_clip_options(self, options):
+        self.gemma.set_clip_options(options)
+        self.jina.set_clip_options(options)
+
+    def reset_clip_options(self):
+        self.gemma.reset_clip_options()
+        self.jina.reset_clip_options()
+
+    def encode_token_weights(self, token_weight_pairs):
+        token_weight_pairs_gemma = token_weight_pairs["gemma"]
+        token_weight_pairs_jina = token_weight_pairs["jina"]
+
+        gemma_out, gemma_pooled, gemma_extra = self.gemma.encode_token_weights(token_weight_pairs_gemma)
+        jina_out, jina_pooled, jina_extra = self.jina.encode_token_weights(token_weight_pairs_jina)
+
+        return gemma_out, jina_pooled, gemma_extra
+
+    def load_sd(self, sd):
+        if "model.layers.0.self_attn.q_norm.weight" in sd:
+            return self.gemma.load_sd(sd)
+        else:
+            return self.jina.load_sd(sd)
+
+def te(dtype_llama=None, llama_quantization_metadata=None):
+    class NewBieTEModel_(NewBieTEModel):
+        def __init__(self, device="cpu", dtype=None, model_options={}):
+            if llama_quantization_metadata is not None:
+                model_options = model_options.copy()
+                model_options["llama_quantization_metadata"] = llama_quantization_metadata
+            super().__init__(dtype_gemma=dtype_llama, device=device, dtype=dtype, model_options=model_options)
+    return NewBieTEModel_
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api/latest/_input/__init__.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api/latest/_input/__init__.py
index 5b34788..14f0e72 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api/latest/_input/__init__.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api/latest/_input/__init__.py
@@ -1,15 +1,10 @@
 from .basic_types import ImageInput, AudioInput, MaskInput, LatentInput
-import importlib.util
-
-_VIDEO_AVAILABLE = importlib.util.find_spec("av") is not None
-if _VIDEO_AVAILABLE:
-    from .video_types import VideoInput
+from .video_types import VideoInput
 
 __all__ = [
     "ImageInput",
     "AudioInput",
+    "VideoInput",
     "MaskInput",
     "LatentInput",
 ]
-if _VIDEO_AVAILABLE:
-    __all__.append("VideoInput")
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/apis/bytedance_api.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/apis/bytedance_api.py
index 77cd76f..b8c2f61 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/apis/bytedance_api.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/apis/bytedance_api.py
@@ -10,7 +10,7 @@ class Text2ImageTaskCreationRequest(BaseModel):
     size: str | None = Field(None)
     seed: int | None = Field(0, ge=0, le=2147483647)
     guidance_scale: float | None = Field(..., ge=1.0, le=10.0)
-    watermark: bool | None = Field(True)
+    watermark: bool | None = Field(False)
 
 
 class Image2ImageTaskCreationRequest(BaseModel):
@@ -21,7 +21,7 @@ class Image2ImageTaskCreationRequest(BaseModel):
     size: str | None = Field("adaptive")
     seed: int | None = Field(..., ge=0, le=2147483647)
     guidance_scale: float | None = Field(..., ge=1.0, le=10.0)
-    watermark: bool | None = Field(True)
+    watermark: bool | None = Field(False)
 
 
 class Seedream4Options(BaseModel):
@@ -37,7 +37,7 @@ class Seedream4TaskCreationRequest(BaseModel):
     seed: int = Field(..., ge=0, le=2147483647)
     sequential_image_generation: str = Field("disabled")
     sequential_image_generation_options: Seedream4Options = Field(Seedream4Options(max_images=15))
-    watermark: bool = Field(True)
+    watermark: bool = Field(False)
 
 
 class ImageTaskCreationResponse(BaseModel):
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_bfl.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_bfl.py
index 8826dea..ce077d6 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_bfl.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_bfl.py
@@ -1,10 +1,8 @@
-from inspect import cleandoc
-
 import torch
 from pydantic import BaseModel
 from typing_extensions import override
 
-from comfy_api.latest import IO, ComfyExtension
+from comfy_api.latest import IO, ComfyExtension, Input
 from comfy_api_nodes.apis.bfl_api import (
     BFLFluxExpandImageRequest,
     BFLFluxFillImageRequest,
@@ -28,7 +26,7 @@ from comfy_api_nodes.util import (
 )
 
 
-def convert_mask_to_image(mask: torch.Tensor):
+def convert_mask_to_image(mask: Input.Image):
     """
     Make mask have the expected amount of dims (4) and channels (3) to be recognized as an image.
     """
@@ -38,9 +36,6 @@ def convert_mask_to_image(mask: torch.Tensor):
 
 
 class FluxProUltraImageNode(IO.ComfyNode):
-    """
-    Generates images using Flux Pro 1.1 Ultra via api based on prompt and resolution.
-    """
 
     @classmethod
     def define_schema(cls) -> IO.Schema:
@@ -48,7 +43,7 @@ class FluxProUltraImageNode(IO.ComfyNode):
             node_id="FluxProUltraImageNode",
             display_name="Flux 1.1 [pro] Ultra Image",
             category="api node/image/BFL",
-            description=cleandoc(cls.__doc__ or ""),
+            description="Generates images using Flux Pro 1.1 Ultra via api based on prompt and resolution.",
             inputs=[
                 IO.String.Input(
                     "prompt",
@@ -117,7 +112,7 @@ class FluxProUltraImageNode(IO.ComfyNode):
         prompt_upsampling: bool = False,
         raw: bool = False,
         seed: int = 0,
-        image_prompt: torch.Tensor | None = None,
+        image_prompt: Input.Image | None = None,
         image_prompt_strength: float = 0.1,
     ) -> IO.NodeOutput:
         if image_prompt is None:
@@ -155,9 +150,6 @@ class FluxProUltraImageNode(IO.ComfyNode):
 
 
 class FluxKontextProImageNode(IO.ComfyNode):
-    """
-    Edits images using Flux.1 Kontext [pro] via api based on prompt and aspect ratio.
-    """
 
     @classmethod
     def define_schema(cls) -> IO.Schema:
@@ -165,7 +157,7 @@ class FluxKontextProImageNode(IO.ComfyNode):
             node_id=cls.NODE_ID,
             display_name=cls.DISPLAY_NAME,
             category="api node/image/BFL",
-            description=cleandoc(cls.__doc__ or ""),
+            description="Edits images using Flux.1 Kontext [pro] via api based on prompt and aspect ratio.",
             inputs=[
                 IO.String.Input(
                     "prompt",
@@ -231,7 +223,7 @@ class FluxKontextProImageNode(IO.ComfyNode):
         aspect_ratio: str,
         guidance: float,
         steps: int,
-        input_image: torch.Tensor | None = None,
+        input_image: Input.Image | None = None,
         seed=0,
         prompt_upsampling=False,
     ) -> IO.NodeOutput:
@@ -271,20 +263,14 @@ class FluxKontextProImageNode(IO.ComfyNode):
 
 
 class FluxKontextMaxImageNode(FluxKontextProImageNode):
-    """
-    Edits images using Flux.1 Kontext [max] via api based on prompt and aspect ratio.
-    """
 
-    DESCRIPTION = cleandoc(__doc__ or "")
+    DESCRIPTION = "Edits images using Flux.1 Kontext [max] via api based on prompt and aspect ratio."
     BFL_PATH = "/proxy/bfl/flux-kontext-max/generate"
     NODE_ID = "FluxKontextMaxImageNode"
     DISPLAY_NAME = "Flux.1 Kontext [max] Image"
 
 
 class FluxProExpandNode(IO.ComfyNode):
-    """
-    Outpaints image based on prompt.
-    """
 
     @classmethod
     def define_schema(cls) -> IO.Schema:
@@ -292,7 +278,7 @@ class FluxProExpandNode(IO.ComfyNode):
             node_id="FluxProExpandNode",
             display_name="Flux.1 Expand Image",
             category="api node/image/BFL",
-            description=cleandoc(cls.__doc__ or ""),
+            description="Outpaints image based on prompt.",
             inputs=[
                 IO.Image.Input("image"),
                 IO.String.Input(
@@ -371,7 +357,7 @@ class FluxProExpandNode(IO.ComfyNode):
     @classmethod
     async def execute(
         cls,
-        image: torch.Tensor,
+        image: Input.Image,
         prompt: str,
         prompt_upsampling: bool,
         top: int,
@@ -418,9 +404,6 @@ class FluxProExpandNode(IO.ComfyNode):
 
 
 class FluxProFillNode(IO.ComfyNode):
-    """
-    Inpaints image based on mask and prompt.
-    """
 
     @classmethod
     def define_schema(cls) -> IO.Schema:
@@ -428,7 +411,7 @@ class FluxProFillNode(IO.ComfyNode):
             node_id="FluxProFillNode",
             display_name="Flux.1 Fill Image",
             category="api node/image/BFL",
-            description=cleandoc(cls.__doc__ or ""),
+            description="Inpaints image based on mask and prompt.",
             inputs=[
                 IO.Image.Input("image"),
                 IO.Mask.Input("mask"),
@@ -480,8 +463,8 @@ class FluxProFillNode(IO.ComfyNode):
     @classmethod
     async def execute(
         cls,
-        image: torch.Tensor,
-        mask: torch.Tensor,
+        image: Input.Image,
+        mask: Input.Image,
         prompt: str,
         prompt_upsampling: bool,
         steps: int,
@@ -525,11 +508,15 @@ class FluxProFillNode(IO.ComfyNode):
 
 class Flux2ProImageNode(IO.ComfyNode):
 
+    NODE_ID = "Flux2ProImageNode"
+    DISPLAY_NAME = "Flux.2 [pro] Image"
+    API_ENDPOINT = "/proxy/bfl/flux-2-pro/generate"
+
     @classmethod
     def define_schema(cls) -> IO.Schema:
         return IO.Schema(
-            node_id="Flux2ProImageNode",
-            display_name="Flux.2 [pro] Image",
+            node_id=cls.NODE_ID,
+            display_name=cls.DISPLAY_NAME,
             category="api node/image/BFL",
             description="Generates images synchronously based on prompt and resolution.",
             inputs=[
@@ -563,12 +550,11 @@ class Flux2ProImageNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "prompt_upsampling",
-                    default=False,
+                    default=True,
                     tooltip="Whether to perform upsampling on the prompt. "
-                    "If active, automatically modifies the prompt for more creative generation, "
-                    "but results are nondeterministic (same seed will not produce exactly the same result).",
+                    "If active, automatically modifies the prompt for more creative generation.",
                 ),
-                IO.Image.Input("images", optional=True, tooltip="Up to 4 images to be used as references."),
+                IO.Image.Input("images", optional=True, tooltip="Up to 9 images to be used as references."),
             ],
             outputs=[IO.Image.Output()],
             hidden=[
@@ -587,7 +573,7 @@ class Flux2ProImageNode(IO.ComfyNode):
         height: int,
         seed: int,
         prompt_upsampling: bool,
-        images: torch.Tensor | None = None,
+        images: Input.Image | None = None,
     ) -> IO.NodeOutput:
         reference_images = {}
         if images is not None:
@@ -598,7 +584,7 @@ class Flux2ProImageNode(IO.ComfyNode):
                 reference_images[key_name] = tensor_to_base64_string(images[image_index], total_pixels=2048 * 2048)
         initial_response = await sync_op(
             cls,
-            ApiEndpoint(path="/proxy/bfl/flux-2-pro/generate", method="POST"),
+            ApiEndpoint(path=cls.API_ENDPOINT, method="POST"),
             response_model=BFLFluxProGenerateResponse,
             data=Flux2ProGenerateRequest(
                 prompt=prompt,
@@ -632,6 +618,13 @@ class Flux2ProImageNode(IO.ComfyNode):
         return IO.NodeOutput(await download_url_to_image_tensor(response.result["sample"]))
 
 
+class Flux2MaxImageNode(Flux2ProImageNode):
+
+    NODE_ID = "Flux2MaxImageNode"
+    DISPLAY_NAME = "Flux.2 [max] Image"
+    API_ENDPOINT = "/proxy/bfl/flux-2-max/generate"
+
+
 class BFLExtension(ComfyExtension):
     @override
     async def get_node_list(self) -> list[type[IO.ComfyNode]]:
@@ -642,6 +635,7 @@ class BFLExtension(ComfyExtension):
             FluxProExpandNode,
             FluxProFillNode,
             Flux2ProImageNode,
+            Flux2MaxImageNode,
         ]
 
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_bytedance.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_bytedance.py
index 57c0218..636cc12 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_bytedance.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_bytedance.py
@@ -112,7 +112,7 @@ class ByteDanceImageNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the image',
                     optional=True,
                 ),
@@ -215,7 +215,7 @@ class ByteDanceImageEditNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the image',
                     optional=True,
                 ),
@@ -346,7 +346,7 @@ class ByteDanceSeedreamNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the image.',
                     optional=True,
                 ),
@@ -380,7 +380,7 @@ class ByteDanceSeedreamNode(IO.ComfyNode):
         sequential_image_generation: str = "disabled",
         max_images: int = 1,
         seed: int = 0,
-        watermark: bool = True,
+        watermark: bool = False,
         fail_on_partial: bool = True,
     ) -> IO.NodeOutput:
         validate_string(prompt, strip_whitespace=True, min_length=1)
@@ -507,7 +507,7 @@ class ByteDanceTextToVideoNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the video.',
                     optional=True,
                 ),
@@ -617,7 +617,7 @@ class ByteDanceImageToVideoNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the video.',
                     optional=True,
                 ),
@@ -739,7 +739,7 @@ class ByteDanceFirstLastFrameNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the video.',
                     optional=True,
                 ),
@@ -862,7 +862,7 @@ class ByteDanceImageReferenceNode(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip='Whether to add an "AI generated" watermark to the video.',
                     optional=True,
                 ),
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_kling.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_kling.py
index 1a6364f..5294b10 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_kling.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_kling.py
@@ -858,7 +858,7 @@ class OmniProFirstLastFrameNode(IO.ComfyNode):
                     tooltip="A text prompt describing the video content. "
                     "This can include both positive and negative descriptions.",
                 ),
-                IO.Combo.Input("duration", options=["5", "10"]),
+                IO.Int.Input("duration", default=5, min=3, max=10, display_mode=IO.NumberDisplay.slider),
                 IO.Image.Input("first_frame"),
                 IO.Image.Input(
                     "end_frame",
@@ -897,6 +897,10 @@ class OmniProFirstLastFrameNode(IO.ComfyNode):
         validate_string(prompt, min_length=1, max_length=2500)
         if end_frame is not None and reference_images is not None:
             raise ValueError("The 'end_frame' input cannot be used simultaneously with 'reference_images'.")
+        if duration not in (5, 10) and end_frame is None and reference_images is None:
+            raise ValueError(
+                "Duration is only supported for 5 or 10 seconds if there is no end frame or reference images."
+            )
         validate_image_dimensions(first_frame, min_width=300, min_height=300)
         validate_image_aspect_ratio(first_frame, (1, 2.5), (2.5, 1))
         image_list: list[OmniParamImage] = [
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_topaz.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_topaz.py
index f522756..b04575a 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_topaz.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_topaz.py
@@ -23,10 +23,6 @@ UPSCALER_MODELS_MAP = {
     "Starlight (Astra) Fast": "slf-1",
     "Starlight (Astra) Creative": "slc-1",
 }
-UPSCALER_VALUES_MAP = {
-    "FullHD (1080p)": 1920,
-    "4K (2160p)": 3840,
-}
 
 
 class TopazImageEnhance(IO.ComfyNode):
@@ -214,7 +210,7 @@ class TopazVideoEnhance(IO.ComfyNode):
                 IO.Video.Input("video"),
                 IO.Boolean.Input("upscaler_enabled", default=True),
                 IO.Combo.Input("upscaler_model", options=list(UPSCALER_MODELS_MAP.keys())),
-                IO.Combo.Input("upscaler_resolution", options=list(UPSCALER_VALUES_MAP.keys())),
+                IO.Combo.Input("upscaler_resolution", options=["FullHD (1080p)", "4K (2160p)"]),
                 IO.Combo.Input(
                     "upscaler_creativity",
                     options=["low", "middle", "high"],
@@ -306,8 +302,33 @@ class TopazVideoEnhance(IO.ComfyNode):
         target_frame_rate = src_frame_rate
         filters = []
         if upscaler_enabled:
-            target_width = UPSCALER_VALUES_MAP[upscaler_resolution]
-            target_height = UPSCALER_VALUES_MAP[upscaler_resolution]
+            if "1080p" in upscaler_resolution:
+                target_pixel_p = 1080
+                max_long_side = 1920
+            else:
+                target_pixel_p = 2160
+                max_long_side = 3840
+            ar = src_width / src_height
+            if src_width >= src_height:
+                # Landscape or Square; Attempt to set height to target (e.g., 2160), calculate width
+                target_height = target_pixel_p
+                target_width = int(target_height * ar)
+                # Check if width exceeds standard bounds (for ultra-wide e.g., 21:9 ARs)
+                if target_width > max_long_side:
+                    target_width = max_long_side
+                    target_height = int(target_width / ar)
+            else:
+                # Portrait; Attempt to set width to target (e.g., 2160), calculate height
+                target_width = target_pixel_p
+                target_height = int(target_width / ar)
+                # Check if height exceeds standard bounds
+                if target_height > max_long_side:
+                    target_height = max_long_side
+                    target_width = int(target_height * ar)
+            if target_width % 2 != 0:
+                target_width += 1
+            if target_height % 2 != 0:
+                target_height += 1
             filters.append(
                 topaz_api.VideoEnhancementFilter(
                     model=UPSCALER_MODELS_MAP[upscaler_model],
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_wan.py b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_wan.py
index 17b680e..1675fd8 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_api_nodes/nodes_wan.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_api_nodes/nodes_wan.py
@@ -46,14 +46,14 @@ class Txt2ImageParametersField(BaseModel):
     n: int = Field(1, description="Number of images to generate.")  # we support only value=1
     seed: int = Field(..., ge=0, le=2147483647)
     prompt_extend: bool = Field(True)
-    watermark: bool = Field(True)
+    watermark: bool = Field(False)
 
 
 class Image2ImageParametersField(BaseModel):
     size: str | None = Field(None)
     n: int = Field(1, description="Number of images to generate.")  # we support only value=1
     seed: int = Field(..., ge=0, le=2147483647)
-    watermark: bool = Field(True)
+    watermark: bool = Field(False)
 
 
 class Text2VideoParametersField(BaseModel):
@@ -61,7 +61,7 @@ class Text2VideoParametersField(BaseModel):
     seed: int = Field(..., ge=0, le=2147483647)
     duration: int = Field(5, ge=5, le=15)
     prompt_extend: bool = Field(True)
-    watermark: bool = Field(True)
+    watermark: bool = Field(False)
     audio: bool = Field(False, description="Whether to generate audio automatically.")
     shot_type: str = Field("single")
 
@@ -71,7 +71,7 @@ class Image2VideoParametersField(BaseModel):
     seed: int = Field(..., ge=0, le=2147483647)
     duration: int = Field(5, ge=5, le=15)
     prompt_extend: bool = Field(True)
-    watermark: bool = Field(True)
+    watermark: bool = Field(False)
     audio: bool = Field(False, description="Whether to generate audio automatically.")
     shot_type: str = Field("single")
 
@@ -208,7 +208,7 @@ class WanTextToImageApi(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip="Whether to add an AI-generated watermark to the result.",
                     optional=True,
                 ),
@@ -234,7 +234,7 @@ class WanTextToImageApi(IO.ComfyNode):
         height: int = 1024,
         seed: int = 0,
         prompt_extend: bool = True,
-        watermark: bool = True,
+        watermark: bool = False,
     ):
         initial_response = await sync_op(
             cls,
@@ -327,7 +327,7 @@ class WanImageToImageApi(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip="Whether to add an AI-generated watermark to the result.",
                     optional=True,
                 ),
@@ -353,7 +353,7 @@ class WanImageToImageApi(IO.ComfyNode):
         # width: int = 1024,
         # height: int = 1024,
         seed: int = 0,
-        watermark: bool = True,
+        watermark: bool = False,
     ):
         n_images = get_number_of_images(image)
         if n_images not in (1, 2):
@@ -476,7 +476,7 @@ class WanTextToVideoApi(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip="Whether to add an AI-generated watermark to the result.",
                     optional=True,
                 ),
@@ -512,7 +512,7 @@ class WanTextToVideoApi(IO.ComfyNode):
         seed: int = 0,
         generate_audio: bool = False,
         prompt_extend: bool = True,
-        watermark: bool = True,
+        watermark: bool = False,
         shot_type: str = "single",
     ):
         if "480p" in size and model == "wan2.6-t2v":
@@ -637,7 +637,7 @@ class WanImageToVideoApi(IO.ComfyNode):
                 ),
                 IO.Boolean.Input(
                     "watermark",
-                    default=True,
+                    default=False,
                     tooltip="Whether to add an AI-generated watermark to the result.",
                     optional=True,
                 ),
@@ -674,7 +674,7 @@ class WanImageToVideoApi(IO.ComfyNode):
         seed: int = 0,
         generate_audio: bool = False,
         prompt_extend: bool = True,
-        watermark: bool = True,
+        watermark: bool = False,
         shot_type: str = "single",
     ):
         if get_number_of_images(image) != 1:
diff --git a/packages/official-plugins/comfyui/src/comfyui/comfy_execution/jobs.py b/packages/official-plugins/comfyui/src/comfyui/comfy_execution/jobs.py
new file mode 100644
index 0000000..59fb493
--- /dev/null
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_execution/jobs.py
@@ -0,0 +1,291 @@
+"""
+Job utilities for the /api/jobs endpoint.
+Provides normalization and helper functions for job status tracking.
+"""
+
+from typing import Optional
+
+from comfy_api.internal import prune_dict
+
+
+class JobStatus:
+    """Job status constants."""
+    PENDING = 'pending'
+    IN_PROGRESS = 'in_progress'
+    COMPLETED = 'completed'
+    FAILED = 'failed'
+
+    ALL = [PENDING, IN_PROGRESS, COMPLETED, FAILED]
+
+
+# Media types that can be previewed in the frontend
+PREVIEWABLE_MEDIA_TYPES = frozenset({'images', 'video', 'audio'})
+
+# 3D file extensions for preview fallback (no dedicated media_type exists)
+THREE_D_EXTENSIONS = frozenset({'.obj', '.fbx', '.gltf', '.glb'})
+
+
+def _extract_job_metadata(extra_data: dict) -> tuple[Optional[int], Optional[str]]:
+    """Extract create_time and workflow_id from extra_data.
+
+    Returns:
+        tuple: (create_time, workflow_id)
+    """
+    create_time = extra_data.get('create_time')
+    extra_pnginfo = extra_data.get('extra_pnginfo', {})
+    workflow_id = extra_pnginfo.get('workflow', {}).get('id')
+    return create_time, workflow_id
+
+
+def is_previewable(media_type: str, item: dict) -> bool:
+    """
+    Check if an output item is previewable.
+    Matches frontend logic in ComfyUI_frontend/src/stores/queueStore.ts
+    Maintains backwards compatibility with existing logic.
+
+    Priority:
+    1. media_type is 'images', 'video', or 'audio'
+    2. format field starts with 'video/' or 'audio/'
+    3. filename has a 3D extension (.obj, .fbx, .gltf, .glb)
+    """
+    if media_type in PREVIEWABLE_MEDIA_TYPES:
+        return True
+
+    # Check format field (MIME type).
+    # Maintains backwards compatibility with how custom node outputs are handled in the frontend.
+    fmt = item.get('format', '')
+    if fmt and (fmt.startswith('video/') or fmt.startswith('audio/')):
+        return True
+
+    # Check for 3D files by extension
+    filename = item.get('filename', '').lower()
+    if any(filename.endswith(ext) for ext in THREE_D_EXTENSIONS):
+        return True
+
+    return False
+
+
+def normalize_queue_item(item: tuple, status: str) -> dict:
+    """Convert queue item tuple to unified job dict.
+
+    Expects item with sensitive data already removed (5 elements).
+    """
+    priority, prompt_id, _, extra_data, _ = item
+    create_time, workflow_id = _extract_job_metadata(extra_data)
+
+    return prune_dict({
+        'id': prompt_id,
+        'status': status,
+        'priority': priority,
+        'create_time': create_time,
+        'outputs_count': 0,
+        'workflow_id': workflow_id,
+    })
+
+
+def normalize_history_item(prompt_id: str, history_item: dict, include_outputs: bool = False) -> dict:
+    """Convert history item dict to unified job dict.
+
+    History items have sensitive data already removed (prompt tuple has 5 elements).
+    """
+    prompt_tuple = history_item['prompt']
+    priority, _, prompt, extra_data, _ = prompt_tuple
+    create_time, workflow_id = _extract_job_metadata(extra_data)
+
+    status_info = history_item.get('status', {})
+    status_str = status_info.get('status_str') if status_info else None
+    if status_str == 'success':
+        status = JobStatus.COMPLETED
+    elif status_str == 'error':
+        status = JobStatus.FAILED
+    else:
+        status = JobStatus.COMPLETED
+
+    outputs = history_item.get('outputs', {})
+    outputs_count, preview_output = get_outputs_summary(outputs)
+
+    execution_error = None
+    execution_start_time = None
+    execution_end_time = None
+    if status_info:
+        messages = status_info.get('messages', [])
+        for entry in messages:
+            if isinstance(entry, (list, tuple)) and len(entry) >= 2:
+                event_name, event_data = entry[0], entry[1]
+                if isinstance(event_data, dict):
+                    if event_name == 'execution_start':
+                        execution_start_time = event_data.get('timestamp')
+                    elif event_name in ('execution_success', 'execution_error', 'execution_interrupted'):
+                        execution_end_time = event_data.get('timestamp')
+                        if event_name == 'execution_error':
+                            execution_error = event_data
+
+    job = prune_dict({
+        'id': prompt_id,
+        'status': status,
+        'priority': priority,
+        'create_time': create_time,
+        'execution_start_time': execution_start_time,
+        'execution_end_time': execution_end_time,
+        'execution_error': execution_error,
+        'outputs_count': outputs_count,
+        'preview_output': preview_output,
+        'workflow_id': workflow_id,
+    })
+
+    if include_outputs:
+        job['outputs'] = outputs
+        job['execution_status'] = status_info
+        job['workflow'] = {
+            'prompt': prompt,
+            'extra_data': extra_data,
+        }
+
+    return job
+
+
+def get_outputs_summary(outputs: dict) -> tuple[int, Optional[dict]]:
+    """
+    Count outputs and find preview in a single pass.
+    Returns (outputs_count, preview_output).
+
+    Preview priority (matching frontend):
+    1. type="output" with previewable media
+    2. Any previewable media
+    """
+    count = 0
+    preview_output = None
+    fallback_preview = None
+
+    for node_id, node_outputs in outputs.items():
+        if not isinstance(node_outputs, dict):
+            continue
+        for media_type, items in node_outputs.items():
+            # 'animated' is a boolean flag, not actual output items
+            if media_type == 'animated' or not isinstance(items, list):
+                continue
+
+            for item in items:
+                if not isinstance(item, dict):
+                    continue
+                count += 1
+
+                if preview_output is None and is_previewable(media_type, item):
+                    enriched = {
+                        **item,
+                        'nodeId': node_id,
+                        'mediaType': media_type
+                    }
+                    if item.get('type') == 'output':
+                        preview_output = enriched
+                    elif fallback_preview is None:
+                        fallback_preview = enriched
+
+    return count, preview_output or fallback_preview
+
+
+def apply_sorting(jobs: list[dict], sort_by: str, sort_order: str) -> list[dict]:
+    """Sort jobs list by specified field and order."""
+    reverse = (sort_order == 'desc')
+
+    if sort_by == 'execution_duration':
+        def get_sort_key(job):
+            start = job.get('execution_start_time', 0)
+            end = job.get('execution_end_time', 0)
+            return end - start if end and start else 0
+    else:
+        def get_sort_key(job):
+            return job.get('create_time', 0)
+
+    return sorted(jobs, key=get_sort_key, reverse=reverse)
+
+
+def get_job(prompt_id: str, running: list, queued: list, history: dict) -> Optional[dict]:
+    """
+    Get a single job by prompt_id from history or queue.
+
+    Args:
+        prompt_id: The prompt ID to look up
+        running: List of currently running queue items
+        queued: List of pending queue items
+        history: Dict of history items keyed by prompt_id
+
+    Returns:
+        Job dict with full details, or None if not found
+    """
+    if prompt_id in history:
+        return normalize_history_item(prompt_id, history[prompt_id], include_outputs=True)
+
+    for item in running:
+        if item[1] == prompt_id:
+            return normalize_queue_item(item, JobStatus.IN_PROGRESS)
+
+    for item in queued:
+        if item[1] == prompt_id:
+            return normalize_queue_item(item, JobStatus.PENDING)
+
+    return None
+
+
+def get_all_jobs(
+    running: list,
+    queued: list,
+    history: dict,
+    status_filter: Optional[list[str]] = None,
+    workflow_id: Optional[str] = None,
+    sort_by: str = "created_at",
+    sort_order: str = "desc",
+    limit: Optional[int] = None,
+    offset: int = 0
+) -> tuple[list[dict], int]:
+    """
+    Get all jobs (running, pending, completed) with filtering and sorting.
+
+    Args:
+        running: List of currently running queue items
+        queued: List of pending queue items
+        history: Dict of history items keyed by prompt_id
+        status_filter: List of statuses to include (from JobStatus.ALL)
+        workflow_id: Filter by workflow ID
+        sort_by: Field to sort by ('created_at', 'execution_duration')
+        sort_order: 'asc' or 'desc'
+        limit: Maximum number of items to return
+        offset: Number of items to skip
+
+    Returns:
+        tuple: (jobs_list, total_count)
+    """
+    jobs = []
+
+    if status_filter is None:
+        status_filter = JobStatus.ALL
+
+    if JobStatus.IN_PROGRESS in status_filter:
+        for item in running:
+            jobs.append(normalize_queue_item(item, JobStatus.IN_PROGRESS))
+
+    if JobStatus.PENDING in status_filter:
+        for item in queued:
+            jobs.append(normalize_queue_item(item, JobStatus.PENDING))
+
+    include_completed = JobStatus.COMPLETED in status_filter
+    include_failed = JobStatus.FAILED in status_filter
+    if include_completed or include_failed:
+        for prompt_id, history_item in history.items():
+            is_failed = history_item.get('status', {}).get('status_str') == 'error'
+            if (is_failed and include_failed) or (not is_failed and include_completed):
+                jobs.append(normalize_history_item(prompt_id, history_item))
+
+    if workflow_id:
+        jobs = [j for j in jobs if j.get('workflow_id') == workflow_id]
+
+    jobs = apply_sorting(jobs, sort_by, sort_order)
+
+    total_count = len(jobs)
+
+    if offset > 0:
+        jobs = jobs[offset:]
+    if limit is not None:
+        jobs = jobs[:limit]
+
+    return (jobs, total_count)
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_dataset.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_dataset.py
index 4789d7d..513aecf 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_dataset.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_dataset.py
@@ -1125,6 +1125,99 @@ class MergeTextListsNode(TextProcessingNode):
 # ========== Training Dataset Nodes ==========
 
 
+class ResolutionBucket(io.ComfyNode):
+    """Bucket latents and conditions by resolution for efficient batch training."""
+
+    @classmethod
+    def define_schema(cls):
+        return io.Schema(
+            node_id="ResolutionBucket",
+            display_name="Resolution Bucket",
+            category="dataset",
+            is_experimental=True,
+            is_input_list=True,
+            inputs=[
+                io.Latent.Input(
+                    "latents",
+                    tooltip="List of latent dicts to bucket by resolution.",
+                ),
+                io.Conditioning.Input(
+                    "conditioning",
+                    tooltip="List of conditioning lists (must match latents length).",
+                ),
+            ],
+            outputs=[
+                io.Latent.Output(
+                    display_name="latents",
+                    is_output_list=True,
+                    tooltip="List of batched latent dicts, one per resolution bucket.",
+                ),
+                io.Conditioning.Output(
+                    display_name="conditioning",
+                    is_output_list=True,
+                    tooltip="List of condition lists, one per resolution bucket.",
+                ),
+            ],
+        )
+
+    @classmethod
+    def execute(cls, latents, conditioning):
+        # latents: list[{"samples": tensor}] where tensor is (B, C, H, W), typically B=1
+        # conditioning: list[list[cond]]
+
+        # Validate lengths match
+        if len(latents) != len(conditioning):
+            raise ValueError(
+                f"Number of latents ({len(latents)}) does not match number of conditions ({len(conditioning)})."
+            )
+
+        # Flatten latents and conditions to individual samples
+        flat_latents = []  # list of (C, H, W) tensors
+        flat_conditions = []  # list of condition lists
+
+        for latent_dict, cond in zip(latents, conditioning):
+            samples = latent_dict["samples"]  # (B, C, H, W)
+            batch_size = samples.shape[0]
+
+            # cond is a list of conditions with length == batch_size
+            for i in range(batch_size):
+                flat_latents.append(samples[i])  # (C, H, W)
+                flat_conditions.append(cond[i])  # single condition
+
+        # Group by resolution (H, W)
+        buckets = {}  # (H, W) -> {"latents": list, "conditions": list}
+
+        for latent, cond in zip(flat_latents, flat_conditions):
+            # latent shape is (..., H, W) (B, C, H, W) or (B, T, C, H ,W)
+            h, w = latent.shape[-2], latent.shape[-1]
+            key = (h, w)
+
+            if key not in buckets:
+                buckets[key] = {"latents": [], "conditions": []}
+
+            buckets[key]["latents"].append(latent)
+            buckets[key]["conditions"].append(cond)
+
+        # Convert buckets to output format
+        output_latents = []  # list[{"samples": tensor}] where tensor is (Bi, ..., H, W)
+        output_conditions = []  # list[list[cond]] where each inner list has Bi conditions
+
+        for (h, w), bucket_data in buckets.items():
+            # Stack latents into batch: list of (..., H, W) -> (Bi, ..., H, W)
+            stacked_latents = torch.stack(bucket_data["latents"], dim=0)
+            output_latents.append({"samples": stacked_latents})
+
+            # Conditions stay as list of condition lists
+            output_conditions.append(bucket_data["conditions"])
+
+            logging.info(
+                f"Resolution bucket ({h}x{w}): {len(bucket_data['latents'])} samples"
+            )
+
+        logging.info(f"Created {len(buckets)} resolution buckets from {len(flat_latents)} samples")
+        return io.NodeOutput(output_latents, output_conditions)
+
+
 class MakeTrainingDataset(io.ComfyNode):
     """Encode images with VAE and texts with CLIP to create a training dataset."""
 
@@ -1373,7 +1466,7 @@ class LoadTrainingDataset(io.ComfyNode):
             shard_path = os.path.join(dataset_dir, shard_file)
 
             with open(shard_path, "rb") as f:
-                shard_data = torch.load(f, weights_only=True)
+                shard_data = torch.load(f)
 
             all_latents.extend(shard_data["latents"])
             all_conditioning.extend(shard_data["conditioning"])
@@ -1425,6 +1518,7 @@ class DatasetExtension(ComfyExtension):
             MakeTrainingDataset,
             SaveTrainingDataset,
             LoadTrainingDataset,
+            ResolutionBucket,
         ]
 
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_latent.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_latent.py
index e439b18..2815c5f 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_latent.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_latent.py
@@ -5,6 +5,7 @@ import nodes
 from typing_extensions import override
 from comfy_api.latest import ComfyExtension, io
 import logging
+import math
 
 def reshape_latent_to(target_shape, latent, repeat_batch=True):
     if latent.shape[1:] != target_shape[1:]:
@@ -207,6 +208,47 @@ class LatentCut(io.ComfyNode):
         samples_out["samples"] = torch.narrow(s1, dim, index, amount)
         return io.NodeOutput(samples_out)
 
+class LatentCutToBatch(io.ComfyNode):
+    @classmethod
+    def define_schema(cls):
+        return io.Schema(
+            node_id="LatentCutToBatch",
+            category="latent/advanced",
+            inputs=[
+                io.Latent.Input("samples"),
+                io.Combo.Input("dim", options=["t", "x", "y"]),
+                io.Int.Input("slice_size", default=1, min=1, max=nodes.MAX_RESOLUTION, step=1),
+            ],
+            outputs=[
+                io.Latent.Output(),
+            ],
+        )
+
+    @classmethod
+    def execute(cls, samples, dim, slice_size) -> io.NodeOutput:
+        samples_out = samples.copy()
+
+        s1 = samples["samples"]
+
+        if "x" in dim:
+            dim = s1.ndim - 1
+        elif "y" in dim:
+            dim = s1.ndim - 2
+        elif "t" in dim:
+            dim = s1.ndim - 3
+
+        if dim < 2:
+            return io.NodeOutput(samples)
+
+        s = s1.movedim(dim, 1)
+        if s.shape[1] < slice_size:
+            slice_size = s.shape[1]
+        elif s.shape[1] % slice_size != 0:
+            s = s[:, :math.floor(s.shape[1] / slice_size) * slice_size]
+        new_shape = [-1, slice_size] + list(s.shape[2:])
+        samples_out["samples"] = s.reshape(new_shape).movedim(1, dim)
+        return io.NodeOutput(samples_out)
+
 class LatentBatch(io.ComfyNode):
     @classmethod
     def define_schema(cls):
@@ -435,6 +477,7 @@ class LatentExtension(ComfyExtension):
             LatentInterpolate,
             LatentConcat,
             LatentCut,
+            LatentCutToBatch,
             LatentBatch,
             LatentBatchSeedBehavior,
             LatentApplyOperation,
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_model_patch.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_model_patch.py
index 2a0cfcf..1355b3c 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_model_patch.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_model_patch.py
@@ -348,7 +348,7 @@ class ZImageControlPatch:
             if self.mask is None:
                 mask_ = torch.zeros_like(inpaint_image_latent)[:, :1]
             else:
-                mask_ = comfy.utils.common_upscale(self.mask.view(self.mask.shape[0], -1, self.mask.shape[-2], self.mask.shape[-1]).mean(dim=1, keepdim=True), inpaint_image_latent.shape[-1], inpaint_image_latent.shape[-2], "nearest", "center")
+                mask_ = comfy.utils.common_upscale(self.mask.view(self.mask.shape[0], -1, self.mask.shape[-2], self.mask.shape[-1]).mean(dim=1, keepdim=True).to(device=inpaint_image_latent.device), inpaint_image_latent.shape[-1], inpaint_image_latent.shape[-2], "nearest", "center")
 
             if latent_image is None:
                 latent_image = comfy.latent_formats.Flux().process_in(self.vae.encode(torch.ones_like(inpaint_image) * 0.5))
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_post_processing.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_post_processing.py
index 34c388a..ca2cdeb 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_post_processing.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_post_processing.py
@@ -221,6 +221,7 @@ class ImageScaleToTotalPixels(io.ComfyNode):
                 io.Image.Input("image"),
                 io.Combo.Input("upscale_method", options=cls.upscale_methods),
                 io.Float.Input("megapixels", default=1.0, min=0.01, max=16.0, step=0.01),
+                io.Int.Input("resolution_steps", default=1, min=1, max=256),
             ],
             outputs=[
                 io.Image.Output(),
@@ -228,15 +229,15 @@ class ImageScaleToTotalPixels(io.ComfyNode):
         )
 
     @classmethod
-    def execute(cls, image, upscale_method, megapixels) -> io.NodeOutput:
+    def execute(cls, image, upscale_method, megapixels, resolution_steps) -> io.NodeOutput:
         samples = image.movedim(-1,1)
-        total = int(megapixels * 1024 * 1024)
+        total = megapixels * 1024 * 1024
 
         scale_by = math.sqrt(total / (samples.shape[3] * samples.shape[2]))
-        width = round(samples.shape[3] * scale_by)
-        height = round(samples.shape[2] * scale_by)
+        width = round(samples.shape[3] * scale_by / resolution_steps) * resolution_steps
+        height = round(samples.shape[2] * scale_by / resolution_steps) * resolution_steps
 
-        s = comfy.utils.common_upscale(samples, width, height, upscale_method, "disabled")
+        s = comfy.utils.common_upscale(samples, int(width), int(height), upscale_method, "disabled")
         s = s.movedim(1,-1)
         return io.NodeOutput(s)
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_qwen.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_qwen.py
index 525239a..fde8fac 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_qwen.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_qwen.py
@@ -3,7 +3,9 @@ import comfy.utils
 import math
 from typing_extensions import override
 from comfy_api.latest import ComfyExtension, io
-
+import comfy.model_management
+import torch
+import nodes
 
 class TextEncodeQwenImageEdit(io.ComfyNode):
     @classmethod
@@ -104,12 +106,37 @@ class TextEncodeQwenImageEditPlus(io.ComfyNode):
         return io.NodeOutput(conditioning)
 
 
+class EmptyQwenImageLayeredLatentImage(io.ComfyNode):
+    @classmethod
+    def define_schema(cls):
+        return io.Schema(
+            node_id="EmptyQwenImageLayeredLatentImage",
+            display_name="Empty Qwen Image Layered Latent",
+            category="latent/qwen",
+            inputs=[
+                io.Int.Input("width", default=640, min=16, max=nodes.MAX_RESOLUTION, step=16),
+                io.Int.Input("height", default=640, min=16, max=nodes.MAX_RESOLUTION, step=16),
+                io.Int.Input("layers", default=3, min=0, max=nodes.MAX_RESOLUTION, step=1),
+                io.Int.Input("batch_size", default=1, min=1, max=4096),
+            ],
+            outputs=[
+                io.Latent.Output(),
+            ],
+        )
+
+    @classmethod
+    def execute(cls, width, height, layers, batch_size=1) -> io.NodeOutput:
+        latent = torch.zeros([batch_size, 16, layers + 1, height // 8, width // 8], device=comfy.model_management.intermediate_device())
+        return io.NodeOutput({"samples": latent})
+
+
 class QwenExtension(ComfyExtension):
     @override
     async def get_node_list(self) -> list[type[io.ComfyNode]]:
         return [
             TextEncodeQwenImageEdit,
             TextEncodeQwenImageEditPlus,
+            EmptyQwenImageLayeredLatentImage,
         ]
 
 
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_train.py b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_train.py
index 19b8baa..3648042 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/comfy_extras/nodes_train.py
+++ b/packages/official-plugins/comfyui/src/comfyui/comfy_extras/nodes_train.py
@@ -10,6 +10,7 @@ from PIL import Image, ImageDraw, ImageFont
 from typing_extensions import override
 
 import comfy.samplers
+import comfy.sampler_helpers
 import comfy.sd
 import comfy.utils
 import comfy.model_management
@@ -21,6 +22,68 @@ from comfy_api.latest import ComfyExtension, io, ui
 from comfy.utils import ProgressBar
 
 
+class TrainGuider(comfy_extras.nodes_custom_sampler.Guider_Basic):
+    """
+    CFGGuider with modifications for training specific logic
+    """
+    def outer_sample(
+        self,
+        noise,
+        latent_image,
+        sampler,
+        sigmas,
+        denoise_mask=None,
+        callback=None,
+        disable_pbar=False,
+        seed=None,
+        latent_shapes=None,
+    ):
+        self.inner_model, self.conds, self.loaded_models = (
+            comfy.sampler_helpers.prepare_sampling(
+                self.model_patcher,
+                noise.shape,
+                self.conds,
+                self.model_options,
+                force_full_load=True,  # mirror behavior in TrainLoraNode.execute() to keep model loaded
+            )
+        )
+        device = self.model_patcher.load_device
+
+        if denoise_mask is not None:
+            denoise_mask = comfy.sampler_helpers.prepare_mask(
+                denoise_mask, noise.shape, device
+            )
+
+        noise = noise.to(device)
+        latent_image = latent_image.to(device)
+        sigmas = sigmas.to(device)
+        comfy.samplers.cast_to_load_options(
+            self.model_options, device=device, dtype=self.model_patcher.model_dtype()
+        )
+
+        try:
+            self.model_patcher.pre_run()
+            output = self.inner_sample(
+                noise,
+                latent_image,
+                device,
+                sampler,
+                sigmas,
+                denoise_mask,
+                callback,
+                disable_pbar,
+                seed,
+                latent_shapes=latent_shapes,
+            )
+        finally:
+            self.model_patcher.cleanup()
+
+        comfy.sampler_helpers.cleanup_models(self.conds, self.loaded_models)
+        del self.inner_model
+        del self.loaded_models
+        return output
+
+
 def make_batch_extra_option_dict(d, indicies, full_size=None):
     new_dict = {}
     for k, v in d.items():
@@ -65,6 +128,7 @@ class TrainSampler(comfy.samplers.Sampler):
         seed=0,
         training_dtype=torch.bfloat16,
         real_dataset=None,
+        bucket_latents=None,
     ):
         self.loss_fn = loss_fn
         self.optimizer = optimizer
@@ -75,6 +139,28 @@ class TrainSampler(comfy.samplers.Sampler):
         self.seed = seed
         self.training_dtype = training_dtype
         self.real_dataset: list[torch.Tensor] | None = real_dataset
+        # Bucket mode data
+        self.bucket_latents: list[torch.Tensor] | None = (
+            bucket_latents  # list of (Bi, C, Hi, Wi)
+        )
+        # Precompute bucket offsets and weights for sampling
+        if bucket_latents is not None:
+            self._init_bucket_data(bucket_latents)
+        else:
+            self.bucket_offsets = None
+            self.bucket_weights = None
+            self.num_images = None
+
+    def _init_bucket_data(self, bucket_latents):
+        """Initialize bucket offsets and weights for sampling."""
+        self.bucket_offsets = [0]
+        bucket_sizes = []
+        for lat in bucket_latents:
+            bucket_sizes.append(lat.shape[0])
+            self.bucket_offsets.append(self.bucket_offsets[-1] + lat.shape[0])
+        self.num_images = self.bucket_offsets[-1]
+        # Weights for sampling buckets proportional to their size
+        self.bucket_weights = torch.tensor(bucket_sizes, dtype=torch.float32)
 
     def fwd_bwd(
         self,
@@ -115,6 +201,108 @@ class TrainSampler(comfy.samplers.Sampler):
             bwd_loss.backward()
         return loss
 
+    def _generate_batch_sigmas(self, model_wrap, batch_size, device):
+        """Generate random sigma values for a batch."""
+        batch_sigmas = [
+            model_wrap.inner_model.model_sampling.percent_to_sigma(
+                torch.rand((1,)).item()
+            )
+            for _ in range(batch_size)
+        ]
+        return torch.tensor(batch_sigmas).to(device)
+
+    def _train_step_bucket_mode(self, model_wrap, cond, extra_args, noisegen, latent_image, pbar):
+        """Execute one training step in bucket mode."""
+        # Sample bucket (weighted by size), then sample batch from bucket
+        bucket_idx = torch.multinomial(self.bucket_weights, 1).item()
+        bucket_latent = self.bucket_latents[bucket_idx]  # (Bi, C, Hi, Wi)
+        bucket_size = bucket_latent.shape[0]
+        bucket_offset = self.bucket_offsets[bucket_idx]
+
+        # Sample indices from this bucket (use all if bucket_size < batch_size)
+        actual_batch_size = min(self.batch_size, bucket_size)
+        relative_indices = torch.randperm(bucket_size)[:actual_batch_size].tolist()
+        # Convert to absolute indices for fwd_bwd (cond is flattened, use absolute index)
+        absolute_indices = [bucket_offset + idx for idx in relative_indices]
+
+        batch_latent = bucket_latent[relative_indices].to(latent_image)  # (actual_batch_size, C, H, W)
+        batch_noise = noisegen.generate_noise({"samples": batch_latent}).to(
+            batch_latent.device
+        )
+        batch_sigmas = self._generate_batch_sigmas(model_wrap, actual_batch_size, batch_latent.device)
+
+        loss = self.fwd_bwd(
+            model_wrap,
+            batch_sigmas,
+            batch_noise,
+            batch_latent,
+            cond,  # Use flattened cond with absolute indices
+            absolute_indices,
+            extra_args,
+            self.num_images,
+            bwd=True,
+        )
+        if self.loss_callback:
+            self.loss_callback(loss.item())
+        pbar.set_postfix({"loss": f"{loss.item():.4f}", "bucket": bucket_idx})
+
+    def _train_step_standard_mode(self, model_wrap, cond, extra_args, noisegen, latent_image, dataset_size, pbar):
+        """Execute one training step in standard (non-bucket, non-multi-res) mode."""
+        indicies = torch.randperm(dataset_size)[: self.batch_size].tolist()
+        batch_latent = torch.stack([latent_image[i] for i in indicies])
+        batch_noise = noisegen.generate_noise({"samples": batch_latent}).to(
+            batch_latent.device
+        )
+        batch_sigmas = self._generate_batch_sigmas(model_wrap, min(self.batch_size, dataset_size), batch_latent.device)
+
+        loss = self.fwd_bwd(
+            model_wrap,
+            batch_sigmas,
+            batch_noise,
+            batch_latent,
+            cond,
+            indicies,
+            extra_args,
+            dataset_size,
+            bwd=True,
+        )
+        if self.loss_callback:
+            self.loss_callback(loss.item())
+        pbar.set_postfix({"loss": f"{loss.item():.4f}"})
+
+    def _train_step_multires_mode(self, model_wrap, cond, extra_args, noisegen, latent_image, dataset_size, pbar):
+        """Execute one training step in multi-resolution mode (real_dataset is set)."""
+        indicies = torch.randperm(dataset_size)[: self.batch_size].tolist()
+        total_loss = 0
+        for index in indicies:
+            single_latent = self.real_dataset[index].to(latent_image)
+            batch_noise = noisegen.generate_noise(
+                {"samples": single_latent}
+            ).to(single_latent.device)
+            batch_sigmas = (
+                model_wrap.inner_model.model_sampling.percent_to_sigma(
+                    torch.rand((1,)).item()
+                )
+            )
+            batch_sigmas = torch.tensor([batch_sigmas]).to(single_latent.device)
+            loss = self.fwd_bwd(
+                model_wrap,
+                batch_sigmas,
+                batch_noise,
+                single_latent,
+                cond,
+                [index],
+                extra_args,
+                dataset_size,
+                bwd=False,
+            )
+            total_loss += loss
+        total_loss = total_loss / self.grad_acc / len(indicies)
+        total_loss.backward()
+        if self.loss_callback:
+            self.loss_callback(total_loss.item())
+        pbar.set_postfix({"loss": f"{total_loss.item():.4f}"})
+
     def sample(
         self,
         model_wrap,
@@ -142,70 +330,18 @@ class TrainSampler(comfy.samplers.Sampler):
             noisegen = comfy_extras.nodes_custom_sampler.Noise_RandomNoise(
                 self.seed + i * 1000
             )
-            indicies = torch.randperm(dataset_size)[: self.batch_size].tolist()
 
-            if self.real_dataset is None:
-                batch_latent = torch.stack([latent_image[i] for i in indicies])
-                batch_noise = noisegen.generate_noise({"samples": batch_latent}).to(
-                    batch_latent.device
-                )
-                batch_sigmas = [
-                    model_wrap.inner_model.model_sampling.percent_to_sigma(
-                        torch.rand((1,)).item()
-                    )
-                    for _ in range(min(self.batch_size, dataset_size))
-                ]
-                batch_sigmas = torch.tensor(batch_sigmas).to(batch_latent.device)
-
-                loss = self.fwd_bwd(
-                    model_wrap,
-                    batch_sigmas,
-                    batch_noise,
-                    batch_latent,
-                    cond,
-                    indicies,
-                    extra_args,
-                    dataset_size,
-                    bwd=True,
-                )
-                if self.loss_callback:
-                    self.loss_callback(loss.item())
-                pbar.set_postfix({"loss": f"{loss.item():.4f}"})
+            if self.bucket_latents is not None:
+                self._train_step_bucket_mode(model_wrap, cond, extra_args, noisegen, latent_image, pbar)
+            elif self.real_dataset is None:
+                self._train_step_standard_mode(model_wrap, cond, extra_args, noisegen, latent_image, dataset_size, pbar)
             else:
-                total_loss = 0
-                for index in indicies:
-                    single_latent = self.real_dataset[index].to(latent_image)
-                    batch_noise = noisegen.generate_noise(
-                        {"samples": single_latent}
-                    ).to(single_latent.device)
-                    batch_sigmas = (
-                        model_wrap.inner_model.model_sampling.percent_to_sigma(
-                            torch.rand((1,)).item()
-                        )
-                    )
-                    batch_sigmas = torch.tensor([batch_sigmas]).to(single_latent.device)
-                    loss = self.fwd_bwd(
-                        model_wrap,
-                        batch_sigmas,
-                        batch_noise,
-                        single_latent,
-                        cond,
-                        [index],
-                        extra_args,
-                        dataset_size,
-                        bwd=False,
-                    )
-                    total_loss += loss
-                total_loss = total_loss / self.grad_acc / len(indicies)
-                total_loss.backward()
-                if self.loss_callback:
-                    self.loss_callback(total_loss.item())
-                pbar.set_postfix({"loss": f"{total_loss.item():.4f}"})
+                self._train_step_multires_mode(model_wrap, cond, extra_args, noisegen, latent_image, dataset_size, pbar)
 
             if (i + 1) % self.grad_acc == 0:
                 self.optimizer.step()
                 self.optimizer.zero_grad()
-                ui_pbar.update(1)
+            ui_pbar.update(1)
         torch.cuda.empty_cache()
         return torch.zeros_like(latent_image)
 
@@ -283,6 +419,364 @@ def unpatch(m):
         del m.org_forward
 
 
+def _process_latents_bucket_mode(latents):
+    """Process latents for bucket mode training.
+
+    Args:
+        latents: list[{"samples": tensor}] where each tensor is (Bi, C, Hi, Wi)
+
+    Returns:
+        list of latent tensors
+    """
+    bucket_latents = []
+    for latent_dict in latents:
+        bucket_latents.append(latent_dict["samples"])  # (Bi, C, Hi, Wi)
+    return bucket_latents
+
+
+def _process_latents_standard_mode(latents):
+    """Process latents for standard (non-bucket) mode training.
+
+    Args:
+        latents: list of latent dicts or single latent dict
+
+    Returns:
+        Processed latents (tensor or list of tensors)
+    """
+    if len(latents) == 1:
+        return latents[0]["samples"]  # Single latent dict
+
+    latent_list = []
+    for latent in latents:
+        latent = latent["samples"]
+        bs = latent.shape[0]
+        if bs != 1:
+            for sub_latent in latent:
+                latent_list.append(sub_latent[None])
+        else:
+            latent_list.append(latent)
+    return latent_list
+
+
+def _process_conditioning(positive):
+    """Process conditioning - either single list or list of lists.
+
+    Args:
+        positive: list of conditioning
+
+    Returns:
+        Flattened conditioning list
+    """
+    if len(positive) == 1:
+        return positive[0]  # Single conditioning list
+
+    # Multiple conditioning lists - flatten
+    flat_positive = []
+    for cond in positive:
+        if isinstance(cond, list):
+            flat_positive.extend(cond)
+        else:
+            flat_positive.append(cond)
+    return flat_positive
+
+
+def _prepare_latents_and_count(latents, dtype, bucket_mode):
+    """Convert latents to dtype and compute image counts.
+
+    Args:
+        latents: Latents (tensor, list of tensors, or bucket list)
+        dtype: Target dtype
+        bucket_mode: Whether bucket mode is enabled
+
+    Returns:
+        tuple: (processed_latents, num_images, multi_res)
+    """
+    if bucket_mode:
+        # In bucket mode, latents is list of tensors (Bi, C, Hi, Wi)
+        latents = [t.to(dtype) for t in latents]
+        num_buckets = len(latents)
+        num_images = sum(t.shape[0] for t in latents)
+        multi_res = False  # Not using multi_res path in bucket mode
+
+        logging.info(f"Bucket mode: {num_buckets} buckets, {num_images} total samples")
+        for i, lat in enumerate(latents):
+            logging.info(f"  Bucket {i}: shape {lat.shape}")
+        return latents, num_images, multi_res
+
+    # Non-bucket mode
+    if isinstance(latents, list):
+        all_shapes = set()
+        latents = [t.to(dtype) for t in latents]
+        for latent in latents:
+            all_shapes.add(latent.shape)
+        logging.info(f"Latent shapes: {all_shapes}")
+        if len(all_shapes) > 1:
+            multi_res = True
+        else:
+            multi_res = False
+            latents = torch.cat(latents, dim=0)
+        num_images = len(latents)
+    elif isinstance(latents, torch.Tensor):
+        latents = latents.to(dtype)
+        num_images = latents.shape[0]
+        multi_res = False
+    else:
+        logging.error(f"Invalid latents type: {type(latents)}")
+        num_images = 0
+        multi_res = False
+
+    return latents, num_images, multi_res
+
+
+def _validate_and_expand_conditioning(positive, num_images, bucket_mode):
+    """Validate conditioning count matches image count, expand if needed.
+
+    Args:
+        positive: Conditioning list
+        num_images: Number of images
+        bucket_mode: Whether bucket mode is enabled
+
+    Returns:
+        Validated/expanded conditioning list
+
+    Raises:
+        ValueError: If conditioning count doesn't match image count
+    """
+    if bucket_mode:
+        return positive  # Skip validation in bucket mode
+
+    logging.info(f"Total Images: {num_images}, Total Captions: {len(positive)}")
+    if len(positive) == 1 and num_images > 1:
+        return positive * num_images
+    elif len(positive) != num_images:
+        raise ValueError(
+            f"Number of positive conditions ({len(positive)}) does not match number of images ({num_images})."
+        )
+    return positive
+
+
+def _load_existing_lora(existing_lora):
+    """Load existing LoRA weights if provided.
+
+    Args:
+        existing_lora: LoRA filename or "[None]"
+
+    Returns:
+        tuple: (existing_weights dict, existing_steps int)
+    """
+    if existing_lora == "[None]":
+        return {}, 0
+
+    lora_path = folder_paths.get_full_path_or_raise("loras", existing_lora)
+    # Extract steps from filename like "trained_lora_10_steps_20250225_203716"
+    existing_steps = int(existing_lora.split("_steps_")[0].split("_")[-1])
+    existing_weights = {}
+    if lora_path:
+        existing_weights = comfy.utils.load_torch_file(lora_path)
+    return existing_weights, existing_steps
+
+
+def _create_weight_adapter(
+    module, module_name, existing_weights, algorithm, lora_dtype, rank
+):
+    """Create a weight adapter for a module with weight.
+
+    Args:
+        module: The module to create adapter for
+        module_name: Name of the module
+        existing_weights: Dict of existing LoRA weights
+        algorithm: Algorithm name for new adapters
+        lora_dtype: dtype for LoRA weights
+        rank: Rank for new LoRA adapters
+
+    Returns:
+        tuple: (train_adapter, lora_params dict)
+    """
+    key = f"{module_name}.weight"
+    shape = module.weight.shape
+    lora_params = {}
+
+    if len(shape) >= 2:
+        alpha = float(existing_weights.get(f"{key}.alpha", 1.0))
+        dora_scale = existing_weights.get(f"{key}.dora_scale", None)
+
+        # Try to load existing adapter
+        existing_adapter = None
+        for adapter_cls in adapters:
+            existing_adapter = adapter_cls.load(
+                module_name, existing_weights, alpha, dora_scale
+            )
+            if existing_adapter is not None:
+                break
+
+        if existing_adapter is None:
+            adapter_cls = adapter_maps[algorithm]
+
+        if existing_adapter is not None:
+            train_adapter = existing_adapter.to_train().to(lora_dtype)
+        else:
+            # Use LoRA with alpha=1.0 by default
+            train_adapter = adapter_cls.create_train(
+                module.weight, rank=rank, alpha=1.0
+            ).to(lora_dtype)
+
+        for name, parameter in train_adapter.named_parameters():
+            lora_params[f"{module_name}.{name}"] = parameter
+
+        return train_adapter.train().requires_grad_(True), lora_params
+    else:
+        # 1D weight - use BiasDiff
+        diff = torch.nn.Parameter(
+            torch.zeros(module.weight.shape, dtype=lora_dtype, requires_grad=True)
+        )
+        diff_module = BiasDiff(diff).train().requires_grad_(True)
+        lora_params[f"{module_name}.diff"] = diff
+        return diff_module, lora_params
+
+
+def _create_bias_adapter(module, module_name, lora_dtype):
+    """Create a bias adapter for a module with bias.
+
+    Args:
+        module: The module with bias
+        module_name: Name of the module
+        lora_dtype: dtype for LoRA weights
+
+    Returns:
+        tuple: (bias_module, lora_params dict)
+    """
+    bias = torch.nn.Parameter(
+        torch.zeros(module.bias.shape, dtype=lora_dtype, requires_grad=True)
+    )
+    bias_module = BiasDiff(bias).train().requires_grad_(True)
+    lora_params = {f"{module_name}.diff_b": bias}
+    return bias_module, lora_params
+
+
+def _setup_lora_adapters(mp, existing_weights, algorithm, lora_dtype, rank):
+    """Setup all LoRA adapters on the model.
+
+    Args:
+        mp: Model patcher
+        existing_weights: Dict of existing LoRA weights
+        algorithm: Algorithm name for new adapters
+        lora_dtype: dtype for LoRA weights
+        rank: Rank for new LoRA adapters
+
+    Returns:
+        tuple: (lora_sd dict, all_weight_adapters list)
+    """
+    lora_sd = {}
+    all_weight_adapters = []
+
+    for n, m in mp.model.named_modules():
+        if hasattr(m, "weight_function"):
+            if m.weight is not None:
+                adapter, params = _create_weight_adapter(
+                    m, n, existing_weights, algorithm, lora_dtype, rank
+                )
+                lora_sd.update(params)
+                key = f"{n}.weight"
+                mp.add_weight_wrapper(key, adapter)
+                all_weight_adapters.append(adapter)
+
+            if hasattr(m, "bias") and m.bias is not None:
+                bias_adapter, bias_params = _create_bias_adapter(m, n, lora_dtype)
+                lora_sd.update(bias_params)
+                key = f"{n}.bias"
+                mp.add_weight_wrapper(key, bias_adapter)
+                all_weight_adapters.append(bias_adapter)
+
+    return lora_sd, all_weight_adapters
+
+
+def _create_optimizer(optimizer_name, parameters, learning_rate):
+    """Create optimizer based on name.
+
+    Args:
+        optimizer_name: Name of optimizer ("Adam", "AdamW", "SGD", "RMSprop")
+        parameters: Parameters to optimize
+        learning_rate: Learning rate
+
+    Returns:
+        Optimizer instance
+    """
+    if optimizer_name == "Adam":
+        return torch.optim.Adam(parameters, lr=learning_rate)
+    elif optimizer_name == "AdamW":
+        return torch.optim.AdamW(parameters, lr=learning_rate)
+    elif optimizer_name == "SGD":
+        return torch.optim.SGD(parameters, lr=learning_rate)
+    elif optimizer_name == "RMSprop":
+        return torch.optim.RMSprop(parameters, lr=learning_rate)
+
+
+def _create_loss_function(loss_function_name):
+    """Create loss function based on name.
+
+    Args:
+        loss_function_name: Name of loss function ("MSE", "L1", "Huber", "SmoothL1")
+
+    Returns:
+        Loss function instance
+    """
+    if loss_function_name == "MSE":
+        return torch.nn.MSELoss()
+    elif loss_function_name == "L1":
+        return torch.nn.L1Loss()
+    elif loss_function_name == "Huber":
+        return torch.nn.HuberLoss()
+    elif loss_function_name == "SmoothL1":
+        return torch.nn.SmoothL1Loss()
+
+
+def _run_training_loop(
+    guider, train_sampler, latents, num_images, seed, bucket_mode, multi_res
+):
+    """Execute the training loop.
+
+    Args:
+        guider: The guider object
+        train_sampler: The training sampler
+        latents: Latent tensors
+        num_images: Number of images
+        seed: Random seed
+        bucket_mode: Whether bucket mode is enabled
+        multi_res: Whether multi-resolution mode is enabled
+    """
+    sigmas = torch.tensor(range(num_images))
+    noise = comfy_extras.nodes_custom_sampler.Noise_RandomNoise(seed)
+
+    if bucket_mode:
+        # Use first bucket's first latent as dummy for guider
+        dummy_latent = latents[0][:1].repeat(num_images, 1, 1, 1)
+        guider.sample(
+            noise.generate_noise({"samples": dummy_latent}),
+            dummy_latent,
+            train_sampler,
+            sigmas,
+            seed=noise.seed,
+        )
+    elif multi_res:
+        # use first latent as dummy latent if multi_res
+        latents = latents[0].repeat(num_images, 1, 1, 1)
+        guider.sample(
+            noise.generate_noise({"samples": latents}),
+            latents,
+            train_sampler,
+            sigmas,
+            seed=noise.seed,
+        )
+    else:
+        guider.sample(
+            noise.generate_noise({"samples": latents}),
+            latents,
+            train_sampler,
+            sigmas,
+            seed=noise.seed,
+        )
+
+
 class TrainLoraNode(io.ComfyNode):
     @classmethod
     def define_schema(cls):
@@ -385,6 +879,11 @@ class TrainLoraNode(io.ComfyNode):
                     default="[None]",
                     tooltip="The existing LoRA to append to. Set to None for new LoRA.",
                 ),
+                io.Boolean.Input(
+                    "bucket_mode",
+                    default=False,
+                    tooltip="Enable resolution bucket mode. When enabled, expects pre-bucketed latents from ResolutionBucket node.",
+                ),
             ],
             outputs=[
                 io.Model.Output(
@@ -419,6 +918,7 @@ class TrainLoraNode(io.ComfyNode):
         algorithm,
         gradient_checkpointing,
         existing_lora,
+        bucket_mode,
     ):
         # Extract scalars from lists (due to is_input_list=True)
         model = model[0]
@@ -427,215 +927,125 @@ class TrainLoraNode(io.ComfyNode):
         grad_accumulation_steps = grad_accumulation_steps[0]
         learning_rate = learning_rate[0]
         rank = rank[0]
-        optimizer = optimizer[0]
-        loss_function = loss_function[0]
+        optimizer_name = optimizer[0]
+        loss_function_name = loss_function[0]
         seed = seed[0]
         training_dtype = training_dtype[0]
         lora_dtype = lora_dtype[0]
         algorithm = algorithm[0]
         gradient_checkpointing = gradient_checkpointing[0]
         existing_lora = existing_lora[0]
+        bucket_mode = bucket_mode[0]
 
-        # Handle latents - either single dict or list of dicts
-        if len(latents) == 1:
-            latents = latents[0]["samples"]  # Single latent dict
-        else:
-            latent_list = []
-            for latent in latents:
-                latent = latent["samples"]
-                bs = latent.shape[0]
-                if bs != 1:
-                    for sub_latent in latent:
-                        latent_list.append(sub_latent[None])
-                else:
-                    latent_list.append(latent)
-            latents = latent_list
-
-        # Handle conditioning - either single list or list of lists
-        if len(positive) == 1:
-            positive = positive[0]  # Single conditioning list
+        # Process latents based on mode
+        if bucket_mode:
+            latents = _process_latents_bucket_mode(latents)
         else:
-            # Multiple conditioning lists - flatten
-            flat_positive = []
-            for cond in positive:
-                if isinstance(cond, list):
-                    flat_positive.extend(cond)
-                else:
-                    flat_positive.append(cond)
-            positive = flat_positive
+            latents = _process_latents_standard_mode(latents)
 
+        # Process conditioning
+        positive = _process_conditioning(positive)
+
+        # Setup model and dtype
         mp = model.clone()
         dtype = node_helpers.string_to_torch_dtype(training_dtype)
         lora_dtype = node_helpers.string_to_torch_dtype(lora_dtype)
         mp.set_model_compute_dtype(dtype)
 
-        # latents here can be list of different size latent or one large batch
-        if isinstance(latents, list):
-            all_shapes = set()
-            latents = [t.to(dtype) for t in latents]
-            for latent in latents:
-                all_shapes.add(latent.shape)
-            logging.info(f"Latent shapes: {all_shapes}")
-            if len(all_shapes) > 1:
-                multi_res = True
-            else:
-                multi_res = False
-                latents = torch.cat(latents, dim=0)
-            num_images = len(latents)
-        elif isinstance(latents, torch.Tensor):
-            latents = latents.to(dtype)
-            num_images = latents.shape[0]
-        else:
-            logging.error(f"Invalid latents type: {type(latents)}")
-
-        logging.info(f"Total Images: {num_images}, Total Captions: {len(positive)}")
-        if len(positive) == 1 and num_images > 1:
-            positive = positive * num_images
-        elif len(positive) != num_images:
-            raise ValueError(
-                f"Number of positive conditions ({len(positive)}) does not match number of images ({num_images})."
-            )
+        # Prepare latents and compute counts
+        latents, num_images, multi_res = _prepare_latents_and_count(
+            latents, dtype, bucket_mode
+        )
+
+        # Validate and expand conditioning
+        positive = _validate_and_expand_conditioning(positive, num_images, bucket_mode)
 
         with torch.inference_mode(False):
-            lora_sd = {}
-            generator = torch.Generator()
-            generator.manual_seed(seed)
+            # Setup models for training
+            mp.model.requires_grad_(False)
 
             # Load existing LoRA weights if provided
-            existing_weights = {}
-            existing_steps = 0
-            if existing_lora != "[None]":
-                lora_path = folder_paths.get_full_path_or_raise("loras", existing_lora)
-                # Extract steps from filename like "trained_lora_10_steps_20250225_203716"
-                existing_steps = int(existing_lora.split("_steps_")[0].split("_")[-1])
-                if lora_path:
-                    existing_weights = comfy.utils.load_torch_file(lora_path)
-
-            all_weight_adapters = []
-            for n, m in mp.model.named_modules():
-                if hasattr(m, "weight_function"):
-                    if m.weight is not None:
-                        key = "{}.weight".format(n)
-                        shape = m.weight.shape
-                        if len(shape) >= 2:
-                            alpha = float(existing_weights.get(f"{key}.alpha", 1.0))
-                            dora_scale = existing_weights.get(f"{key}.dora_scale", None)
-                            for adapter_cls in adapters:
-                                existing_adapter = adapter_cls.load(
-                                    n, existing_weights, alpha, dora_scale
-                                )
-                                if existing_adapter is not None:
-                                    break
-                            else:
-                                existing_adapter = None
-                                adapter_cls = adapter_maps[algorithm]
-
-                            if existing_adapter is not None:
-                                train_adapter = existing_adapter.to_train().to(
-                                    lora_dtype
-                                )
-                            else:
-                                # Use LoRA with alpha=1.0 by default
-                                train_adapter = adapter_cls.create_train(
-                                    m.weight, rank=rank, alpha=1.0
-                                ).to(lora_dtype)
-                            for name, parameter in train_adapter.named_parameters():
-                                lora_sd[f"{n}.{name}"] = parameter
-
-                            mp.add_weight_wrapper(key, train_adapter)
-                            all_weight_adapters.append(train_adapter)
-                        else:
-                            diff = torch.nn.Parameter(
-                                torch.zeros(
-                                    m.weight.shape, dtype=lora_dtype, requires_grad=True
-                                )
-                            )
-                            diff_module = BiasDiff(diff)
-                            mp.add_weight_wrapper(key, BiasDiff(diff))
-                            all_weight_adapters.append(diff_module)
-                            lora_sd["{}.diff".format(n)] = diff
-                    if hasattr(m, "bias") and m.bias is not None:
-                        key = "{}.bias".format(n)
-                        bias = torch.nn.Parameter(
-                            torch.zeros(
-                                m.bias.shape, dtype=lora_dtype, requires_grad=True
-                            )
-                        )
-                        bias_module = BiasDiff(bias)
-                        lora_sd["{}.diff_b".format(n)] = bias
-                        mp.add_weight_wrapper(key, BiasDiff(bias))
-                        all_weight_adapters.append(bias_module)
-
-            if optimizer == "Adam":
-                optimizer = torch.optim.Adam(lora_sd.values(), lr=learning_rate)
-            elif optimizer == "AdamW":
-                optimizer = torch.optim.AdamW(lora_sd.values(), lr=learning_rate)
-            elif optimizer == "SGD":
-                optimizer = torch.optim.SGD(lora_sd.values(), lr=learning_rate)
-            elif optimizer == "RMSprop":
-                optimizer = torch.optim.RMSprop(lora_sd.values(), lr=learning_rate)
-
-            # Setup loss function based on selection
-            if loss_function == "MSE":
-                criterion = torch.nn.MSELoss()
-            elif loss_function == "L1":
-                criterion = torch.nn.L1Loss()
-            elif loss_function == "Huber":
-                criterion = torch.nn.HuberLoss()
-            elif loss_function == "SmoothL1":
-                criterion = torch.nn.SmoothL1Loss()
-
-            # setup models
+            existing_weights, existing_steps = _load_existing_lora(existing_lora)
+
+            # Setup LoRA adapters
+            lora_sd, all_weight_adapters = _setup_lora_adapters(
+                mp, existing_weights, algorithm, lora_dtype, rank
+            )
+
+            # Create optimizer and loss function
+            optimizer = _create_optimizer(
+                optimizer_name, lora_sd.values(), learning_rate
+            )
+            criterion = _create_loss_function(loss_function_name)
+
+            # Setup gradient checkpointing
             if gradient_checkpointing:
                 for m in find_all_highest_child_module_with_forward(
                     mp.model.diffusion_model
                 ):
                     patch(m)
-            mp.model.requires_grad_(False)
+
+            torch.cuda.empty_cache()
+            # With force_full_load=False we should be able to have offloading
+            # But for offloading in training we need custom AutoGrad hooks for fwd/bwd
             comfy.model_management.load_models_gpu(
                 [mp], memory_required=1e20, force_full_load=True
             )
+            torch.cuda.empty_cache()
 
-            # Setup sampler and guider like in test script
+            # Setup loss tracking
             loss_map = {"loss": []}
 
             def loss_callback(loss):
                 loss_map["loss"].append(loss)
 
-            train_sampler = TrainSampler(
-                criterion,
-                optimizer,
-                loss_callback=loss_callback,
-                batch_size=batch_size,
-                grad_acc=grad_accumulation_steps,
-                total_steps=steps * grad_accumulation_steps,
-                seed=seed,
-                training_dtype=dtype,
-                real_dataset=latents if multi_res else None,
-            )
-            guider = comfy_extras.nodes_custom_sampler.Guider_Basic(mp)
-            guider.set_conds(positive)  # Set conditioning from input
+            # Create sampler
+            if bucket_mode:
+                train_sampler = TrainSampler(
+                    criterion,
+                    optimizer,
+                    loss_callback=loss_callback,
+                    batch_size=batch_size,
+                    grad_acc=grad_accumulation_steps,
+                    total_steps=steps * grad_accumulation_steps,
+                    seed=seed,
+                    training_dtype=dtype,
+                    bucket_latents=latents,
+                )
+            else:
+                train_sampler = TrainSampler(
+                    criterion,
+                    optimizer,
+                    loss_callback=loss_callback,
+                    batch_size=batch_size,
+                    grad_acc=grad_accumulation_steps,
+                    total_steps=steps * grad_accumulation_steps,
+                    seed=seed,
+                    training_dtype=dtype,
+                    real_dataset=latents if multi_res else None,
+                )
 
-            # Training loop
+            # Setup guider
+            guider = TrainGuider(mp)
+            guider.set_conds(positive)
+
+            # Run training loop
             try:
-                # Generate dummy sigmas and noise
-                sigmas = torch.tensor(range(num_images))
-                noise = comfy_extras.nodes_custom_sampler.Noise_RandomNoise(seed)
-                if multi_res:
-                    # use first latent as dummy latent if multi_res
-                    latents = latents[0].repeat((num_images,) + ((1,) * (latents[0].ndim - 1)))
-                guider.sample(
-                    noise.generate_noise({"samples": latents}),
-                    latents,
+                _run_training_loop(
+                    guider,
                     train_sampler,
-                    sigmas,
-                    seed=noise.seed,
+                    latents,
+                    num_images,
+                    seed,
+                    bucket_mode,
+                    multi_res,
                 )
             finally:
                 for m in mp.model.modules():
                     unpatch(m)
             del train_sampler, optimizer
 
+            # Finalize adapters
             for adapter in all_weight_adapters:
                 adapter.requires_grad_(False)
 
@@ -645,7 +1055,7 @@ class TrainLoraNode(io.ComfyNode):
             return io.NodeOutput(mp, lora_sd, loss_map, steps + existing_steps)
 
 
-class LoraModelLoader(io.ComfyNode):
+class LoraModelLoader(io.ComfyNode):#
     @classmethod
     def define_schema(cls):
         return io.Schema(
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/HEAD b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/HEAD
deleted file mode 100644
index b870d82..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/HEAD
+++ /dev/null
@@ -1 +0,0 @@
-ref: refs/heads/main
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/config b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/config
deleted file mode 100644
index b72e30a..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/config
+++ /dev/null
@@ -1,13 +0,0 @@
-[core]
-	repositoryformatversion = 0
-	filemode = true
-	bare = false
-	logallrefupdates = true
-	ignorecase = true
-	precomposeunicode = true
-[remote "origin"]
-	url = https://github.com/Acly/comfyui-inpaint-nodes.git
-	fetch = +refs/heads/*:refs/remotes/origin/*
-[branch "main"]
-	remote = origin
-	merge = refs/heads/main
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/description b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/description
deleted file mode 100644
index 498b267..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/description
+++ /dev/null
@@ -1 +0,0 @@
-Unnamed repository; edit this file 'description' to name the repository.
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/applypatch-msg.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/applypatch-msg.sample
deleted file mode 100755
index a5d7b84..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/applypatch-msg.sample
+++ /dev/null
@@ -1,15 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to check the commit log message taken by
-# applypatch from an e-mail message.
-#
-# The hook should exit with non-zero status after issuing an
-# appropriate message if it wants to stop the commit.  The hook is
-# allowed to edit the commit message file.
-#
-# To enable this hook, rename this file to "applypatch-msg".
-
-. git-sh-setup
-commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
-test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
-:
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/commit-msg.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/commit-msg.sample
deleted file mode 100755
index b58d118..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/commit-msg.sample
+++ /dev/null
@@ -1,24 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to check the commit log message.
-# Called by "git commit" with one argument, the name of the file
-# that has the commit message.  The hook should exit with non-zero
-# status after issuing an appropriate message if it wants to stop the
-# commit.  The hook is allowed to edit the commit message file.
-#
-# To enable this hook, rename this file to "commit-msg".
-
-# Uncomment the below to add a Signed-off-by line to the message.
-# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
-# hook is more suited to it.
-#
-# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
-# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"
-
-# This example catches duplicate Signed-off-by lines.
-
-test "" = "$(grep '^Signed-off-by: ' "$1" |
-	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
-	echo >&2 Duplicate Signed-off-by lines.
-	exit 1
-}
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/fsmonitor-watchman.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/fsmonitor-watchman.sample
deleted file mode 100755
index 23e856f..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/fsmonitor-watchman.sample
+++ /dev/null
@@ -1,174 +0,0 @@
-#!/usr/bin/perl
-
-use strict;
-use warnings;
-use IPC::Open2;
-
-# An example hook script to integrate Watchman
-# (https://facebook.github.io/watchman/) with git to speed up detecting
-# new and modified files.
-#
-# The hook is passed a version (currently 2) and last update token
-# formatted as a string and outputs to stdout a new update token and
-# all files that have been modified since the update token. Paths must
-# be relative to the root of the working tree and separated by a single NUL.
-#
-# To enable this hook, rename this file to "query-watchman" and set
-# 'git config core.fsmonitor .git/hooks/query-watchman'
-#
-my ($version, $last_update_token) = @ARGV;
-
-# Uncomment for debugging
-# print STDERR "$0 $version $last_update_token\n";
-
-# Check the hook interface version
-if ($version ne 2) {
-	die "Unsupported query-fsmonitor hook version '$version'.\n" .
-	    "Falling back to scanning...\n";
-}
-
-my $git_work_tree = get_working_dir();
-
-my $retry = 1;
-
-my $json_pkg;
-eval {
-	require JSON::XS;
-	$json_pkg = "JSON::XS";
-	1;
-} or do {
-	require JSON::PP;
-	$json_pkg = "JSON::PP";
-};
-
-launch_watchman();
-
-sub launch_watchman {
-	my $o = watchman_query();
-	if (is_work_tree_watched($o)) {
-		output_result($o->{clock}, @{$o->{files}});
-	}
-}
-
-sub output_result {
-	my ($clockid, @files) = @_;
-
-	# Uncomment for debugging watchman output
-	# open (my $fh, ">", ".git/watchman-output.out");
-	# binmode $fh, ":utf8";
-	# print $fh "$clockid\n@files\n";
-	# close $fh;
-
-	binmode STDOUT, ":utf8";
-	print $clockid;
-	print "\0";
-	local $, = "\0";
-	print @files;
-}
-
-sub watchman_clock {
-	my $response = qx/watchman clock "$git_work_tree"/;
-	die "Failed to get clock id on '$git_work_tree'.\n" .
-		"Falling back to scanning...\n" if $? != 0;
-
-	return $json_pkg->new->utf8->decode($response);
-}
-
-sub watchman_query {
-	my $pid = open2(\*CHLD_OUT, \*CHLD_IN, 'watchman -j --no-pretty')
-	or die "open2() failed: $!\n" .
-	"Falling back to scanning...\n";
-
-	# In the query expression below we're asking for names of files that
-	# changed since $last_update_token but not from the .git folder.
-	#
-	# To accomplish this, we're using the "since" generator to use the
-	# recency index to select candidate nodes and "fields" to limit the
-	# output to file names only. Then we're using the "expression" term to
-	# further constrain the results.
-	my $last_update_line = "";
-	if (substr($last_update_token, 0, 1) eq "c") {
-		$last_update_token = "\"$last_update_token\"";
-		$last_update_line = qq[\n"since": $last_update_token,];
-	}
-	my $query = <<"	END";
-		["query", "$git_work_tree", {$last_update_line
-			"fields": ["name"],
-			"expression": ["not", ["dirname", ".git"]]
-		}]
-	END
-
-	# Uncomment for debugging the watchman query
-	# open (my $fh, ">", ".git/watchman-query.json");
-	# print $fh $query;
-	# close $fh;
-
-	print CHLD_IN $query;
-	close CHLD_IN;
-	my $response = do {local $/; <CHLD_OUT>};
-
-	# Uncomment for debugging the watch response
-	# open ($fh, ">", ".git/watchman-response.json");
-	# print $fh $response;
-	# close $fh;
-
-	die "Watchman: command returned no output.\n" .
-	"Falling back to scanning...\n" if $response eq "";
-	die "Watchman: command returned invalid output: $response\n" .
-	"Falling back to scanning...\n" unless $response =~ /^\{/;
-
-	return $json_pkg->new->utf8->decode($response);
-}
-
-sub is_work_tree_watched {
-	my ($output) = @_;
-	my $error = $output->{error};
-	if ($retry > 0 and $error and $error =~ m/unable to resolve root .* directory (.*) is not watched/) {
-		$retry--;
-		my $response = qx/watchman watch "$git_work_tree"/;
-		die "Failed to make watchman watch '$git_work_tree'.\n" .
-		    "Falling back to scanning...\n" if $? != 0;
-		$output = $json_pkg->new->utf8->decode($response);
-		$error = $output->{error};
-		die "Watchman: $error.\n" .
-		"Falling back to scanning...\n" if $error;
-
-		# Uncomment for debugging watchman output
-		# open (my $fh, ">", ".git/watchman-output.out");
-		# close $fh;
-
-		# Watchman will always return all files on the first query so
-		# return the fast "everything is dirty" flag to git and do the
-		# Watchman query just to get it over with now so we won't pay
-		# the cost in git to look up each individual file.
-		my $o = watchman_clock();
-		$error = $output->{error};
-
-		die "Watchman: $error.\n" .
-		"Falling back to scanning...\n" if $error;
-
-		output_result($o->{clock}, ("/"));
-		$last_update_token = $o->{clock};
-
-		eval { launch_watchman() };
-		return 0;
-	}
-
-	die "Watchman: $error.\n" .
-	"Falling back to scanning...\n" if $error;
-
-	return 1;
-}
-
-sub get_working_dir {
-	my $working_dir;
-	if ($^O =~ 'msys' || $^O =~ 'cygwin') {
-		$working_dir = Win32::GetCwd();
-		$working_dir =~ tr/\\/\//;
-	} else {
-		require Cwd;
-		$working_dir = Cwd::cwd();
-	}
-
-	return $working_dir;
-}
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/post-update.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/post-update.sample
deleted file mode 100755
index ec17ec1..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/post-update.sample
+++ /dev/null
@@ -1,8 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to prepare a packed repository for use over
-# dumb transports.
-#
-# To enable this hook, rename this file to "post-update".
-
-exec git update-server-info
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-applypatch.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-applypatch.sample
deleted file mode 100755
index 4142082..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-applypatch.sample
+++ /dev/null
@@ -1,14 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to verify what is about to be committed
-# by applypatch from an e-mail message.
-#
-# The hook should exit with non-zero status after issuing an
-# appropriate message if it wants to stop the commit.
-#
-# To enable this hook, rename this file to "pre-applypatch".
-
-. git-sh-setup
-precommit="$(git rev-parse --git-path hooks/pre-commit)"
-test -x "$precommit" && exec "$precommit" ${1+"$@"}
-:
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-commit.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-commit.sample
deleted file mode 100755
index 29ed5ee..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-commit.sample
+++ /dev/null
@@ -1,49 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to verify what is about to be committed.
-# Called by "git commit" with no arguments.  The hook should
-# exit with non-zero status after issuing an appropriate message if
-# it wants to stop the commit.
-#
-# To enable this hook, rename this file to "pre-commit".
-
-if git rev-parse --verify HEAD >/dev/null 2>&1
-then
-	against=HEAD
-else
-	# Initial commit: diff against an empty tree object
-	against=$(git hash-object -t tree /dev/null)
-fi
-
-# If you want to allow non-ASCII filenames set this variable to true.
-allownonascii=$(git config --type=bool hooks.allownonascii)
-
-# Redirect output to stderr.
-exec 1>&2
-
-# Cross platform projects tend to avoid non-ASCII filenames; prevent
-# them from being added to the repository. We exploit the fact that the
-# printable range starts at the space character and ends with tilde.
-if [ "$allownonascii" != "true" ] &&
-	# Note that the use of brackets around a tr range is ok here, (it's
-	# even required, for portability to Solaris 10's /usr/bin/tr), since
-	# the square bracket bytes happen to fall in the designated range.
-	test $(git diff-index --cached --name-only --diff-filter=A -z $against |
-	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
-then
-	cat <<\EOF
-Error: Attempt to add a non-ASCII file name.
-
-This can cause problems if you want to work with people on other platforms.
-
-To be portable it is advisable to rename the file.
-
-If you know what you are doing you can disable this check using:
-
-  git config hooks.allownonascii true
-EOF
-	exit 1
-fi
-
-# If there are whitespace errors, print the offending file names and fail.
-exec git diff-index --check --cached $against --
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-merge-commit.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-merge-commit.sample
deleted file mode 100755
index 399eab1..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-merge-commit.sample
+++ /dev/null
@@ -1,13 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to verify what is about to be committed.
-# Called by "git merge" with no arguments.  The hook should
-# exit with non-zero status after issuing an appropriate message to
-# stderr if it wants to stop the merge commit.
-#
-# To enable this hook, rename this file to "pre-merge-commit".
-
-. git-sh-setup
-test -x "$GIT_DIR/hooks/pre-commit" &&
-        exec "$GIT_DIR/hooks/pre-commit"
-:
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-push.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-push.sample
deleted file mode 100755
index 4ce688d..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-push.sample
+++ /dev/null
@@ -1,53 +0,0 @@
-#!/bin/sh
-
-# An example hook script to verify what is about to be pushed.  Called by "git
-# push" after it has checked the remote status, but before anything has been
-# pushed.  If this script exits with a non-zero status nothing will be pushed.
-#
-# This hook is called with the following parameters:
-#
-# $1 -- Name of the remote to which the push is being done
-# $2 -- URL to which the push is being done
-#
-# If pushing without using a named remote those arguments will be equal.
-#
-# Information about the commits which are being pushed is supplied as lines to
-# the standard input in the form:
-#
-#   <local ref> <local oid> <remote ref> <remote oid>
-#
-# This sample shows how to prevent push of commits where the log message starts
-# with "WIP" (work in progress).
-
-remote="$1"
-url="$2"
-
-zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')
-
-while read local_ref local_oid remote_ref remote_oid
-do
-	if test "$local_oid" = "$zero"
-	then
-		# Handle delete
-		:
-	else
-		if test "$remote_oid" = "$zero"
-		then
-			# New branch, examine all commits
-			range="$local_oid"
-		else
-			# Update to existing branch, examine new commits
-			range="$remote_oid..$local_oid"
-		fi
-
-		# Check for WIP commit
-		commit=$(git rev-list -n 1 --grep '^WIP' "$range")
-		if test -n "$commit"
-		then
-			echo >&2 "Found WIP commit in $local_ref, not pushing"
-			exit 1
-		fi
-	fi
-done
-
-exit 0
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-rebase.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-rebase.sample
deleted file mode 100755
index 6cbef5c..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-rebase.sample
+++ /dev/null
@@ -1,169 +0,0 @@
-#!/bin/sh
-#
-# Copyright (c) 2006, 2008 Junio C Hamano
-#
-# The "pre-rebase" hook is run just before "git rebase" starts doing
-# its job, and can prevent the command from running by exiting with
-# non-zero status.
-#
-# The hook is called with the following parameters:
-#
-# $1 -- the upstream the series was forked from.
-# $2 -- the branch being rebased (or empty when rebasing the current branch).
-#
-# This sample shows how to prevent topic branches that are already
-# merged to 'next' branch from getting rebased, because allowing it
-# would result in rebasing already published history.
-
-publish=next
-basebranch="$1"
-if test "$#" = 2
-then
-	topic="refs/heads/$2"
-else
-	topic=`git symbolic-ref HEAD` ||
-	exit 0 ;# we do not interrupt rebasing detached HEAD
-fi
-
-case "$topic" in
-refs/heads/??/*)
-	;;
-*)
-	exit 0 ;# we do not interrupt others.
-	;;
-esac
-
-# Now we are dealing with a topic branch being rebased
-# on top of master.  Is it OK to rebase it?
-
-# Does the topic really exist?
-git show-ref -q "$topic" || {
-	echo >&2 "No such branch $topic"
-	exit 1
-}
-
-# Is topic fully merged to master?
-not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
-if test -z "$not_in_master"
-then
-	echo >&2 "$topic is fully merged to master; better remove it."
-	exit 1 ;# we could allow it, but there is no point.
-fi
-
-# Is topic ever merged to next?  If so you should not be rebasing it.
-only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
-only_next_2=`git rev-list ^master           ${publish} | sort`
-if test "$only_next_1" = "$only_next_2"
-then
-	not_in_topic=`git rev-list "^$topic" master`
-	if test -z "$not_in_topic"
-	then
-		echo >&2 "$topic is already up to date with master"
-		exit 1 ;# we could allow it, but there is no point.
-	else
-		exit 0
-	fi
-else
-	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
-	/usr/bin/perl -e '
-		my $topic = $ARGV[0];
-		my $msg = "* $topic has commits already merged to public branch:\n";
-		my (%not_in_next) = map {
-			/^([0-9a-f]+) /;
-			($1 => 1);
-		} split(/\n/, $ARGV[1]);
-		for my $elem (map {
-				/^([0-9a-f]+) (.*)$/;
-				[$1 => $2];
-			} split(/\n/, $ARGV[2])) {
-			if (!exists $not_in_next{$elem->[0]}) {
-				if ($msg) {
-					print STDERR $msg;
-					undef $msg;
-				}
-				print STDERR " $elem->[1]\n";
-			}
-		}
-	' "$topic" "$not_in_next" "$not_in_master"
-	exit 1
-fi
-
-<<\DOC_END
-
-This sample hook safeguards topic branches that have been
-published from being rewound.
-
-The workflow assumed here is:
-
- * Once a topic branch forks from "master", "master" is never
-   merged into it again (either directly or indirectly).
-
- * Once a topic branch is fully cooked and merged into "master",
-   it is deleted.  If you need to build on top of it to correct
-   earlier mistakes, a new topic branch is created by forking at
-   the tip of the "master".  This is not strictly necessary, but
-   it makes it easier to keep your history simple.
-
- * Whenever you need to test or publish your changes to topic
-   branches, merge them into "next" branch.
-
-The script, being an example, hardcodes the publish branch name
-to be "next", but it is trivial to make it configurable via
-$GIT_DIR/config mechanism.
-
-With this workflow, you would want to know:
-
-(1) ... if a topic branch has ever been merged to "next".  Young
-    topic branches can have stupid mistakes you would rather
-    clean up before publishing, and things that have not been
-    merged into other branches can be easily rebased without
-    affecting other people.  But once it is published, you would
-    not want to rewind it.
-
-(2) ... if a topic branch has been fully merged to "master".
-    Then you can delete it.  More importantly, you should not
-    build on top of it -- other people may already want to
-    change things related to the topic as patches against your
-    "master", so if you need further changes, it is better to
-    fork the topic (perhaps with the same name) afresh from the
-    tip of "master".
-
-Let's look at this example:
-
-		   o---o---o---o---o---o---o---o---o---o "next"
-		  /       /           /           /
-		 /   a---a---b A     /           /
-		/   /               /           /
-	       /   /   c---c---c---c B         /
-	      /   /   /             \         /
-	     /   /   /   b---b C     \       /
-	    /   /   /   /             \     /
-    ---o---o---o---o---o---o---o---o---o---o---o "master"
-
-
-A, B and C are topic branches.
-
- * A has one fix since it was merged up to "next".
-
- * B has finished.  It has been fully merged up to "master" and "next",
-   and is ready to be deleted.
-
- * C has not merged to "next" at all.
-
-We would want to allow C to be rebased, refuse A, and encourage
-B to be deleted.
-
-To compute (1):
-
-	git rev-list ^master ^topic next
-	git rev-list ^master        next
-
-	if these match, topic has not merged in next at all.
-
-To compute (2):
-
-	git rev-list master..topic
-
-	if this is empty, it is fully merged to "master".
-
-DOC_END
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-receive.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-receive.sample
deleted file mode 100755
index a1fd29e..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/pre-receive.sample
+++ /dev/null
@@ -1,24 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to make use of push options.
-# The example simply echoes all push options that start with 'echoback='
-# and rejects all pushes when the "reject" push option is used.
-#
-# To enable this hook, rename this file to "pre-receive".
-
-if test -n "$GIT_PUSH_OPTION_COUNT"
-then
-	i=0
-	while test "$i" -lt "$GIT_PUSH_OPTION_COUNT"
-	do
-		eval "value=\$GIT_PUSH_OPTION_$i"
-		case "$value" in
-		echoback=*)
-			echo "echo from the pre-receive-hook: ${value#*=}" >&2
-			;;
-		reject)
-			exit 1
-		esac
-		i=$((i + 1))
-	done
-fi
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/prepare-commit-msg.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/prepare-commit-msg.sample
deleted file mode 100755
index 10fa14c..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/prepare-commit-msg.sample
+++ /dev/null
@@ -1,42 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to prepare the commit log message.
-# Called by "git commit" with the name of the file that has the
-# commit message, followed by the description of the commit
-# message's source.  The hook's purpose is to edit the commit
-# message file.  If the hook fails with a non-zero status,
-# the commit is aborted.
-#
-# To enable this hook, rename this file to "prepare-commit-msg".
-
-# This hook includes three examples. The first one removes the
-# "# Please enter the commit message..." help message.
-#
-# The second includes the output of "git diff --name-status -r"
-# into the message, just before the "git status" output.  It is
-# commented because it doesn't cope with --amend or with squashed
-# commits.
-#
-# The third example adds a Signed-off-by line to the message, that can
-# still be edited.  This is rarely a good idea.
-
-COMMIT_MSG_FILE=$1
-COMMIT_SOURCE=$2
-SHA1=$3
-
-/usr/bin/perl -i.bak -ne 'print unless(m/^. Please enter the commit message/..m/^#$/)' "$COMMIT_MSG_FILE"
-
-# case "$COMMIT_SOURCE,$SHA1" in
-#  ,|template,)
-#    /usr/bin/perl -i.bak -pe '
-#       print "\n" . `git diff --cached --name-status -r`
-# 	 if /^#/ && $first++ == 0' "$COMMIT_MSG_FILE" ;;
-#  *) ;;
-# esac
-
-# SOB=$(git var GIT_COMMITTER_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
-# git interpret-trailers --in-place --trailer "$SOB" "$COMMIT_MSG_FILE"
-# if test -z "$COMMIT_SOURCE"
-# then
-#   /usr/bin/perl -i.bak -pe 'print "\n" if !$first_line++' "$COMMIT_MSG_FILE"
-# fi
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/push-to-checkout.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/push-to-checkout.sample
deleted file mode 100755
index af5a0c0..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/push-to-checkout.sample
+++ /dev/null
@@ -1,78 +0,0 @@
-#!/bin/sh
-
-# An example hook script to update a checked-out tree on a git push.
-#
-# This hook is invoked by git-receive-pack(1) when it reacts to git
-# push and updates reference(s) in its repository, and when the push
-# tries to update the branch that is currently checked out and the
-# receive.denyCurrentBranch configuration variable is set to
-# updateInstead.
-#
-# By default, such a push is refused if the working tree and the index
-# of the remote repository has any difference from the currently
-# checked out commit; when both the working tree and the index match
-# the current commit, they are updated to match the newly pushed tip
-# of the branch. This hook is to be used to override the default
-# behaviour; however the code below reimplements the default behaviour
-# as a starting point for convenient modification.
-#
-# The hook receives the commit with which the tip of the current
-# branch is going to be updated:
-commit=$1
-
-# It can exit with a non-zero status to refuse the push (when it does
-# so, it must not modify the index or the working tree).
-die () {
-	echo >&2 "$*"
-	exit 1
-}
-
-# Or it can make any necessary changes to the working tree and to the
-# index to bring them to the desired state when the tip of the current
-# branch is updated to the new commit, and exit with a zero status.
-#
-# For example, the hook can simply run git read-tree -u -m HEAD "$1"
-# in order to emulate git fetch that is run in the reverse direction
-# with git push, as the two-tree form of git read-tree -u -m is
-# essentially the same as git switch or git checkout that switches
-# branches while keeping the local changes in the working tree that do
-# not interfere with the difference between the branches.
-
-# The below is a more-or-less exact translation to shell of the C code
-# for the default behaviour for git's push-to-checkout hook defined in
-# the push_to_deploy() function in builtin/receive-pack.c.
-#
-# Note that the hook will be executed from the repository directory,
-# not from the working tree, so if you want to perform operations on
-# the working tree, you will have to adapt your code accordingly, e.g.
-# by adding "cd .." or using relative paths.
-
-if ! git update-index -q --ignore-submodules --refresh
-then
-	die "Up-to-date check failed"
-fi
-
-if ! git diff-files --quiet --ignore-submodules --
-then
-	die "Working directory has unstaged changes"
-fi
-
-# This is a rough translation of:
-#
-#   head_has_history() ? "HEAD" : EMPTY_TREE_SHA1_HEX
-if git cat-file -e HEAD 2>/dev/null
-then
-	head=HEAD
-else
-	head=$(git hash-object -t tree --stdin </dev/null)
-fi
-
-if ! git diff-index --quiet --cached --ignore-submodules $head --
-then
-	die "Working directory has staged changes"
-fi
-
-if ! git read-tree -u -m "$commit"
-then
-	die "Could not update working tree to new HEAD"
-fi
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/sendemail-validate.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/sendemail-validate.sample
deleted file mode 100755
index 640bcf8..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/sendemail-validate.sample
+++ /dev/null
@@ -1,77 +0,0 @@
-#!/bin/sh
-
-# An example hook script to validate a patch (and/or patch series) before
-# sending it via email.
-#
-# The hook should exit with non-zero status after issuing an appropriate
-# message if it wants to prevent the email(s) from being sent.
-#
-# To enable this hook, rename this file to "sendemail-validate".
-#
-# By default, it will only check that the patch(es) can be applied on top of
-# the default upstream branch without conflicts in a secondary worktree. After
-# validation (successful or not) of the last patch of a series, the worktree
-# will be deleted.
-#
-# The following config variables can be set to change the default remote and
-# remote ref that are used to apply the patches against:
-#
-#   sendemail.validateRemote (default: origin)
-#   sendemail.validateRemoteRef (default: HEAD)
-#
-# Replace the TODO placeholders with appropriate checks according to your
-# needs.
-
-validate_cover_letter () {
-	file="$1"
-	# TODO: Replace with appropriate checks (e.g. spell checking).
-	true
-}
-
-validate_patch () {
-	file="$1"
-	# Ensure that the patch applies without conflicts.
-	git am -3 "$file" || return
-	# TODO: Replace with appropriate checks for this patch
-	# (e.g. checkpatch.pl).
-	true
-}
-
-validate_series () {
-	# TODO: Replace with appropriate checks for the whole series
-	# (e.g. quick build, coding style checks, etc.).
-	true
-}
-
-# main -------------------------------------------------------------------------
-
-if test "$GIT_SENDEMAIL_FILE_COUNTER" = 1
-then
-	remote=$(git config --default origin --get sendemail.validateRemote) &&
-	ref=$(git config --default HEAD --get sendemail.validateRemoteRef) &&
-	worktree=$(mktemp --tmpdir -d sendemail-validate.XXXXXXX) &&
-	git worktree add -fd --checkout "$worktree" "refs/remotes/$remote/$ref" &&
-	git config --replace-all sendemail.validateWorktree "$worktree"
-else
-	worktree=$(git config --get sendemail.validateWorktree)
-fi || {
-	echo "sendemail-validate: error: failed to prepare worktree" >&2
-	exit 1
-}
-
-unset GIT_DIR GIT_WORK_TREE
-cd "$worktree" &&
-
-if grep -q "^diff --git " "$1"
-then
-	validate_patch "$1"
-else
-	validate_cover_letter "$1"
-fi &&
-
-if test "$GIT_SENDEMAIL_FILE_COUNTER" = "$GIT_SENDEMAIL_FILE_TOTAL"
-then
-	git config --unset-all sendemail.validateWorktree &&
-	trap 'git worktree remove -ff "$worktree"' EXIT &&
-	validate_series
-fi
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/update.sample b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/update.sample
deleted file mode 100755
index c4d426b..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/hooks/update.sample
+++ /dev/null
@@ -1,128 +0,0 @@
-#!/bin/sh
-#
-# An example hook script to block unannotated tags from entering.
-# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
-#
-# To enable this hook, rename this file to "update".
-#
-# Config
-# ------
-# hooks.allowunannotated
-#   This boolean sets whether unannotated tags will be allowed into the
-#   repository.  By default they won't be.
-# hooks.allowdeletetag
-#   This boolean sets whether deleting tags will be allowed in the
-#   repository.  By default they won't be.
-# hooks.allowmodifytag
-#   This boolean sets whether a tag may be modified after creation. By default
-#   it won't be.
-# hooks.allowdeletebranch
-#   This boolean sets whether deleting branches will be allowed in the
-#   repository.  By default they won't be.
-# hooks.denycreatebranch
-#   This boolean sets whether remotely creating branches will be denied
-#   in the repository.  By default this is allowed.
-#
-
-# --- Command line
-refname="$1"
-oldrev="$2"
-newrev="$3"
-
-# --- Safety check
-if [ -z "$GIT_DIR" ]; then
-	echo "Don't run this script from the command line." >&2
-	echo " (if you want, you could supply GIT_DIR then run" >&2
-	echo "  $0 <ref> <oldrev> <newrev>)" >&2
-	exit 1
-fi
-
-if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
-	echo "usage: $0 <ref> <oldrev> <newrev>" >&2
-	exit 1
-fi
-
-# --- Config
-allowunannotated=$(git config --type=bool hooks.allowunannotated)
-allowdeletebranch=$(git config --type=bool hooks.allowdeletebranch)
-denycreatebranch=$(git config --type=bool hooks.denycreatebranch)
-allowdeletetag=$(git config --type=bool hooks.allowdeletetag)
-allowmodifytag=$(git config --type=bool hooks.allowmodifytag)
-
-# check for no description
-projectdesc=$(sed -e '1q' "$GIT_DIR/description")
-case "$projectdesc" in
-"Unnamed repository"* | "")
-	echo "*** Project description file hasn't been set" >&2
-	exit 1
-	;;
-esac
-
-# --- Check types
-# if $newrev is 0000...0000, it's a commit to delete a ref.
-zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')
-if [ "$newrev" = "$zero" ]; then
-	newrev_type=delete
-else
-	newrev_type=$(git cat-file -t $newrev)
-fi
-
-case "$refname","$newrev_type" in
-	refs/tags/*,commit)
-		# un-annotated tag
-		short_refname=${refname##refs/tags/}
-		if [ "$allowunannotated" != "true" ]; then
-			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
-			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
-			exit 1
-		fi
-		;;
-	refs/tags/*,delete)
-		# delete tag
-		if [ "$allowdeletetag" != "true" ]; then
-			echo "*** Deleting a tag is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/tags/*,tag)
-		# annotated tag
-		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
-		then
-			echo "*** Tag '$refname' already exists." >&2
-			echo "*** Modifying a tag is not allowed in this repository." >&2
-			exit 1
-		fi
-		;;
-	refs/heads/*,commit)
-		# branch
-		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
-			echo "*** Creating a branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/heads/*,delete)
-		# delete branch
-		if [ "$allowdeletebranch" != "true" ]; then
-			echo "*** Deleting a branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	refs/remotes/*,commit)
-		# tracking branch
-		;;
-	refs/remotes/*,delete)
-		# delete tracking branch
-		if [ "$allowdeletebranch" != "true" ]; then
-			echo "*** Deleting a tracking branch is not allowed in this repository" >&2
-			exit 1
-		fi
-		;;
-	*)
-		# Anything else (is there anything else?)
-		echo "*** Update hook: unknown type of update to ref $refname of type $newrev_type" >&2
-		exit 1
-		;;
-esac
-
-# --- Finished
-exit 0
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/index b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/index
deleted file mode 100644
index 45dd95a..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/index and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/info/exclude b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/info/exclude
deleted file mode 100644
index a5196d1..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/info/exclude
+++ /dev/null
@@ -1,6 +0,0 @@
-# git ls-files --others --exclude-from=.git/info/exclude
-# Lines that start with '#' are comments.
-# For a project mostly in C, the following would be a good set of
-# exclude patterns (uncomment them if you want to use them):
-# *.[oa]
-# *~
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/HEAD b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/HEAD
deleted file mode 100644
index c082dce..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/HEAD
+++ /dev/null
@@ -1 +0,0 @@
-0000000000000000000000000000000000000000 1e2543e5619b3f6e88b7727243c8b9c5791a7b4a BoyCoder <chaxiu@users.noreply.github.com> 1766586759 +0800	clone: from https://github.com/Acly/comfyui-inpaint-nodes.git
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/heads/main b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/heads/main
deleted file mode 100644
index c082dce..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/heads/main
+++ /dev/null
@@ -1 +0,0 @@
-0000000000000000000000000000000000000000 1e2543e5619b3f6e88b7727243c8b9c5791a7b4a BoyCoder <chaxiu@users.noreply.github.com> 1766586759 +0800	clone: from https://github.com/Acly/comfyui-inpaint-nodes.git
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/remotes/origin/HEAD b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/remotes/origin/HEAD
deleted file mode 100644
index c082dce..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/logs/refs/remotes/origin/HEAD
+++ /dev/null
@@ -1 +0,0 @@
-0000000000000000000000000000000000000000 1e2543e5619b3f6e88b7727243c8b9c5791a7b4a BoyCoder <chaxiu@users.noreply.github.com> 1766586759 +0800	clone: from https://github.com/Acly/comfyui-inpaint-nodes.git
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.idx b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.idx
deleted file mode 100644
index ce9ad9c..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.idx and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.pack b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.pack
deleted file mode 100644
index 6d37e16..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.pack and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.rev b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.rev
deleted file mode 100644
index 4025f41..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/objects/pack/pack-bbac2506db554d66d7a45f9689b2ab6bbb9814fd.rev and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/packed-refs b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/packed-refs
deleted file mode 100644
index e71930c..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/packed-refs
+++ /dev/null
@@ -1,3 +0,0 @@
-# pack-refs with: peeled fully-peeled sorted 
-1e2543e5619b3f6e88b7727243c8b9c5791a7b4a refs/remotes/origin/main
-d8278603b335124d23c18f36ff9ee0e25461edf8 refs/tags/v1.0.0
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/heads/main b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/heads/main
deleted file mode 100644
index d6fc331..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/heads/main
+++ /dev/null
@@ -1 +0,0 @@
-1e2543e5619b3f6e88b7727243c8b9c5791a7b4a
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/remotes/origin/HEAD b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/remotes/origin/HEAD
deleted file mode 100644
index 4b0a875..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.git/refs/remotes/origin/HEAD
+++ /dev/null
@@ -1 +0,0 @@
-ref: refs/remotes/origin/main
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.github/workflows/publish.yml b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.github/workflows/publish.yml
deleted file mode 100644
index 2855f56..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.github/workflows/publish.yml
+++ /dev/null
@@ -1,22 +0,0 @@
-name: Publish to Comfy registry
-on:
-  workflow_dispatch:
-  push:
-    branches:
-      - main
-    paths:
-      - "pyproject.toml"
-
-jobs:
-  publish-node:
-    name: Publish Custom Node to registry
-    runs-on: ubuntu-latest
-    if: ${{ github.repository_owner == 'Acly' }}
-    steps:
-      - name: Check out code
-        uses: actions/checkout@v4
-      - name: Publish Custom Node
-        uses: Comfy-Org/publish-node-action@v1
-        with:
-          ## Add your own personal access token to your Github Repository secrets and reference it here.
-          personal_access_token: ${{ secrets.REGISTRY_ACCESS_TOKEN }}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.gitignore b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.gitignore
deleted file mode 100644
index 8c4c7fd..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/.gitignore
+++ /dev/null
@@ -1,5 +0,0 @@
-.vscode
-.env
-.dev
-__pycache__
-node.tar.gz
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/LICENSE b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/LICENSE
deleted file mode 100644
index f288702..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/LICENSE
+++ /dev/null
@@ -1,674 +0,0 @@
-                    GNU GENERAL PUBLIC LICENSE
-                       Version 3, 29 June 2007
-
- Copyright (C) 2007 Free Software Foundation, Inc. <https://fsf.org/>
- Everyone is permitted to copy and distribute verbatim copies
- of this license document, but changing it is not allowed.
-
-                            Preamble
-
-  The GNU General Public License is a free, copyleft license for
-software and other kinds of works.
-
-  The licenses for most software and other practical works are designed
-to take away your freedom to share and change the works.  By contrast,
-the GNU General Public License is intended to guarantee your freedom to
-share and change all versions of a program--to make sure it remains free
-software for all its users.  We, the Free Software Foundation, use the
-GNU General Public License for most of our software; it applies also to
-any other work released this way by its authors.  You can apply it to
-your programs, too.
-
-  When we speak of free software, we are referring to freedom, not
-price.  Our General Public Licenses are designed to make sure that you
-have the freedom to distribute copies of free software (and charge for
-them if you wish), that you receive source code or can get it if you
-want it, that you can change the software or use pieces of it in new
-free programs, and that you know you can do these things.
-
-  To protect your rights, we need to prevent others from denying you
-these rights or asking you to surrender the rights.  Therefore, you have
-certain responsibilities if you distribute copies of the software, or if
-you modify it: responsibilities to respect the freedom of others.
-
-  For example, if you distribute copies of such a program, whether
-gratis or for a fee, you must pass on to the recipients the same
-freedoms that you received.  You must make sure that they, too, receive
-or can get the source code.  And you must show them these terms so they
-know their rights.
-
-  Developers that use the GNU GPL protect your rights with two steps:
-(1) assert copyright on the software, and (2) offer you this License
-giving you legal permission to copy, distribute and/or modify it.
-
-  For the developers' and authors' protection, the GPL clearly explains
-that there is no warranty for this free software.  For both users' and
-authors' sake, the GPL requires that modified versions be marked as
-changed, so that their problems will not be attributed erroneously to
-authors of previous versions.
-
-  Some devices are designed to deny users access to install or run
-modified versions of the software inside them, although the manufacturer
-can do so.  This is fundamentally incompatible with the aim of
-protecting users' freedom to change the software.  The systematic
-pattern of such abuse occurs in the area of products for individuals to
-use, which is precisely where it is most unacceptable.  Therefore, we
-have designed this version of the GPL to prohibit the practice for those
-products.  If such problems arise substantially in other domains, we
-stand ready to extend this provision to those domains in future versions
-of the GPL, as needed to protect the freedom of users.
-
-  Finally, every program is threatened constantly by software patents.
-States should not allow patents to restrict development and use of
-software on general-purpose computers, but in those that do, we wish to
-avoid the special danger that patents applied to a free program could
-make it effectively proprietary.  To prevent this, the GPL assures that
-patents cannot be used to render the program non-free.
-
-  The precise terms and conditions for copying, distribution and
-modification follow.
-
-                       TERMS AND CONDITIONS
-
-  0. Definitions.
-
-  "This License" refers to version 3 of the GNU General Public License.
-
-  "Copyright" also means copyright-like laws that apply to other kinds of
-works, such as semiconductor masks.
-
-  "The Program" refers to any copyrightable work licensed under this
-License.  Each licensee is addressed as "you".  "Licensees" and
-"recipients" may be individuals or organizations.
-
-  To "modify" a work means to copy from or adapt all or part of the work
-in a fashion requiring copyright permission, other than the making of an
-exact copy.  The resulting work is called a "modified version" of the
-earlier work or a work "based on" the earlier work.
-
-  A "covered work" means either the unmodified Program or a work based
-on the Program.
-
-  To "propagate" a work means to do anything with it that, without
-permission, would make you directly or secondarily liable for
-infringement under applicable copyright law, except executing it on a
-computer or modifying a private copy.  Propagation includes copying,
-distribution (with or without modification), making available to the
-public, and in some countries other activities as well.
-
-  To "convey" a work means any kind of propagation that enables other
-parties to make or receive copies.  Mere interaction with a user through
-a computer network, with no transfer of a copy, is not conveying.
-
-  An interactive user interface displays "Appropriate Legal Notices"
-to the extent that it includes a convenient and prominently visible
-feature that (1) displays an appropriate copyright notice, and (2)
-tells the user that there is no warranty for the work (except to the
-extent that warranties are provided), that licensees may convey the
-work under this License, and how to view a copy of this License.  If
-the interface presents a list of user commands or options, such as a
-menu, a prominent item in the list meets this criterion.
-
-  1. Source Code.
-
-  The "source code" for a work means the preferred form of the work
-for making modifications to it.  "Object code" means any non-source
-form of a work.
-
-  A "Standard Interface" means an interface that either is an official
-standard defined by a recognized standards body, or, in the case of
-interfaces specified for a particular programming language, one that
-is widely used among developers working in that language.
-
-  The "System Libraries" of an executable work include anything, other
-than the work as a whole, that (a) is included in the normal form of
-packaging a Major Component, but which is not part of that Major
-Component, and (b) serves only to enable use of the work with that
-Major Component, or to implement a Standard Interface for which an
-implementation is available to the public in source code form.  A
-"Major Component", in this context, means a major essential component
-(kernel, window system, and so on) of the specific operating system
-(if any) on which the executable work runs, or a compiler used to
-produce the work, or an object code interpreter used to run it.
-
-  The "Corresponding Source" for a work in object code form means all
-the source code needed to generate, install, and (for an executable
-work) run the object code and to modify the work, including scripts to
-control those activities.  However, it does not include the work's
-System Libraries, or general-purpose tools or generally available free
-programs which are used unmodified in performing those activities but
-which are not part of the work.  For example, Corresponding Source
-includes interface definition files associated with source files for
-the work, and the source code for shared libraries and dynamically
-linked subprograms that the work is specifically designed to require,
-such as by intimate data communication or control flow between those
-subprograms and other parts of the work.
-
-  The Corresponding Source need not include anything that users
-can regenerate automatically from other parts of the Corresponding
-Source.
-
-  The Corresponding Source for a work in source code form is that
-same work.
-
-  2. Basic Permissions.
-
-  All rights granted under this License are granted for the term of
-copyright on the Program, and are irrevocable provided the stated
-conditions are met.  This License explicitly affirms your unlimited
-permission to run the unmodified Program.  The output from running a
-covered work is covered by this License only if the output, given its
-content, constitutes a covered work.  This License acknowledges your
-rights of fair use or other equivalent, as provided by copyright law.
-
-  You may make, run and propagate covered works that you do not
-convey, without conditions so long as your license otherwise remains
-in force.  You may convey covered works to others for the sole purpose
-of having them make modifications exclusively for you, or provide you
-with facilities for running those works, provided that you comply with
-the terms of this License in conveying all material for which you do
-not control copyright.  Those thus making or running the covered works
-for you must do so exclusively on your behalf, under your direction
-and control, on terms that prohibit them from making any copies of
-your copyrighted material outside their relationship with you.
-
-  Conveying under any other circumstances is permitted solely under
-the conditions stated below.  Sublicensing is not allowed; section 10
-makes it unnecessary.
-
-  3. Protecting Users' Legal Rights From Anti-Circumvention Law.
-
-  No covered work shall be deemed part of an effective technological
-measure under any applicable law fulfilling obligations under article
-11 of the WIPO copyright treaty adopted on 20 December 1996, or
-similar laws prohibiting or restricting circumvention of such
-measures.
-
-  When you convey a covered work, you waive any legal power to forbid
-circumvention of technological measures to the extent such circumvention
-is effected by exercising rights under this License with respect to
-the covered work, and you disclaim any intention to limit operation or
-modification of the work as a means of enforcing, against the work's
-users, your or third parties' legal rights to forbid circumvention of
-technological measures.
-
-  4. Conveying Verbatim Copies.
-
-  You may convey verbatim copies of the Program's source code as you
-receive it, in any medium, provided that you conspicuously and
-appropriately publish on each copy an appropriate copyright notice;
-keep intact all notices stating that this License and any
-non-permissive terms added in accord with section 7 apply to the code;
-keep intact all notices of the absence of any warranty; and give all
-recipients a copy of this License along with the Program.
-
-  You may charge any price or no price for each copy that you convey,
-and you may offer support or warranty protection for a fee.
-
-  5. Conveying Modified Source Versions.
-
-  You may convey a work based on the Program, or the modifications to
-produce it from the Program, in the form of source code under the
-terms of section 4, provided that you also meet all of these conditions:
-
-    a) The work must carry prominent notices stating that you modified
-    it, and giving a relevant date.
-
-    b) The work must carry prominent notices stating that it is
-    released under this License and any conditions added under section
-    7.  This requirement modifies the requirement in section 4 to
-    "keep intact all notices".
-
-    c) You must license the entire work, as a whole, under this
-    License to anyone who comes into possession of a copy.  This
-    License will therefore apply, along with any applicable section 7
-    additional terms, to the whole of the work, and all its parts,
-    regardless of how they are packaged.  This License gives no
-    permission to license the work in any other way, but it does not
-    invalidate such permission if you have separately received it.
-
-    d) If the work has interactive user interfaces, each must display
-    Appropriate Legal Notices; however, if the Program has interactive
-    interfaces that do not display Appropriate Legal Notices, your
-    work need not make them do so.
-
-  A compilation of a covered work with other separate and independent
-works, which are not by their nature extensions of the covered work,
-and which are not combined with it such as to form a larger program,
-in or on a volume of a storage or distribution medium, is called an
-"aggregate" if the compilation and its resulting copyright are not
-used to limit the access or legal rights of the compilation's users
-beyond what the individual works permit.  Inclusion of a covered work
-in an aggregate does not cause this License to apply to the other
-parts of the aggregate.
-
-  6. Conveying Non-Source Forms.
-
-  You may convey a covered work in object code form under the terms
-of sections 4 and 5, provided that you also convey the
-machine-readable Corresponding Source under the terms of this License,
-in one of these ways:
-
-    a) Convey the object code in, or embodied in, a physical product
-    (including a physical distribution medium), accompanied by the
-    Corresponding Source fixed on a durable physical medium
-    customarily used for software interchange.
-
-    b) Convey the object code in, or embodied in, a physical product
-    (including a physical distribution medium), accompanied by a
-    written offer, valid for at least three years and valid for as
-    long as you offer spare parts or customer support for that product
-    model, to give anyone who possesses the object code either (1) a
-    copy of the Corresponding Source for all the software in the
-    product that is covered by this License, on a durable physical
-    medium customarily used for software interchange, for a price no
-    more than your reasonable cost of physically performing this
-    conveying of source, or (2) access to copy the
-    Corresponding Source from a network server at no charge.
-
-    c) Convey individual copies of the object code with a copy of the
-    written offer to provide the Corresponding Source.  This
-    alternative is allowed only occasionally and noncommercially, and
-    only if you received the object code with such an offer, in accord
-    with subsection 6b.
-
-    d) Convey the object code by offering access from a designated
-    place (gratis or for a charge), and offer equivalent access to the
-    Corresponding Source in the same way through the same place at no
-    further charge.  You need not require recipients to copy the
-    Corresponding Source along with the object code.  If the place to
-    copy the object code is a network server, the Corresponding Source
-    may be on a different server (operated by you or a third party)
-    that supports equivalent copying facilities, provided you maintain
-    clear directions next to the object code saying where to find the
-    Corresponding Source.  Regardless of what server hosts the
-    Corresponding Source, you remain obligated to ensure that it is
-    available for as long as needed to satisfy these requirements.
-
-    e) Convey the object code using peer-to-peer transmission, provided
-    you inform other peers where the object code and Corresponding
-    Source of the work are being offered to the general public at no
-    charge under subsection 6d.
-
-  A separable portion of the object code, whose source code is excluded
-from the Corresponding Source as a System Library, need not be
-included in conveying the object code work.
-
-  A "User Product" is either (1) a "consumer product", which means any
-tangible personal property which is normally used for personal, family,
-or household purposes, or (2) anything designed or sold for incorporation
-into a dwelling.  In determining whether a product is a consumer product,
-doubtful cases shall be resolved in favor of coverage.  For a particular
-product received by a particular user, "normally used" refers to a
-typical or common use of that class of product, regardless of the status
-of the particular user or of the way in which the particular user
-actually uses, or expects or is expected to use, the product.  A product
-is a consumer product regardless of whether the product has substantial
-commercial, industrial or non-consumer uses, unless such uses represent
-the only significant mode of use of the product.
-
-  "Installation Information" for a User Product means any methods,
-procedures, authorization keys, or other information required to install
-and execute modified versions of a covered work in that User Product from
-a modified version of its Corresponding Source.  The information must
-suffice to ensure that the continued functioning of the modified object
-code is in no case prevented or interfered with solely because
-modification has been made.
-
-  If you convey an object code work under this section in, or with, or
-specifically for use in, a User Product, and the conveying occurs as
-part of a transaction in which the right of possession and use of the
-User Product is transferred to the recipient in perpetuity or for a
-fixed term (regardless of how the transaction is characterized), the
-Corresponding Source conveyed under this section must be accompanied
-by the Installation Information.  But this requirement does not apply
-if neither you nor any third party retains the ability to install
-modified object code on the User Product (for example, the work has
-been installed in ROM).
-
-  The requirement to provide Installation Information does not include a
-requirement to continue to provide support service, warranty, or updates
-for a work that has been modified or installed by the recipient, or for
-the User Product in which it has been modified or installed.  Access to a
-network may be denied when the modification itself materially and
-adversely affects the operation of the network or violates the rules and
-protocols for communication across the network.
-
-  Corresponding Source conveyed, and Installation Information provided,
-in accord with this section must be in a format that is publicly
-documented (and with an implementation available to the public in
-source code form), and must require no special password or key for
-unpacking, reading or copying.
-
-  7. Additional Terms.
-
-  "Additional permissions" are terms that supplement the terms of this
-License by making exceptions from one or more of its conditions.
-Additional permissions that are applicable to the entire Program shall
-be treated as though they were included in this License, to the extent
-that they are valid under applicable law.  If additional permissions
-apply only to part of the Program, that part may be used separately
-under those permissions, but the entire Program remains governed by
-this License without regard to the additional permissions.
-
-  When you convey a copy of a covered work, you may at your option
-remove any additional permissions from that copy, or from any part of
-it.  (Additional permissions may be written to require their own
-removal in certain cases when you modify the work.)  You may place
-additional permissions on material, added by you to a covered work,
-for which you have or can give appropriate copyright permission.
-
-  Notwithstanding any other provision of this License, for material you
-add to a covered work, you may (if authorized by the copyright holders of
-that material) supplement the terms of this License with terms:
-
-    a) Disclaiming warranty or limiting liability differently from the
-    terms of sections 15 and 16 of this License; or
-
-    b) Requiring preservation of specified reasonable legal notices or
-    author attributions in that material or in the Appropriate Legal
-    Notices displayed by works containing it; or
-
-    c) Prohibiting misrepresentation of the origin of that material, or
-    requiring that modified versions of such material be marked in
-    reasonable ways as different from the original version; or
-
-    d) Limiting the use for publicity purposes of names of licensors or
-    authors of the material; or
-
-    e) Declining to grant rights under trademark law for use of some
-    trade names, trademarks, or service marks; or
-
-    f) Requiring indemnification of licensors and authors of that
-    material by anyone who conveys the material (or modified versions of
-    it) with contractual assumptions of liability to the recipient, for
-    any liability that these contractual assumptions directly impose on
-    those licensors and authors.
-
-  All other non-permissive additional terms are considered "further
-restrictions" within the meaning of section 10.  If the Program as you
-received it, or any part of it, contains a notice stating that it is
-governed by this License along with a term that is a further
-restriction, you may remove that term.  If a license document contains
-a further restriction but permits relicensing or conveying under this
-License, you may add to a covered work material governed by the terms
-of that license document, provided that the further restriction does
-not survive such relicensing or conveying.
-
-  If you add terms to a covered work in accord with this section, you
-must place, in the relevant source files, a statement of the
-additional terms that apply to those files, or a notice indicating
-where to find the applicable terms.
-
-  Additional terms, permissive or non-permissive, may be stated in the
-form of a separately written license, or stated as exceptions;
-the above requirements apply either way.
-
-  8. Termination.
-
-  You may not propagate or modify a covered work except as expressly
-provided under this License.  Any attempt otherwise to propagate or
-modify it is void, and will automatically terminate your rights under
-this License (including any patent licenses granted under the third
-paragraph of section 11).
-
-  However, if you cease all violation of this License, then your
-license from a particular copyright holder is reinstated (a)
-provisionally, unless and until the copyright holder explicitly and
-finally terminates your license, and (b) permanently, if the copyright
-holder fails to notify you of the violation by some reasonable means
-prior to 60 days after the cessation.
-
-  Moreover, your license from a particular copyright holder is
-reinstated permanently if the copyright holder notifies you of the
-violation by some reasonable means, this is the first time you have
-received notice of violation of this License (for any work) from that
-copyright holder, and you cure the violation prior to 30 days after
-your receipt of the notice.
-
-  Termination of your rights under this section does not terminate the
-licenses of parties who have received copies or rights from you under
-this License.  If your rights have been terminated and not permanently
-reinstated, you do not qualify to receive new licenses for the same
-material under section 10.
-
-  9. Acceptance Not Required for Having Copies.
-
-  You are not required to accept this License in order to receive or
-run a copy of the Program.  Ancillary propagation of a covered work
-occurring solely as a consequence of using peer-to-peer transmission
-to receive a copy likewise does not require acceptance.  However,
-nothing other than this License grants you permission to propagate or
-modify any covered work.  These actions infringe copyright if you do
-not accept this License.  Therefore, by modifying or propagating a
-covered work, you indicate your acceptance of this License to do so.
-
-  10. Automatic Licensing of Downstream Recipients.
-
-  Each time you convey a covered work, the recipient automatically
-receives a license from the original licensors, to run, modify and
-propagate that work, subject to this License.  You are not responsible
-for enforcing compliance by third parties with this License.
-
-  An "entity transaction" is a transaction transferring control of an
-organization, or substantially all assets of one, or subdividing an
-organization, or merging organizations.  If propagation of a covered
-work results from an entity transaction, each party to that
-transaction who receives a copy of the work also receives whatever
-licenses to the work the party's predecessor in interest had or could
-give under the previous paragraph, plus a right to possession of the
-Corresponding Source of the work from the predecessor in interest, if
-the predecessor has it or can get it with reasonable efforts.
-
-  You may not impose any further restrictions on the exercise of the
-rights granted or affirmed under this License.  For example, you may
-not impose a license fee, royalty, or other charge for exercise of
-rights granted under this License, and you may not initiate litigation
-(including a cross-claim or counterclaim in a lawsuit) alleging that
-any patent claim is infringed by making, using, selling, offering for
-sale, or importing the Program or any portion of it.
-
-  11. Patents.
-
-  A "contributor" is a copyright holder who authorizes use under this
-License of the Program or a work on which the Program is based.  The
-work thus licensed is called the contributor's "contributor version".
-
-  A contributor's "essential patent claims" are all patent claims
-owned or controlled by the contributor, whether already acquired or
-hereafter acquired, that would be infringed by some manner, permitted
-by this License, of making, using, or selling its contributor version,
-but do not include claims that would be infringed only as a
-consequence of further modification of the contributor version.  For
-purposes of this definition, "control" includes the right to grant
-patent sublicenses in a manner consistent with the requirements of
-this License.
-
-  Each contributor grants you a non-exclusive, worldwide, royalty-free
-patent license under the contributor's essential patent claims, to
-make, use, sell, offer for sale, import and otherwise run, modify and
-propagate the contents of its contributor version.
-
-  In the following three paragraphs, a "patent license" is any express
-agreement or commitment, however denominated, not to enforce a patent
-(such as an express permission to practice a patent or covenant not to
-sue for patent infringement).  To "grant" such a patent license to a
-party means to make such an agreement or commitment not to enforce a
-patent against the party.
-
-  If you convey a covered work, knowingly relying on a patent license,
-and the Corresponding Source of the work is not available for anyone
-to copy, free of charge and under the terms of this License, through a
-publicly available network server or other readily accessible means,
-then you must either (1) cause the Corresponding Source to be so
-available, or (2) arrange to deprive yourself of the benefit of the
-patent license for this particular work, or (3) arrange, in a manner
-consistent with the requirements of this License, to extend the patent
-license to downstream recipients.  "Knowingly relying" means you have
-actual knowledge that, but for the patent license, your conveying the
-covered work in a country, or your recipient's use of the covered work
-in a country, would infringe one or more identifiable patents in that
-country that you have reason to believe are valid.
-
-  If, pursuant to or in connection with a single transaction or
-arrangement, you convey, or propagate by procuring conveyance of, a
-covered work, and grant a patent license to some of the parties
-receiving the covered work authorizing them to use, propagate, modify
-or convey a specific copy of the covered work, then the patent license
-you grant is automatically extended to all recipients of the covered
-work and works based on it.
-
-  A patent license is "discriminatory" if it does not include within
-the scope of its coverage, prohibits the exercise of, or is
-conditioned on the non-exercise of one or more of the rights that are
-specifically granted under this License.  You may not convey a covered
-work if you are a party to an arrangement with a third party that is
-in the business of distributing software, under which you make payment
-to the third party based on the extent of your activity of conveying
-the work, and under which the third party grants, to any of the
-parties who would receive the covered work from you, a discriminatory
-patent license (a) in connection with copies of the covered work
-conveyed by you (or copies made from those copies), or (b) primarily
-for and in connection with specific products or compilations that
-contain the covered work, unless you entered into that arrangement,
-or that patent license was granted, prior to 28 March 2007.
-
-  Nothing in this License shall be construed as excluding or limiting
-any implied license or other defenses to infringement that may
-otherwise be available to you under applicable patent law.
-
-  12. No Surrender of Others' Freedom.
-
-  If conditions are imposed on you (whether by court order, agreement or
-otherwise) that contradict the conditions of this License, they do not
-excuse you from the conditions of this License.  If you cannot convey a
-covered work so as to satisfy simultaneously your obligations under this
-License and any other pertinent obligations, then as a consequence you may
-not convey it at all.  For example, if you agree to terms that obligate you
-to collect a royalty for further conveying from those to whom you convey
-the Program, the only way you could satisfy both those terms and this
-License would be to refrain entirely from conveying the Program.
-
-  13. Use with the GNU Affero General Public License.
-
-  Notwithstanding any other provision of this License, you have
-permission to link or combine any covered work with a work licensed
-under version 3 of the GNU Affero General Public License into a single
-combined work, and to convey the resulting work.  The terms of this
-License will continue to apply to the part which is the covered work,
-but the special requirements of the GNU Affero General Public License,
-section 13, concerning interaction through a network will apply to the
-combination as such.
-
-  14. Revised Versions of this License.
-
-  The Free Software Foundation may publish revised and/or new versions of
-the GNU General Public License from time to time.  Such new versions will
-be similar in spirit to the present version, but may differ in detail to
-address new problems or concerns.
-
-  Each version is given a distinguishing version number.  If the
-Program specifies that a certain numbered version of the GNU General
-Public License "or any later version" applies to it, you have the
-option of following the terms and conditions either of that numbered
-version or of any later version published by the Free Software
-Foundation.  If the Program does not specify a version number of the
-GNU General Public License, you may choose any version ever published
-by the Free Software Foundation.
-
-  If the Program specifies that a proxy can decide which future
-versions of the GNU General Public License can be used, that proxy's
-public statement of acceptance of a version permanently authorizes you
-to choose that version for the Program.
-
-  Later license versions may give you additional or different
-permissions.  However, no additional obligations are imposed on any
-author or copyright holder as a result of your choosing to follow a
-later version.
-
-  15. Disclaimer of Warranty.
-
-  THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
-APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
-HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
-OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
-THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
-PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
-IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF
-ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
-
-  16. Limitation of Liability.
-
-  IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
-WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR CONVEYS
-THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY
-GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE
-USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF
-DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD
-PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS),
-EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
-SUCH DAMAGES.
-
-  17. Interpretation of Sections 15 and 16.
-
-  If the disclaimer of warranty and limitation of liability provided
-above cannot be given local legal effect according to their terms,
-reviewing courts shall apply local law that most closely approximates
-an absolute waiver of all civil liability in connection with the
-Program, unless a warranty or assumption of liability accompanies a
-copy of the Program in return for a fee.
-
-                     END OF TERMS AND CONDITIONS
-
-            How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-state the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
-
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) <year>  <name of author>
-
-    This program is free software: you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation, either version 3 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-
-Also add information on how to contact you by electronic and paper mail.
-
-  If the program does terminal interaction, make it output a short
-notice like this when it starts in an interactive mode:
-
-    <program>  Copyright (C) <year>  <name of author>
-    This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, your program's commands
-might be different; for a GUI interface, you would use an "about box".
-
-  You should also get your employer (if you work as a programmer) or school,
-if any, to sign a "copyright disclaimer" for the program, if necessary.
-For more information on this, and how to apply and follow the GNU GPL, see
-<https://www.gnu.org/licenses/>.
-
-  The GNU General Public License does not permit incorporating your program
-into proprietary programs.  If your program is a subroutine library, you
-may consider it more useful to permit linking proprietary applications with
-the library.  If this is what you want to do, use the GNU Lesser General
-Public License instead of this License.  But first, please read
-<https://www.gnu.org/licenses/why-not-lgpl.html>.
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/README.md b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/README.md
deleted file mode 100644
index 289a853..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/README.md
+++ /dev/null
@@ -1,129 +0,0 @@
-# ComfyUI Inpaint Nodes
-
-Nodes for better inpainting with ComfyUI: Fooocus inpaint model for SDXL, LaMa, MAT,
-and various other tools for pre-filling inpaint & outpaint areas.
-
-
-## Fooocus Inpaint
-
-Adds two nodes which allow using [Fooocus](https://github.com/lllyasviel/Fooocus) inpaint model.
-It's a small and flexible patch which can be applied to your _**SDXL** checkpoints_ and
-will transform them into an inpaint model. This model can then be used like other inpaint
-models to seamlessly fill and expand areas in an image.
-
-Download models from [lllyasviel/fooocus_inpaint](https://huggingface.co/lllyasviel/fooocus_inpaint/tree/main) and place them into `ComfyUI/models/inpaint`.
-
-![Inpaint workflow](media/inpaint.png)
-
-> [!NOTE]
-> 
-> Make sure to use the regular version of a checkpoint to create an inpaint model - distilled merges (Turbo, Lightning, Hyper) do not work.
-
-
-## Inpaint Conditioning
-
-Fooocus inpaint can be used with ComfyUI's _VAE Encode (for Inpainting)_ directly. However this does
-not allow existing content in the masked area, denoise strength must be 1.0.
-
-_InpaintModelConditioning_ can be used to combine inpaint models with existing content. The resulting
-latent can however _not_ be used directly to patch the model using _Apply Fooocus Inpaint_. This repository
-adds a new node **VAE Encode & Inpaint Conditioning** which provides two outputs: `latent_inpaint` (connect
-this to _Apply Fooocus Inpaint_) and `latent_samples` (connect this to _KSampler_).
-
-It's the same as using both _VAE Encode (for Inpainting)_ and _InpaintModelConditioning_, but less overhead
-because it avoids VAE-encoding the image twice. [Example workflow](workflows/inpaint-refine.json)
-
-
-## Inpaint Pre-processing
-
-Several nodes are available to fill the masked area prior to inpainting. They avoid seams as long as the
-input mask is large enough.
-
-### Expand Mask
-
-Expands (grow) the mask area by a certain number of pixels, and blurs (feather) the mask for a smoother transition at the edges.
-
-### Fill Masked
-
-This fills the masked area, with a smooth transition at the border. It has 3 modes:
-* `neutral`: fills with grey, good for adding entirely new content
-* `telea`: fills with colors from surrounding border (based on algorithm by Alexandru Telea)
-* `navier-stokes`: fills with colors from surrounding border (based on fluid dynamics described by Navier-Stokes)
-
-| Input | Neutral | Telea | Navier-Stokes |
-|-|-|-|-|
-| ![input](media/preprocess-input.png) | ![neutral](media/preprocess-neutral.png) | ![telea](media/preprocess-telea.png) | ![ns](media/preprocess-navier-stokes.png)
-
-### Blur Masked
-
-This blurs the image into the masked area. The blur is less strong at the borders of the mask.
-Good for keeping the general colors the same.
-
-| Input | Blur radius 17 | Blur radius 65 |
-|-|-|-|
-| ![input](media/preprocess-input.png) | ![blur-17](media/preprocess-blur-17.png) | ![blur-65](media/preprocess-blur-65.png) |
-
-### Inpaint Models (LaMA, MAT)
-
-This runs a small, fast inpaint model on the masked area. Models can be loaded with **Load Inpaint Model**
-and are applied with the **Inpaint (using Model)** node. This works well for outpainting or object removal.
-
-The following inpaint models are supported, place them in `ComfyUI/models/inpaint`:
-- [LaMa](https://github.com/advimman/lama) | [Model download](https://github.com/Sanster/models/releases/download/add_big_lama/big-lama.pt)
-- [MAT](https://github.com/fenglinglwb/MAT) | [Model download](https://github.com/Sanster/models/releases/download/add_mat/Places_512_FullData_G.pth) | [Model download (fp16 safetensors)](https://huggingface.co/Acly/MAT/resolve/main/MAT_Places512_G_fp16.safetensors)
-
-| Input | LaMa | MAT |
-|-|-|-|
-| ![input](media/preprocess-input.png) | ![lama](media/preprocess-lama.png) | ![mat](media/preprocess-mat.png) |
-
-
-## Inpaint Post-processing
-
-### Denoise to Compositing Mask
-
-Takes a _mask_, an _offset_ (default 0.1) and a _threshold_ (default 0.2).
-Maps mask values in the range of \[_offset_  _threshold_\] to \[0  1\].
-Values below offset are clamped to 0, values above threshold to 1.
-
-This is particularly useful in combination with ComfyUI's "Differential Diffusion" node, which allows to use a mask as per-pixel denoise strength.
-Using the same mask for compositing (alpha blending) defeats the purpose, but no blending at all degrades quality in regions with zero or very low strength. This node creates a mask suitable for blending from the denoise-mask.
-
-
-## Example Workflows
-
-Example workflows can be found in [workflows](workflows).
-
-* **[Simple](https://raw.githubusercontent.com/Acly/comfyui-inpaint-nodes/main/workflows/inpaint-simple.json):** basic workflow, ignore previous content, 100% replacement
-* **[Refine](https://raw.githubusercontent.com/Acly/comfyui-inpaint-nodes/main/workflows/inpaint-refine.json):** advanced workflow, refine existing content, 1-100% denoise strength
-* **[Outpaint](https://raw.githubusercontent.com/Acly/comfyui-inpaint-nodes/main/workflows/outpaint.json):** workflow for outpainting with pre-processing
-* **[Pre-process](https://raw.githubusercontent.com/Acly/comfyui-inpaint-nodes/main/workflows/inpaint-preprocess.json):** complex workflow for experimenting with pre-processors
-* **[Promptless](https://raw.githubusercontent.com/Acly/comfyui-inpaint-nodes/main/workflows/inpaint-promptless.json):** same as above but without text prompt, requires [IP-Adapter](https://github.com/cubiq/ComfyUI_IPAdapter_plus)
-
-
-## Installation
-
-Use [ComfyUI Manager](https://github.com/ltdrdata/ComfyUI-Manager) and search for "ComfyUI Inpaint Nodes".
-
-_**or**_ download the repository and put the folder into `ComfyUI/custom_nodes`.
-
-_**or**_ use GIT:
-```
-cd ComfyUI/custom_nodes
-git clone https://github.com/Acly/comfyui-inpaint-nodes.git
-```
-
-Restart ComfyUI after installing!
-
----
-
-OpenCV is required for _telea_ and _navier-stokes_ fill mode:
-```
-pip install opencv-python
-```
-
-## Acknowledgements
-
-* Fooocus Inpaint: [lllyasviel/Fooocus](https://github.com/lllyasviel/Fooocus)
-* LaMa: [advimman/lama](https://github.com/advimman/lama)
-* MAT: [fenglinglwb/MAT](https://github.com/fenglinglwb/MAT)
-* LaMa/MAT implementation: [chaiNNer-org/spandrel](https://github.com/chaiNNer-org/spandrel)
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/__init__.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/__init__.py
deleted file mode 100644
index d0e9bd2..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/__init__.py
+++ /dev/null
@@ -1,45 +0,0 @@
-import folder_paths
-import os
-
-
-def _add_folder_path(folder_name: str, extensions_to_register: list):
-    path = os.path.join(folder_paths.models_dir, folder_name)
-    folders, extensions = folder_paths.folder_names_and_paths.get(folder_name, ([], set()))
-    if path not in folders:
-        folders.append(path)
-    if isinstance(extensions, set):
-        extensions.update(extensions_to_register)
-    elif isinstance(extensions, list):
-        extensions.extend(extensions_to_register)
-    else:
-        e = f"Failed to register models/inpaint folder. Found existing value: {extensions}"
-        raise Exception(e)
-    folder_paths.folder_names_and_paths[folder_name] = (folders, extensions)
-
-
-_add_folder_path("inpaint", [".pt", ".pth", ".safetensors", ".patch"])
-
-from . import nodes
-
-NODE_CLASS_MAPPINGS = {
-    "INPAINT_LoadFooocusInpaint": nodes.LoadFooocusInpaint,
-    "INPAINT_ApplyFooocusInpaint": nodes.ApplyFooocusInpaint,
-    "INPAINT_VAEEncodeInpaintConditioning": nodes.VAEEncodeInpaintConditioning,
-    "INPAINT_MaskedFill": nodes.MaskedFill,
-    "INPAINT_MaskedBlur": nodes.MaskedBlur,
-    "INPAINT_LoadInpaintModel": nodes.LoadInpaintModel,
-    "INPAINT_InpaintWithModel": nodes.InpaintWithModel,
-    "INPAINT_ExpandMask": nodes.ExpandMask,
-    "INPAINT_DenoiseToCompositingMask": nodes.DenoiseToCompositingMask,
-}
-NODE_DISPLAY_NAME_MAPPINGS = {
-    "INPAINT_LoadFooocusInpaint": "Load Fooocus Inpaint",
-    "INPAINT_ApplyFooocusInpaint": "Apply Fooocus Inpaint",
-    "INPAINT_VAEEncodeInpaintConditioning": "VAE Encode & Inpaint Conditioning",
-    "INPAINT_MaskedFill": "Fill Masked Area",
-    "INPAINT_MaskedBlur": "Blur Masked Area",
-    "INPAINT_LoadInpaintModel": "Load Inpaint Model",
-    "INPAINT_InpaintWithModel": "Inpaint (using Model)",
-    "INPAINT_ExpandMask": "Expand Mask",
-    "INPAINT_DenoiseToCompositingMask": "Denoise to Compositing Mask",
-}
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/__init__.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/__init__.py
deleted file mode 100644
index 1dff646..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/__init__.py
+++ /dev/null
@@ -1,16 +0,0 @@
-# From https://github.com/chaiNNer-org/spandrel
-# This extends what ComfyUI copied out of chaiNNer's codebase.
-# (until such time as it just uses spandrel as depndency)
-
-from .arch.MAT import MAT
-
-
-def load(state_dict):
-    state = {
-        k.replace("synthesis", "model.synthesis").replace("mapping", "model.mapping"): v
-        for k, v in state_dict.items()
-    }
-
-    model = MAT()
-    model.load_state_dict(state)
-    return model
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/LICENSE b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/LICENSE
deleted file mode 100644
index 593adf6..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/LICENSE
+++ /dev/null
@@ -1,161 +0,0 @@
-## creative commons
-
-# Attribution-NonCommercial 4.0 International
-
-Creative Commons Corporation (Creative Commons) is not a law firm and does not provide legal services or legal advice. Distribution of Creative Commons public licenses does not create a lawyer-client or other relationship. Creative Commons makes its licenses and related information available on an as-is basis. Creative Commons gives no warranties regarding its licenses, any material licensed under their terms and conditions, or any related information. Creative Commons disclaims all liability for damages resulting from their use to the fullest extent possible.
-
-### Using Creative Commons Public Licenses
-
-Creative Commons public licenses provide a standard set of terms and conditions that creators and other rights holders may use to share original works of authorship and other material subject to copyright and certain other rights specified in the public license below. The following considerations are for informational purposes only, are not exhaustive, and do not form part of our licenses.
-
-* __Considerations for licensors:__ Our public licenses are intended for use by those authorized to give the public permission to use material in ways otherwise restricted by copyright and certain other rights. Our licenses are irrevocable. Licensors should read and understand the terms and conditions of the license they choose before applying it. Licensors should also secure all rights necessary before applying our licenses so that the public can reuse the material as expected. Licensors should clearly mark any material not subject to the license. This includes other CC-licensed material, or material used under an exception or limitation to copyright. [More considerations for licensors](http://wiki.creativecommons.org/Considerations_for_licensors_and_licensees#Considerations_for_licensors).
-
-* __Considerations for the public:__ By using one of our public licenses, a licensor grants the public permission to use the licensed material under specified terms and conditions. If the licensors permission is not necessary for any reasonfor example, because of any applicable exception or limitation to copyrightthen that use is not regulated by the license. Our licenses grant only permissions under copyright and certain other rights that a licensor has authority to grant. Use of the licensed material may still be restricted for other reasons, including because others have copyright or other rights in the material. A licensor may make special requests, such as asking that all changes be marked or described. Although not required by our licenses, you are encouraged to respect those requests where reasonable. [More considerations for the public](http://wiki.creativecommons.org/Considerations_for_licensors_and_licensees#Considerations_for_licensees).
-
-## Creative Commons Attribution-NonCommercial 4.0 International Public License
-
-By exercising the Licensed Rights (defined below), You accept and agree to be bound by the terms and conditions of this Creative Commons Attribution-NonCommercial 4.0 International Public License ("Public License"). To the extent this Public License may be interpreted as a contract, You are granted the Licensed Rights in consideration of Your acceptance of these terms and conditions, and the Licensor grants You such rights in consideration of benefits the Licensor receives from making the Licensed Material available under these terms and conditions.
-
-### Section 1  Definitions.
-
-a. __Adapted Material__ means material subject to Copyright and Similar Rights that is derived from or based upon the Licensed Material and in which the Licensed Material is translated, altered, arranged, transformed, or otherwise modified in a manner requiring permission under the Copyright and Similar Rights held by the Licensor. For purposes of this Public License, where the Licensed Material is a musical work, performance, or sound recording, Adapted Material is always produced where the Licensed Material is synched in timed relation with a moving image.
-
-b. __Adapter's License__ means the license You apply to Your Copyright and Similar Rights in Your contributions to Adapted Material in accordance with the terms and conditions of this Public License.
-
-c. __Copyright and Similar Rights__ means copyright and/or similar rights closely related to copyright including, without limitation, performance, broadcast, sound recording, and Sui Generis Database Rights, without regard to how the rights are labeled or categorized. For purposes of this Public License, the rights specified in Section 2(b)(1)-(2) are not Copyright and Similar Rights.
-
-d. __Effective Technological Measures__ means those measures that, in the absence of proper authority, may not be circumvented under laws fulfilling obligations under Article 11 of the WIPO Copyright Treaty adopted on December 20, 1996, and/or similar international agreements.
-
-e. __Exceptions and Limitations__ means fair use, fair dealing, and/or any other exception or limitation to Copyright and Similar Rights that applies to Your use of the Licensed Material.
-
-f. __Licensed Material__ means the artistic or literary work, database, or other material to which the Licensor applied this Public License.
-
-g. __Licensed Rights__ means the rights granted to You subject to the terms and conditions of this Public License, which are limited to all Copyright and Similar Rights that apply to Your use of the Licensed Material and that the Licensor has authority to license.
-
-h. __Licensor__ means the individual(s) or entity(ies) granting rights under this Public License.
-
-i. __NonCommercial__ means not primarily intended for or directed towards commercial advantage or monetary compensation. For purposes of this Public License, the exchange of the Licensed Material for other material subject to Copyright and Similar Rights by digital file-sharing or similar means is NonCommercial provided there is no payment of monetary compensation in connection with the exchange.
-
-j. __Share__ means to provide material to the public by any means or process that requires permission under the Licensed Rights, such as reproduction, public display, public performance, distribution, dissemination, communication, or importation, and to make material available to the public including in ways that members of the public may access the material from a place and at a time individually chosen by them.
-
-k. __Sui Generis Database Rights__ means rights other than copyright resulting from Directive 96/9/EC of the European Parliament and of the Council of 11 March 1996 on the legal protection of databases, as amended and/or succeeded, as well as other essentially equivalent rights anywhere in the world.
-
-l. __You__ means the individual or entity exercising the Licensed Rights under this Public License. Your has a corresponding meaning.
-
-### Section 2  Scope.
-
-a. ___License grant.___
-
-   1. Subject to the terms and conditions of this Public License, the Licensor hereby grants You a worldwide, royalty-free, non-sublicensable, non-exclusive, irrevocable license to exercise the Licensed Rights in the Licensed Material to:
-
-       A. reproduce and Share the Licensed Material, in whole or in part, for NonCommercial purposes only; and
-
-       B. produce, reproduce, and Share Adapted Material for NonCommercial purposes only.
-
-   2. __Exceptions and Limitations.__ For the avoidance of doubt, where Exceptions and Limitations apply to Your use, this Public License does not apply, and You do not need to comply with its terms and conditions.
-
-   3. __Term.__ The term of this Public License is specified in Section 6(a).
-
-   4. __Media and formats; technical modifications allowed.__ The Licensor authorizes You to exercise the Licensed Rights in all media and formats whether now known or hereafter created, and to make technical modifications necessary to do so. The Licensor waives and/or agrees not to assert any right or authority to forbid You from making technical modifications necessary to exercise the Licensed Rights, including technical modifications necessary to circumvent Effective Technological Measures. For purposes of this Public License, simply making modifications authorized by this Section 2(a)(4) never produces Adapted Material.
-
-    5. __Downstream recipients.__
-
-        A. __Offer from the Licensor  Licensed Material.__ Every recipient of the Licensed Material automatically receives an offer from the Licensor to exercise the Licensed Rights under the terms and conditions of this Public License.
-
-        B. __No downstream restrictions.__ You may not offer or impose any additional or different terms or conditions on, or apply any Effective Technological Measures to, the Licensed Material if doing so restricts exercise of the Licensed Rights by any recipient of the Licensed Material.
-
-    6. __No endorsement.__ Nothing in this Public License constitutes or may be construed as permission to assert or imply that You are, or that Your use of the Licensed Material is, connected with, or sponsored, endorsed, or granted official status by, the Licensor or others designated to receive attribution as provided in Section 3(a)(1)(A)(i).
-
-b. ___Other rights.___
-
-   1. Moral rights, such as the right of integrity, are not licensed under this Public License, nor are publicity, privacy, and/or other similar personality rights; however, to the extent possible, the Licensor waives and/or agrees not to assert any such rights held by the Licensor to the limited extent necessary to allow You to exercise the Licensed Rights, but not otherwise.
-
-   2. Patent and trademark rights are not licensed under this Public License.
-
-   3. To the extent possible, the Licensor waives any right to collect royalties from You for the exercise of the Licensed Rights, whether directly or through a collecting society under any voluntary or waivable statutory or compulsory licensing scheme. In all other cases the Licensor expressly reserves any right to collect such royalties, including when the Licensed Material is used other than for NonCommercial purposes.
-
-### Section 3  License Conditions.
-
-Your exercise of the Licensed Rights is expressly made subject to the following conditions.
-
-a. ___Attribution.___
-
-   1. If You Share the Licensed Material (including in modified form), You must:
-
-       A. retain the following if it is supplied by the Licensor with the Licensed Material:
-
-         i. identification of the creator(s) of the Licensed Material and any others designated to receive attribution, in any reasonable manner requested by the Licensor (including by pseudonym if designated);
-
-         ii. a copyright notice;
-
-         iii. a notice that refers to this Public License;
-
-         iv. a notice that refers to the disclaimer of warranties;
-
-         v. a URI or hyperlink to the Licensed Material to the extent reasonably practicable;
-
-       B. indicate if You modified the Licensed Material and retain an indication of any previous modifications; and
-
-       C. indicate the Licensed Material is licensed under this Public License, and include the text of, or the URI or hyperlink to, this Public License.
-
-   2. You may satisfy the conditions in Section 3(a)(1) in any reasonable manner based on the medium, means, and context in which You Share the Licensed Material. For example, it may be reasonable to satisfy the conditions by providing a URI or hyperlink to a resource that includes the required information.
-
-   3. If requested by the Licensor, You must remove any of the information required by Section 3(a)(1)(A) to the extent reasonably practicable.
-
-   4. If You Share Adapted Material You produce, the Adapter's License You apply must not prevent recipients of the Adapted Material from complying with this Public License.
-
-### Section 4  Sui Generis Database Rights.
-
-Where the Licensed Rights include Sui Generis Database Rights that apply to Your use of the Licensed Material:
-
-a. for the avoidance of doubt, Section 2(a)(1) grants You the right to extract, reuse, reproduce, and Share all or a substantial portion of the contents of the database for NonCommercial purposes only;
-
-b. if You include all or a substantial portion of the database contents in a database in which You have Sui Generis Database Rights, then the database in which You have Sui Generis Database Rights (but not its individual contents) is Adapted Material; and
-
-c. You must comply with the conditions in Section 3(a) if You Share all or a substantial portion of the contents of the database.
-
-For the avoidance of doubt, this Section 4 supplements and does not replace Your obligations under this Public License where the Licensed Rights include other Copyright and Similar Rights.
-
-### Section 5  Disclaimer of Warranties and Limitation of Liability.
-
-a. __Unless otherwise separately undertaken by the Licensor, to the extent possible, the Licensor offers the Licensed Material as-is and as-available, and makes no representations or warranties of any kind concerning the Licensed Material, whether express, implied, statutory, or other. This includes, without limitation, warranties of title, merchantability, fitness for a particular purpose, non-infringement, absence of latent or other defects, accuracy, or the presence or absence of errors, whether or not known or discoverable. Where disclaimers of warranties are not allowed in full or in part, this disclaimer may not apply to You.__
-
-b. __To the extent possible, in no event will the Licensor be liable to You on any legal theory (including, without limitation, negligence) or otherwise for any direct, special, indirect, incidental, consequential, punitive, exemplary, or other losses, costs, expenses, or damages arising out of this Public License or use of the Licensed Material, even if the Licensor has been advised of the possibility of such losses, costs, expenses, or damages. Where a limitation of liability is not allowed in full or in part, this limitation may not apply to You.__
-
-c. The disclaimer of warranties and limitation of liability provided above shall be interpreted in a manner that, to the extent possible, most closely approximates an absolute disclaimer and waiver of all liability.
-
-### Section 6  Term and Termination.
-
-a. This Public License applies for the term of the Copyright and Similar Rights licensed here. However, if You fail to comply with this Public License, then Your rights under this Public License terminate automatically.
-
-b. Where Your right to use the Licensed Material has terminated under Section 6(a), it reinstates:
-
-   1. automatically as of the date the violation is cured, provided it is cured within 30 days of Your discovery of the violation; or
-
-   2. upon express reinstatement by the Licensor.
-
-   For the avoidance of doubt, this Section 6(b) does not affect any right the Licensor may have to seek remedies for Your violations of this Public License.
-
-c. For the avoidance of doubt, the Licensor may also offer the Licensed Material under separate terms or conditions or stop distributing the Licensed Material at any time; however, doing so will not terminate this Public License.
-
-d. Sections 1, 5, 6, 7, and 8 survive termination of this Public License.
-
-### Section 7  Other Terms and Conditions.
-
-a. The Licensor shall not be bound by any additional or different terms or conditions communicated by You unless expressly agreed.
-
-b. Any arrangements, understandings, or agreements regarding the Licensed Material not stated herein are separate from and independent of the terms and conditions of this Public License.
-
-### Section 8  Interpretation.
-
-a. For the avoidance of doubt, this Public License does not, and shall not be interpreted to, reduce, limit, restrict, or impose conditions on any use of the Licensed Material that could lawfully be made without permission under this Public License.
-
-b. To the extent possible, if any provision of this Public License is deemed unenforceable, it shall be automatically reformed to the minimum extent necessary to make it enforceable. If the provision cannot be reformed, it shall be severed from this Public License without affecting the enforceability of the remaining terms and conditions.
-
-c. No term or condition of this Public License will be waived and no failure to comply consented to unless expressly agreed to by the Licensor.
-
-d. Nothing in this Public License constitutes or may be interpreted as a limitation upon, or waiver of, any privileges and immunities that apply to the Licensor or You, including from the legal processes of any jurisdiction or authority.
-
-> Creative Commons is not a party to its public licenses. Notwithstanding, Creative Commons may elect to apply one of its public licenses to material it publishes and in those instances will be considered the Licensor. Except for the limited purpose of indicating that material is shared under a Creative Commons public license or as otherwise permitted by the Creative Commons policies published at [creativecommons.org/policies](http://creativecommons.org/policies), Creative Commons does not authorize the use of the trademark Creative Commons or any other trademark or logo of Creative Commons without its prior written consent including, without limitation, in connection with any unauthorized modifications to any of its public licenses or any other arrangements, understandings, or agreements concerning use of licensed material. For the avoidance of doubt, this paragraph does not form part of the public licenses.
->
-> Creative Commons may be contacted at creativecommons.org
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/MAT.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/MAT.py
deleted file mode 100644
index 4dd0c24..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/MAT.py
+++ /dev/null
@@ -1,1612 +0,0 @@
-# type: ignore
-"""Original MAT project is copyright of fenglingwb: https://github.com/fenglinglwb/MAT
-Code used for this implementation of MAT is modified from lama-cleaner,
-copyright of Sanster: https://github.com/fenglinglwb/MAT"""
-
-
-import numpy as np
-import torch
-import torch.nn as nn
-import torch.nn.functional as F
-import torch.utils.checkpoint as checkpoint
-
-from .utils import (
-    Conv2dLayer,
-    FullyConnectedLayer,
-    activation_funcs,
-    bias_act,
-    conv2d_resample,
-    normalize_2nd_moment,
-    setup_filter,
-    to_2tuple,
-    upsample2d,
-)
-
-
-class ModulatedConv2d(nn.Module):
-    def __init__(
-        self,
-        in_channels,  # Number of input channels.
-        out_channels,  # Number of output channels.
-        kernel_size,  # Width and height of the convolution kernel.
-        style_dim,  # dimension of the style code
-        demodulate=True,  # perfrom demodulation
-        up=1,  # Integer upsampling factor.
-        down=1,  # Integer downsampling factor.
-        resample_filter=[
-            1,
-            3,
-            3,
-            1,
-        ],  # Low-pass filter to apply when resampling activations.
-        conv_clamp=None,  # Clamp the output to +-X, None = disable clamping.
-    ):
-        super().__init__()
-        self.demodulate = demodulate
-
-        self.weight = torch.nn.Parameter(
-            torch.randn([1, out_channels, in_channels, kernel_size, kernel_size])
-        )
-        self.out_channels = out_channels
-        self.kernel_size = kernel_size
-        self.weight_gain = 1 / np.sqrt(in_channels * (kernel_size**2))
-        self.padding = self.kernel_size // 2
-        self.up = up
-        self.down = down
-        self.register_buffer("resample_filter", setup_filter(resample_filter))
-        self.conv_clamp = conv_clamp
-
-        self.affine = FullyConnectedLayer(style_dim, in_channels, bias_init=1)
-
-    def forward(self, x, style):
-        batch, in_channels, height, width = x.shape
-        style = self.affine(style).view(batch, 1, in_channels, 1, 1).to(x.device)
-        weight = self.weight.to(x.device) * self.weight_gain * style
-
-        if self.demodulate:
-            decoefs = (weight.pow(2).sum(dim=[2, 3, 4]) + 1e-8).rsqrt()
-            weight = weight * decoefs.view(batch, self.out_channels, 1, 1, 1)
-
-        weight = weight.view(
-            batch * self.out_channels, in_channels, self.kernel_size, self.kernel_size
-        )
-        x = x.view(1, batch * in_channels, height, width)
-        x = conv2d_resample(
-            x=x,
-            w=weight,
-            f=self.resample_filter,
-            up=self.up,
-            down=self.down,
-            padding=self.padding,
-            groups=batch,
-        )
-        out = x.view(batch, self.out_channels, *x.shape[2:])
-
-        return out
-
-
-class StyleConv(torch.nn.Module):
-    def __init__(
-        self,
-        in_channels,  # Number of input channels.
-        out_channels,  # Number of output channels.
-        style_dim,  # Intermediate latent (W) dimensionality.
-        resolution,  # Resolution of this layer.
-        kernel_size=3,  # Convolution kernel size.
-        up=1,  # Integer upsampling factor.
-        use_noise=False,  # Enable noise input?
-        activation="lrelu",  # Activation function: 'relu', 'lrelu', etc.
-        resample_filter=[
-            1,
-            3,
-            3,
-            1,
-        ],  # Low-pass filter to apply when resampling activations.
-        conv_clamp=None,  # Clamp the output of convolution layers to +-X, None = disable clamping.
-        demodulate=True,  # perform demodulation
-    ):
-        super().__init__()
-
-        self.conv = ModulatedConv2d(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=kernel_size,
-            style_dim=style_dim,
-            demodulate=demodulate,
-            up=up,
-            resample_filter=resample_filter,
-            conv_clamp=conv_clamp,
-        )
-
-        self.use_noise = use_noise
-        self.resolution = resolution
-        if use_noise:
-            self.register_buffer("noise_const", torch.randn([resolution, resolution]))
-            self.noise_strength = torch.nn.Parameter(torch.zeros([]))
-
-        self.bias = torch.nn.Parameter(torch.zeros([out_channels]))
-        self.activation = activation
-        self.act_gain = activation_funcs[activation].def_gain
-        self.conv_clamp = conv_clamp
-
-    def forward(self, x, style, noise_mode="random", gain=1):
-        x = self.conv(x, style)
-
-        assert noise_mode in ["random", "const", "none"]
-
-        if self.use_noise:
-            if noise_mode == "random":
-                xh, xw = x.size()[-2:]
-                noise = (
-                    torch.randn([x.shape[0], 1, xh, xw], device=x.device)
-                    * self.noise_strength
-                )
-            if noise_mode == "const":
-                noise = self.noise_const * self.noise_strength
-            x = x + noise
-
-        act_gain = self.act_gain * gain
-        act_clamp = self.conv_clamp * gain if self.conv_clamp is not None else None
-        out = bias_act(
-            x, self.bias, act=self.activation, gain=act_gain, clamp=act_clamp
-        )
-
-        return out
-
-
-class ToRGB(torch.nn.Module):
-    def __init__(
-        self,
-        in_channels,
-        out_channels,
-        style_dim,
-        kernel_size=1,
-        resample_filter=[1, 3, 3, 1],
-        conv_clamp=None,
-        demodulate=False,
-    ):
-        super().__init__()
-
-        self.conv = ModulatedConv2d(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=kernel_size,
-            style_dim=style_dim,
-            demodulate=demodulate,
-            resample_filter=resample_filter,
-            conv_clamp=conv_clamp,
-        )
-        self.bias = torch.nn.Parameter(torch.zeros([out_channels]))
-        self.register_buffer("resample_filter", setup_filter(resample_filter))
-        self.conv_clamp = conv_clamp
-
-    def forward(self, x, style, skip=None):
-        x = self.conv(x, style)
-        out = bias_act(x, self.bias, clamp=self.conv_clamp)
-
-        if skip is not None:
-            if skip.shape != out.shape:
-                skip = upsample2d(skip, self.resample_filter)
-            out = out + skip
-
-        return out
-
-
-def get_style_code(a, b):
-    return torch.cat([a, b.to(a.device)], dim=1)
-
-
-class DecBlockFirst(nn.Module):
-    def __init__(
-        self,
-        in_channels,
-        out_channels,
-        activation,
-        style_dim,
-        use_noise,
-        demodulate,
-        img_channels,
-    ):
-        super().__init__()
-        self.fc = FullyConnectedLayer(
-            in_features=in_channels * 2,
-            out_features=in_channels * 4**2,
-            activation=activation,
-        )
-        self.conv = StyleConv(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=4,
-            kernel_size=3,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.toRGB = ToRGB(
-            in_channels=out_channels,
-            out_channels=img_channels,
-            style_dim=style_dim,
-            kernel_size=1,
-            demodulate=False,
-        )
-
-    def forward(self, x, ws, gs, E_features, noise_mode="random"):
-        x = self.fc(x).view(x.shape[0], -1, 4, 4)
-        x = x + E_features[2]
-        style = get_style_code(ws[:, 0], gs)
-        x = self.conv(x, style, noise_mode=noise_mode)
-        style = get_style_code(ws[:, 1], gs)
-        img = self.toRGB(x, style, skip=None)
-
-        return x, img
-
-
-class MappingNet(torch.nn.Module):
-    def __init__(
-        self,
-        z_dim,  # Input latent (Z) dimensionality, 0 = no latent.
-        c_dim,  # Conditioning label (C) dimensionality, 0 = no label.
-        w_dim,  # Intermediate latent (W) dimensionality.
-        num_ws,  # Number of intermediate latents to output, None = do not broadcast.
-        num_layers=8,  # Number of mapping layers.
-        embed_features=None,  # Label embedding dimensionality, None = same as w_dim.
-        layer_features=None,  # Number of intermediate features in the mapping layers, None = same as w_dim.
-        activation="lrelu",  # Activation function: 'relu', 'lrelu', etc.
-        lr_multiplier=0.01,  # Learning rate multiplier for the mapping layers.
-        w_avg_beta=0.995,  # Decay for tracking the moving average of W during training, None = do not track.
-    ):
-        super().__init__()
-        self.z_dim = z_dim
-        self.c_dim = c_dim
-        self.w_dim = w_dim
-        self.num_ws = num_ws
-        self.num_layers = num_layers
-        self.w_avg_beta = w_avg_beta
-
-        if embed_features is None:
-            embed_features = w_dim
-        if c_dim == 0:
-            embed_features = 0
-        if layer_features is None:
-            layer_features = w_dim
-        features_list = (
-            [z_dim + embed_features] + [layer_features] * (num_layers - 1) + [w_dim]
-        )
-
-        if c_dim > 0:
-            self.embed = FullyConnectedLayer(c_dim, embed_features)
-        for idx in range(num_layers):
-            in_features = features_list[idx]
-            out_features = features_list[idx + 1]
-            layer = FullyConnectedLayer(
-                in_features,
-                out_features,
-                activation=activation,
-                lr_multiplier=lr_multiplier,
-            )
-            setattr(self, f"fc{idx}", layer)
-
-        if num_ws is not None and w_avg_beta is not None:
-            self.register_buffer("w_avg", torch.zeros([w_dim]))
-
-    def forward(
-        self, z, c, truncation_psi=1, truncation_cutoff=None, skip_w_avg_update=False
-    ):
-        # Embed, normalize, and concat inputs.
-        x = None
-        with torch.autograd.profiler.record_function("input"):
-            if self.z_dim > 0:
-                x = normalize_2nd_moment(z.to(torch.float32))
-            if self.c_dim > 0:
-                y = normalize_2nd_moment(self.embed(c.to(torch.float32)))
-                x = torch.cat([x, y], dim=1) if x is not None else y
-
-        # Main layers.
-        for idx in range(self.num_layers):
-            layer = getattr(self, f"fc{idx}")
-            x = layer(x)
-
-        # Update moving average of W.
-        if self.w_avg_beta is not None and self.training and not skip_w_avg_update:
-            with torch.autograd.profiler.record_function("update_w_avg"):
-                self.w_avg.copy_(
-                    x.detach().mean(dim=0).lerp(self.w_avg, self.w_avg_beta)
-                )
-
-        # Broadcast.
-        if self.num_ws is not None:
-            with torch.autograd.profiler.record_function("broadcast"):
-                x = x.unsqueeze(1).repeat([1, self.num_ws, 1])
-
-        # Apply truncation.
-        if truncation_psi != 1:
-            with torch.autograd.profiler.record_function("truncate"):
-                assert self.w_avg_beta is not None
-                if self.num_ws is None or truncation_cutoff is None:
-                    x = self.w_avg.lerp(x, truncation_psi)
-                else:
-                    x[:, :truncation_cutoff] = self.w_avg.lerp(
-                        x[:, :truncation_cutoff], truncation_psi
-                    )
-
-        return x
-
-
-class DisFromRGB(nn.Module):
-    def __init__(
-        self, in_channels, out_channels, activation
-    ):  # res = 2, ..., resolution_log2
-        super().__init__()
-        self.conv = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=1,
-            activation=activation,
-        )
-
-    def forward(self, x):
-        return self.conv(x)
-
-
-class DisBlock(nn.Module):
-    def __init__(
-        self, in_channels, out_channels, activation
-    ):  # res = 2, ..., resolution_log2
-        super().__init__()
-        self.conv0 = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=in_channels,
-            kernel_size=3,
-            activation=activation,
-        )
-        self.conv1 = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            down=2,
-            activation=activation,
-        )
-        self.skip = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=1,
-            down=2,
-            bias=False,
-        )
-
-    def forward(self, x):
-        skip = self.skip(x, gain=np.sqrt(0.5))
-        x = self.conv0(x)
-        x = self.conv1(x, gain=np.sqrt(0.5))
-        out = skip + x
-
-        return out
-
-
-def nf(stage, channel_base=32768, channel_decay=1.0, channel_max=512):
-    NF = {512: 64, 256: 128, 128: 256, 64: 512, 32: 512, 16: 512, 8: 512, 4: 512}
-    return NF[2**stage]
-
-
-class Mlp(nn.Module):
-    def __init__(
-        self,
-        in_features,
-        hidden_features=None,
-        out_features=None,
-        act_layer=nn.GELU,
-        drop=0.0,
-    ):
-        super().__init__()
-        out_features = out_features or in_features
-        hidden_features = hidden_features or in_features
-        self.fc1 = FullyConnectedLayer(
-            in_features=in_features, out_features=hidden_features, activation="lrelu"
-        )
-        self.fc2 = FullyConnectedLayer(
-            in_features=hidden_features, out_features=out_features
-        )
-
-    def forward(self, x):
-        x = self.fc1(x)
-        x = self.fc2(x)
-        return x
-
-
-def window_partition(x, window_size):
-    """
-    Args:
-        x: (B, H, W, C)
-        window_size (int): window size
-    Returns:
-        windows: (num_windows*B, window_size, window_size, C)
-    """
-    B, H, W, C = x.shape
-    x = x.view(B, H // window_size, window_size, W // window_size, window_size, C)
-    windows = (
-        x.permute(0, 1, 3, 2, 4, 5).contiguous().view(-1, window_size, window_size, C)
-    )
-    return windows
-
-
-def window_reverse(windows, window_size: int, H: int, W: int):
-    """
-    Args:
-        windows: (num_windows*B, window_size, window_size, C)
-        window_size (int): Window size
-        H (int): Height of image
-        W (int): Width of image
-    Returns:
-        x: (B, H, W, C)
-    """
-    B = int(windows.shape[0] / (H * W / window_size / window_size))
-    # B = windows.shape[0] / (H * W / window_size / window_size)
-    x = windows.view(
-        B, H // window_size, W // window_size, window_size, window_size, -1
-    )
-    x = x.permute(0, 1, 3, 2, 4, 5).contiguous().view(B, H, W, -1)
-    return x
-
-
-class Conv2dLayerPartial(nn.Module):
-    def __init__(
-        self,
-        in_channels,  # Number of input channels.
-        out_channels,  # Number of output channels.
-        kernel_size,  # Width and height of the convolution kernel.
-        bias=True,  # Apply additive bias before the activation function?
-        activation="linear",  # Activation function: 'relu', 'lrelu', etc.
-        up=1,  # Integer upsampling factor.
-        down=1,  # Integer downsampling factor.
-        resample_filter=[
-            1,
-            3,
-            3,
-            1,
-        ],  # Low-pass filter to apply when resampling activations.
-        conv_clamp=None,  # Clamp the output to +-X, None = disable clamping.
-        trainable=True,  # Update the weights of this layer during training?
-    ):
-        super().__init__()
-        self.conv = Conv2dLayer(
-            in_channels,
-            out_channels,
-            kernel_size,
-            bias,
-            activation,
-            up,
-            down,
-            resample_filter,
-            conv_clamp,
-            trainable,
-        )
-
-        self.weight_maskUpdater = torch.ones(1, 1, kernel_size, kernel_size)
-        self.slide_winsize = kernel_size**2
-        self.stride = down
-        self.padding = kernel_size // 2 if kernel_size % 2 == 1 else 0
-
-    def forward(self, x, mask=None):
-        if mask is not None:
-            with torch.no_grad():
-                if self.weight_maskUpdater.type() != x.type():
-                    self.weight_maskUpdater = self.weight_maskUpdater.to(x)
-                update_mask = F.conv2d(
-                    mask,
-                    self.weight_maskUpdater,
-                    bias=None,
-                    stride=self.stride,
-                    padding=self.padding,
-                )
-                mask_ratio = self.slide_winsize / (update_mask + 1e-8)
-                update_mask = torch.clamp(update_mask, 0, 1)  # 0 or 1
-                mask_ratio = torch.mul(mask_ratio, update_mask)
-            x = self.conv(x)
-            x = torch.mul(x, mask_ratio)
-            return x, update_mask
-        else:
-            x = self.conv(x)
-            return x, None
-
-
-class WindowAttention(nn.Module):
-    r"""Window based multi-head self attention (W-MSA) module with relative position bias.
-    It supports both of shifted and non-shifted window.
-    Args:
-        dim (int): Number of input channels.
-        window_size (tuple[int]): The height and width of the window.
-        num_heads (int): Number of attention heads.
-        qkv_bias (bool, optional):  If True, add a learnable bias to query, key, value. Default: True
-        qk_scale (float | None, optional): Override default qk scale of head_dim ** -0.5 if set
-        attn_drop (float, optional): Dropout ratio of attention weight. Default: 0.0
-        proj_drop (float, optional): Dropout ratio of output. Default: 0.0
-    """
-
-    def __init__(
-        self,
-        dim,
-        window_size,
-        num_heads,
-        down_ratio=1,
-        qkv_bias=True,
-        qk_scale=None,
-        attn_drop=0.0,
-        proj_drop=0.0,
-    ):
-        super().__init__()
-        self.dim = dim
-        self.window_size = window_size  # Wh, Ww
-        self.num_heads = num_heads
-        head_dim = dim // num_heads
-        self.scale = qk_scale or head_dim**-0.5
-
-        self.q = FullyConnectedLayer(in_features=dim, out_features=dim)
-        self.k = FullyConnectedLayer(in_features=dim, out_features=dim)
-        self.v = FullyConnectedLayer(in_features=dim, out_features=dim)
-        self.proj = FullyConnectedLayer(in_features=dim, out_features=dim)
-
-        self.softmax = nn.Softmax(dim=-1)
-
-    def forward(self, x, mask_windows=None, mask=None):
-        """
-        Args:
-            x: input features with shape of (num_windows*B, N, C)
-            mask: (0/-inf) mask with shape of (num_windows, Wh*Ww, Wh*Ww) or None
-        """
-        B_, N, C = x.shape
-        norm_x = F.normalize(x, p=2.0, dim=-1)
-        q = (
-            self.q(norm_x)
-            .reshape(B_, N, self.num_heads, C // self.num_heads)
-            .permute(0, 2, 1, 3)
-        )
-        k = (
-            self.k(norm_x)
-            .view(B_, -1, self.num_heads, C // self.num_heads)
-            .permute(0, 2, 3, 1)
-        )
-        v = (
-            self.v(x)
-            .view(B_, -1, self.num_heads, C // self.num_heads)
-            .permute(0, 2, 1, 3)
-        )
-
-        attn = (q @ k) * self.scale
-
-        if mask is not None:
-            nW = mask.shape[0]
-            attn = attn.view(B_ // nW, nW, self.num_heads, N, N) + mask.unsqueeze(
-                1
-            ).unsqueeze(0)
-            attn = attn.view(-1, self.num_heads, N, N)
-
-        if mask_windows is not None:
-            attn_mask_windows = mask_windows.squeeze(-1).unsqueeze(1).unsqueeze(1)
-            attn = attn + attn_mask_windows.masked_fill(
-                attn_mask_windows == 0, float(-100.0)
-            ).masked_fill(attn_mask_windows == 1, 0.0)
-            with torch.no_grad():
-                mask_windows = torch.clamp(
-                    torch.sum(mask_windows, dim=1, keepdim=True), 0, 1
-                ).repeat(1, N, 1)
-
-        attn = self.softmax(attn)
-
-        x = (attn @ v).transpose(1, 2).reshape(B_, N, C)
-        x = self.proj(x)
-        return x, mask_windows
-
-
-class SwinTransformerBlock(nn.Module):
-    r"""Swin Transformer Block.
-    Args:
-        dim (int): Number of input channels.
-        input_resolution (tuple[int]): Input resulotion.
-        num_heads (int): Number of attention heads.
-        window_size (int): Window size.
-        shift_size (int): Shift size for SW-MSA.
-        mlp_ratio (float): Ratio of mlp hidden dim to embedding dim.
-        qkv_bias (bool, optional): If True, add a learnable bias to query, key, value. Default: True
-        qk_scale (float | None, optional): Override default qk scale of head_dim ** -0.5 if set.
-        drop (float, optional): Dropout rate. Default: 0.0
-        attn_drop (float, optional): Attention dropout rate. Default: 0.0
-        drop_path (float, optional): Stochastic depth rate. Default: 0.0
-        act_layer (nn.Module, optional): Activation layer. Default: nn.GELU
-        norm_layer (nn.Module, optional): Normalization layer.  Default: nn.LayerNorm
-    """
-
-    def __init__(
-        self,
-        dim,
-        input_resolution,
-        num_heads,
-        down_ratio=1,
-        window_size=7,
-        shift_size=0,
-        mlp_ratio=4.0,
-        qkv_bias=True,
-        qk_scale=None,
-        drop=0.0,
-        attn_drop=0.0,
-        drop_path=0.0,
-        act_layer=nn.GELU,
-        norm_layer=nn.LayerNorm,
-    ):
-        super().__init__()
-        self.dim = dim
-        self.input_resolution = input_resolution
-        self.num_heads = num_heads
-        self.window_size = window_size
-        self.shift_size = shift_size
-        self.mlp_ratio = mlp_ratio
-        if min(self.input_resolution) <= self.window_size:
-            # if window size is larger than input resolution, we don't partition windows
-            self.shift_size = 0
-            self.window_size = min(self.input_resolution)
-        assert (
-            0 <= self.shift_size < self.window_size
-        ), "shift_size must in 0-window_size"
-
-        if self.shift_size > 0:
-            down_ratio = 1
-        self.attn = WindowAttention(
-            dim,
-            window_size=to_2tuple(self.window_size),
-            num_heads=num_heads,
-            down_ratio=down_ratio,
-            qkv_bias=qkv_bias,
-            qk_scale=qk_scale,
-            attn_drop=attn_drop,
-            proj_drop=drop,
-        )
-
-        self.fuse = FullyConnectedLayer(
-            in_features=dim * 2, out_features=dim, activation="lrelu"
-        )
-
-        mlp_hidden_dim = int(dim * mlp_ratio)
-        self.mlp = Mlp(
-            in_features=dim,
-            hidden_features=mlp_hidden_dim,
-            act_layer=act_layer,
-            drop=drop,
-        )
-
-        if self.shift_size > 0:
-            attn_mask = self.calculate_mask(self.input_resolution)
-        else:
-            attn_mask = None
-
-        self.register_buffer("attn_mask", attn_mask)
-
-    def calculate_mask(self, x_size):
-        # calculate attention mask for SW-MSA
-        H, W = x_size
-        img_mask = torch.zeros((1, H, W, 1))  # 1 H W 1
-        h_slices = (
-            slice(0, -self.window_size),
-            slice(-self.window_size, -self.shift_size),
-            slice(-self.shift_size, None),
-        )
-        w_slices = (
-            slice(0, -self.window_size),
-            slice(-self.window_size, -self.shift_size),
-            slice(-self.shift_size, None),
-        )
-        cnt = 0
-        for h in h_slices:
-            for w in w_slices:
-                img_mask[:, h, w, :] = cnt
-                cnt += 1
-
-        mask_windows = window_partition(
-            img_mask, self.window_size
-        )  # nW, window_size, window_size, 1
-        mask_windows = mask_windows.view(-1, self.window_size * self.window_size)
-        attn_mask = mask_windows.unsqueeze(1) - mask_windows.unsqueeze(2)
-        attn_mask = attn_mask.masked_fill(attn_mask != 0, float(-100.0)).masked_fill(
-            attn_mask == 0, 0.0
-        )
-
-        return attn_mask
-
-    def forward(self, x, x_size, mask=None):
-        # H, W = self.input_resolution
-        H, W = x_size
-        B, _, C = x.shape
-        # assert L == H * W, "input feature has wrong size"
-
-        shortcut = x
-        x = x.view(B, H, W, C)
-        if mask is not None:
-            mask = mask.view(B, H, W, 1)
-
-        # cyclic shift
-        if self.shift_size > 0:
-            shifted_x = torch.roll(
-                x, shifts=(-self.shift_size, -self.shift_size), dims=(1, 2)
-            )
-            if mask is not None:
-                shifted_mask = torch.roll(
-                    mask, shifts=(-self.shift_size, -self.shift_size), dims=(1, 2)
-                )
-        else:
-            shifted_x = x
-            if mask is not None:
-                shifted_mask = mask
-
-        # partition windows
-        x_windows = window_partition(
-            shifted_x, self.window_size
-        )  # nW*B, window_size, window_size, C
-        x_windows = x_windows.view(
-            -1, self.window_size * self.window_size, C
-        )  # nW*B, window_size*window_size, C
-        if mask is not None:
-            mask_windows = window_partition(shifted_mask, self.window_size)
-            mask_windows = mask_windows.view(-1, self.window_size * self.window_size, 1)
-        else:
-            mask_windows = None
-
-        # W-MSA/SW-MSA (to be compatible for testing on images whose shapes are the multiple of window size
-        if self.input_resolution == x_size:
-            attn_windows, mask_windows = self.attn(
-                x_windows, mask_windows, mask=self.attn_mask
-            )  # nW*B, window_size*window_size, C
-        else:
-            attn_windows, mask_windows = self.attn(
-                x_windows, mask_windows, mask=self.calculate_mask(x_size).to(x.device)
-            )  # nW*B, window_size*window_size, C
-
-        # merge windows
-        attn_windows = attn_windows.view(-1, self.window_size, self.window_size, C)
-        shifted_x = window_reverse(attn_windows, self.window_size, H, W)  # B H' W' C
-        if mask is not None:
-            mask_windows = mask_windows.view(-1, self.window_size, self.window_size, 1)
-            shifted_mask = window_reverse(mask_windows, self.window_size, H, W)
-
-        # reverse cyclic shift
-        if self.shift_size > 0:
-            x = torch.roll(
-                shifted_x, shifts=(self.shift_size, self.shift_size), dims=(1, 2)
-            )
-            if mask is not None:
-                mask = torch.roll(
-                    shifted_mask, shifts=(self.shift_size, self.shift_size), dims=(1, 2)
-                )
-        else:
-            x = shifted_x
-            if mask is not None:
-                mask = shifted_mask
-        x = x.view(B, H * W, C)
-        if mask is not None:
-            mask = mask.view(B, H * W, 1)
-
-        # FFN
-        x = self.fuse(torch.cat([shortcut, x], dim=-1))
-        x = self.mlp(x)
-
-        return x, mask
-
-
-class PatchMerging(nn.Module):
-    def __init__(self, in_channels, out_channels, down=2):
-        super().__init__()
-        self.conv = Conv2dLayerPartial(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            activation="lrelu",
-            down=down,
-        )
-        self.down = down
-
-    def forward(self, x, x_size, mask=None):
-        x = token2feature(x, x_size)
-        if mask is not None:
-            mask = token2feature(mask, x_size)
-        x, mask = self.conv(x, mask)
-        if self.down != 1:
-            ratio = 1 / self.down
-            x_size = (int(x_size[0] * ratio), int(x_size[1] * ratio))
-        x = feature2token(x)
-        if mask is not None:
-            mask = feature2token(mask)
-        return x, x_size, mask
-
-
-class PatchUpsampling(nn.Module):
-    def __init__(self, in_channels, out_channels, up=2):
-        super().__init__()
-        self.conv = Conv2dLayerPartial(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            activation="lrelu",
-            up=up,
-        )
-        self.up = up
-
-    def forward(self, x, x_size, mask=None):
-        x = token2feature(x, x_size)
-        if mask is not None:
-            mask = token2feature(mask, x_size)
-        x, mask = self.conv(x, mask)
-        if self.up != 1:
-            x_size = (int(x_size[0] * self.up), int(x_size[1] * self.up))
-        x = feature2token(x)
-        if mask is not None:
-            mask = feature2token(mask)
-        return x, x_size, mask
-
-
-class BasicLayer(nn.Module):
-    """A basic Swin Transformer layer for one stage.
-    Args:
-        dim (int): Number of input channels.
-        input_resolution (tuple[int]): Input resolution.
-        depth (int): Number of blocks.
-        num_heads (int): Number of attention heads.
-        window_size (int): Local window size.
-        mlp_ratio (float): Ratio of mlp hidden dim to embedding dim.
-        qkv_bias (bool, optional): If True, add a learnable bias to query, key, value. Default: True
-        qk_scale (float | None, optional): Override default qk scale of head_dim ** -0.5 if set.
-        drop (float, optional): Dropout rate. Default: 0.0
-        attn_drop (float, optional): Attention dropout rate. Default: 0.0
-        drop_path (float | tuple[float], optional): Stochastic depth rate. Default: 0.0
-        norm_layer (nn.Module, optional): Normalization layer. Default: nn.LayerNorm
-        downsample (nn.Module | None, optional): Downsample layer at the end of the layer. Default: None
-        use_checkpoint (bool): Whether to use checkpointing to save memory. Default: False.
-    """
-
-    def __init__(
-        self,
-        dim,
-        input_resolution,
-        depth,
-        num_heads,
-        window_size,
-        down_ratio=1,
-        mlp_ratio=2.0,
-        qkv_bias=True,
-        qk_scale=None,
-        drop=0.0,
-        attn_drop=0.0,
-        drop_path=0.0,
-        norm_layer=nn.LayerNorm,
-        downsample=None,
-        use_checkpoint=False,
-    ):
-        super().__init__()
-        self.dim = dim
-        self.input_resolution = input_resolution
-        self.depth = depth
-        self.use_checkpoint = use_checkpoint
-
-        # patch merging layer
-        if downsample is not None:
-            # self.downsample = downsample(input_resolution, dim=dim, norm_layer=norm_layer)
-            self.downsample = downsample
-        else:
-            self.downsample = None
-
-        # build blocks
-        self.blocks = nn.ModuleList(
-            [
-                SwinTransformerBlock(
-                    dim=dim,
-                    input_resolution=input_resolution,
-                    num_heads=num_heads,
-                    down_ratio=down_ratio,
-                    window_size=window_size,
-                    shift_size=0 if (i % 2 == 0) else window_size // 2,
-                    mlp_ratio=mlp_ratio,
-                    qkv_bias=qkv_bias,
-                    qk_scale=qk_scale,
-                    drop=drop,
-                    attn_drop=attn_drop,
-                    drop_path=drop_path[i]
-                    if isinstance(drop_path, list)
-                    else drop_path,
-                    norm_layer=norm_layer,
-                )
-                for i in range(depth)
-            ]
-        )
-
-        self.conv = Conv2dLayerPartial(
-            in_channels=dim, out_channels=dim, kernel_size=3, activation="lrelu"
-        )
-
-    def forward(self, x, x_size, mask=None):
-        if self.downsample is not None:
-            x, x_size, mask = self.downsample(x, x_size, mask)
-        identity = x
-        for blk in self.blocks:
-            if self.use_checkpoint:
-                x, mask = checkpoint.checkpoint(blk, x, x_size, mask)
-            else:
-                x, mask = blk(x, x_size, mask)
-        if mask is not None:
-            mask = token2feature(mask, x_size)
-        x, mask = self.conv(token2feature(x, x_size), mask)
-        x = feature2token(x) + identity
-        if mask is not None:
-            mask = feature2token(mask)
-        return x, x_size, mask
-
-
-class ToToken(nn.Module):
-    def __init__(self, in_channels=3, dim=128, kernel_size=5, stride=1):
-        super().__init__()
-
-        self.proj = Conv2dLayerPartial(
-            in_channels=in_channels,
-            out_channels=dim,
-            kernel_size=kernel_size,
-            activation="lrelu",
-        )
-
-    def forward(self, x, mask):
-        x, mask = self.proj(x, mask)
-
-        return x, mask
-
-
-class EncFromRGB(nn.Module):
-    def __init__(
-        self, in_channels, out_channels, activation
-    ):  # res = 2, ..., resolution_log2
-        super().__init__()
-        self.conv0 = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=1,
-            activation=activation,
-        )
-        self.conv1 = Conv2dLayer(
-            in_channels=out_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            activation=activation,
-        )
-
-    def forward(self, x):
-        x = self.conv0(x)
-        x = self.conv1(x)
-
-        return x
-
-
-class ConvBlockDown(nn.Module):
-    def __init__(
-        self, in_channels, out_channels, activation
-    ):  # res = 2, ..., resolution_log
-        super().__init__()
-
-        self.conv0 = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            activation=activation,
-            down=2,
-        )
-        self.conv1 = Conv2dLayer(
-            in_channels=out_channels,
-            out_channels=out_channels,
-            kernel_size=3,
-            activation=activation,
-        )
-
-    def forward(self, x):
-        x = self.conv0(x)
-        x = self.conv1(x)
-
-        return x
-
-
-def token2feature(x, x_size):
-    B, _, C = x.shape
-    h, w = x_size
-    x = x.permute(0, 2, 1).reshape(B, C, h, w)
-    return x
-
-
-def feature2token(x):
-    B, C, _, _ = x.shape
-    x = x.view(B, C, -1).transpose(1, 2)
-    return x
-
-
-class Encoder(nn.Module):
-    def __init__(
-        self,
-        res_log2,
-        img_channels,
-        activation,
-        patch_size=5,
-        channels=16,
-        drop_path_rate=0.1,
-    ):
-        super().__init__()
-
-        self.resolution = []
-
-        for i in range(res_log2, 3, -1):  # from input size to 16x16
-            res = 2**i
-            self.resolution.append(res)
-            if i == res_log2:
-                block = EncFromRGB(img_channels * 2 + 1, nf(i), activation)
-            else:
-                block = ConvBlockDown(nf(i + 1), nf(i), activation)
-            setattr(self, "EncConv_Block_%dx%d" % (res, res), block)
-
-    def forward(self, x):
-        out = {}
-        for res in self.resolution:
-            res_log2 = int(np.log2(res))
-            x = getattr(self, "EncConv_Block_%dx%d" % (res, res))(x)
-            out[res_log2] = x
-
-        return out
-
-
-class ToStyle(nn.Module):
-    def __init__(self, in_channels, out_channels, activation, drop_rate):
-        super().__init__()
-        self.conv = nn.Sequential(
-            Conv2dLayer(
-                in_channels=in_channels,
-                out_channels=in_channels,
-                kernel_size=3,
-                activation=activation,
-                down=2,
-            ),
-            Conv2dLayer(
-                in_channels=in_channels,
-                out_channels=in_channels,
-                kernel_size=3,
-                activation=activation,
-                down=2,
-            ),
-            Conv2dLayer(
-                in_channels=in_channels,
-                out_channels=in_channels,
-                kernel_size=3,
-                activation=activation,
-                down=2,
-            ),
-        )
-
-        self.pool = nn.AdaptiveAvgPool2d(1)
-        self.fc = FullyConnectedLayer(
-            in_features=in_channels, out_features=out_channels, activation=activation
-        )
-        # self.dropout = nn.Dropout(drop_rate)
-
-    def forward(self, x):
-        x = self.conv(x)
-        x = self.pool(x)
-        x = self.fc(x.flatten(start_dim=1))
-        # x = self.dropout(x)
-
-        return x
-
-
-class DecBlockFirstV2(nn.Module):
-    def __init__(
-        self,
-        res,
-        in_channels,
-        out_channels,
-        activation,
-        style_dim,
-        use_noise,
-        demodulate,
-        img_channels,
-    ):
-        super().__init__()
-        self.res = res
-
-        self.conv0 = Conv2dLayer(
-            in_channels=in_channels,
-            out_channels=in_channels,
-            kernel_size=3,
-            activation=activation,
-        )
-        self.conv1 = StyleConv(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=2**res,
-            kernel_size=3,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.toRGB = ToRGB(
-            in_channels=out_channels,
-            out_channels=img_channels,
-            style_dim=style_dim,
-            kernel_size=1,
-            demodulate=False,
-        )
-
-    def forward(self, x, ws, gs, E_features, noise_mode="random"):
-        # x = self.fc(x).view(x.shape[0], -1, 4, 4)
-        x = self.conv0(x)
-        x = x + E_features[self.res]
-        style = get_style_code(ws[:, 0], gs)
-        x = self.conv1(x, style, noise_mode=noise_mode)
-        style = get_style_code(ws[:, 1], gs)
-        img = self.toRGB(x, style, skip=None)
-
-        return x, img
-
-
-class DecBlock(nn.Module):
-    def __init__(
-        self,
-        res,
-        in_channels,
-        out_channels,
-        activation,
-        style_dim,
-        use_noise,
-        demodulate,
-        img_channels,
-    ):  # res = 4, ..., resolution_log2
-        super().__init__()
-        self.res = res
-
-        self.conv0 = StyleConv(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=2**res,
-            kernel_size=3,
-            up=2,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.conv1 = StyleConv(
-            in_channels=out_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=2**res,
-            kernel_size=3,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.toRGB = ToRGB(
-            in_channels=out_channels,
-            out_channels=img_channels,
-            style_dim=style_dim,
-            kernel_size=1,
-            demodulate=False,
-        )
-
-    def forward(self, x, img, ws, gs, E_features, noise_mode="random"):
-        style = get_style_code(ws[:, self.res * 2 - 9], gs)
-        x = self.conv0(x, style, noise_mode=noise_mode)
-        x = x + E_features[self.res]
-        style = get_style_code(ws[:, self.res * 2 - 8], gs)
-        x = self.conv1(x, style, noise_mode=noise_mode)
-        style = get_style_code(ws[:, self.res * 2 - 7], gs)
-        img = self.toRGB(x, style, skip=img)
-
-        return x, img
-
-
-class Decoder(nn.Module):
-    def __init__(
-        self, res_log2, activation, style_dim, use_noise, demodulate, img_channels
-    ):
-        super().__init__()
-        self.Dec_16x16 = DecBlockFirstV2(
-            4, nf(4), nf(4), activation, style_dim, use_noise, demodulate, img_channels
-        )
-        for res in range(5, res_log2 + 1):
-            setattr(
-                self,
-                "Dec_%dx%d" % (2**res, 2**res),
-                DecBlock(
-                    res,
-                    nf(res - 1),
-                    nf(res),
-                    activation,
-                    style_dim,
-                    use_noise,
-                    demodulate,
-                    img_channels,
-                ),
-            )
-        self.res_log2 = res_log2
-
-    def forward(self, x, ws, gs, E_features, noise_mode="random"):
-        x, img = self.Dec_16x16(x, ws, gs, E_features, noise_mode=noise_mode)
-        for res in range(5, self.res_log2 + 1):
-            block = getattr(self, "Dec_%dx%d" % (2**res, 2**res))
-            x, img = block(x, img, ws, gs, E_features, noise_mode=noise_mode)
-
-        return img
-
-
-class DecStyleBlock(nn.Module):
-    def __init__(
-        self,
-        res,
-        in_channels,
-        out_channels,
-        activation,
-        style_dim,
-        use_noise,
-        demodulate,
-        img_channels,
-    ):
-        super().__init__()
-        self.res = res
-
-        self.conv0 = StyleConv(
-            in_channels=in_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=2**res,
-            kernel_size=3,
-            up=2,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.conv1 = StyleConv(
-            in_channels=out_channels,
-            out_channels=out_channels,
-            style_dim=style_dim,
-            resolution=2**res,
-            kernel_size=3,
-            use_noise=use_noise,
-            activation=activation,
-            demodulate=demodulate,
-        )
-        self.toRGB = ToRGB(
-            in_channels=out_channels,
-            out_channels=img_channels,
-            style_dim=style_dim,
-            kernel_size=1,
-            demodulate=False,
-        )
-
-    def forward(self, x, img, style, skip, noise_mode="random"):
-        x = self.conv0(x, style, noise_mode=noise_mode)
-        x = x + skip
-        x = self.conv1(x, style, noise_mode=noise_mode)
-        img = self.toRGB(x, style, skip=img)
-
-        return x, img
-
-
-class FirstStage(nn.Module):
-    def __init__(
-        self,
-        img_channels,
-        img_resolution=256,
-        dim=180,
-        w_dim=512,
-        use_noise=False,
-        demodulate=True,
-        activation="lrelu",
-    ):
-        super().__init__()
-        res = 64
-
-        self.conv_first = Conv2dLayerPartial(
-            in_channels=img_channels + 1,
-            out_channels=dim,
-            kernel_size=3,
-            activation=activation,
-        )
-        self.enc_conv = nn.ModuleList()
-        down_time = int(np.log2(img_resolution // res))
-        #  swim transformer 
-        for i in range(down_time):  # from input size to 64
-            self.enc_conv.append(
-                Conv2dLayerPartial(
-                    in_channels=dim,
-                    out_channels=dim,
-                    kernel_size=3,
-                    down=2,
-                    activation=activation,
-                )
-            )
-
-        # from 64 -> 16 -> 64
-        depths = [2, 3, 4, 3, 2]
-        ratios = [1, 1 / 2, 1 / 2, 2, 2]
-        num_heads = 6
-        window_sizes = [8, 16, 16, 16, 8]
-        drop_path_rate = 0.1
-        dpr = [x.item() for x in torch.linspace(0, drop_path_rate, sum(depths))]
-
-        self.tran = nn.ModuleList()
-        for i, depth in enumerate(depths):
-            res = int(res * ratios[i])
-            if ratios[i] < 1:
-                merge = PatchMerging(dim, dim, down=int(1 / ratios[i]))
-            elif ratios[i] > 1:
-                merge = PatchUpsampling(dim, dim, up=ratios[i])
-            else:
-                merge = None
-            self.tran.append(
-                BasicLayer(
-                    dim=dim,
-                    input_resolution=[res, res],
-                    depth=depth,
-                    num_heads=num_heads,
-                    window_size=window_sizes[i],
-                    drop_path=dpr[sum(depths[:i]) : sum(depths[: i + 1])],
-                    downsample=merge,
-                )
-            )
-
-        # global style
-        down_conv = []
-        for i in range(int(np.log2(16))):
-            down_conv.append(
-                Conv2dLayer(
-                    in_channels=dim,
-                    out_channels=dim,
-                    kernel_size=3,
-                    down=2,
-                    activation=activation,
-                )
-            )
-        down_conv.append(nn.AdaptiveAvgPool2d((1, 1)))
-        self.down_conv = nn.Sequential(*down_conv)
-        self.to_style = FullyConnectedLayer(
-            in_features=dim, out_features=dim * 2, activation=activation
-        )
-        self.ws_style = FullyConnectedLayer(
-            in_features=w_dim, out_features=dim, activation=activation
-        )
-        self.to_square = FullyConnectedLayer(
-            in_features=dim, out_features=16 * 16, activation=activation
-        )
-
-        style_dim = dim * 3
-        self.dec_conv = nn.ModuleList()
-        for i in range(down_time):  # from 64 to input size
-            res = res * 2
-            self.dec_conv.append(
-                DecStyleBlock(
-                    res,
-                    dim,
-                    dim,
-                    activation,
-                    style_dim,
-                    use_noise,
-                    demodulate,
-                    img_channels,
-                )
-            )
-
-    def forward(self, images_in, masks_in, ws, noise_mode="random"):
-        x = torch.cat([masks_in - 0.5, images_in * masks_in], dim=1)
-
-        skips = []
-        x, mask = self.conv_first(x, masks_in)  # input size
-        skips.append(x)
-        for i, block in enumerate(self.enc_conv):  # input size to 64
-            x, mask = block(x, mask)
-            if i != len(self.enc_conv) - 1:
-                skips.append(x)
-
-        x_size = x.size()[-2:]
-        x = feature2token(x)
-        mask = feature2token(mask)
-        mid = len(self.tran) // 2
-        for i, block in enumerate(self.tran):  # 64 to 16
-            if i < mid:
-                x, x_size, mask = block(x, x_size, mask)
-                skips.append(x)
-            elif i > mid:
-                x, x_size, mask = block(x, x_size, None)
-                x = x + skips[mid - i]
-            else:
-                x, x_size, mask = block(x, x_size, None)
-
-                mul_map = torch.ones_like(x) * 0.5
-                mul_map = F.dropout(mul_map, training=True).to(x.device)
-                ws = self.ws_style(ws[:, -1]).to(x.device)
-                add_n = self.to_square(ws).unsqueeze(1).to(x.device)
-                add_n = (
-                    F.interpolate(
-                        add_n, size=x.size(1), mode="linear", align_corners=False
-                    )
-                    .squeeze(1)
-                    .unsqueeze(-1)
-                ).to(x.device)
-                x = x * mul_map + add_n * (1 - mul_map)
-                gs = self.to_style(
-                    self.down_conv(token2feature(x, x_size)).flatten(start_dim=1)
-                ).to(x.device)
-                style = torch.cat([gs, ws], dim=1)
-
-        x = token2feature(x, x_size).contiguous()
-        img = None
-        for i, block in enumerate(self.dec_conv):
-            x, img = block(
-                x, img, style, skips[len(self.dec_conv) - i - 1], noise_mode=noise_mode
-            )
-
-        # ensemble
-        img = img * (1 - masks_in) + images_in * masks_in
-
-        return img
-
-
-class SynthesisNet(nn.Module):
-    def __init__(
-        self,
-        w_dim,  # Intermediate latent (W) dimensionality.
-        img_resolution,  # Output image resolution.
-        img_channels=3,  # Number of color channels.
-        channel_base=32768,  # Overall multiplier for the number of channels.
-        channel_decay=1.0,
-        channel_max=512,  # Maximum number of channels in any layer.
-        activation="lrelu",  # Activation function: 'relu', 'lrelu', etc.
-        drop_rate=0.5,
-        use_noise=False,
-        demodulate=True,
-    ):
-        super().__init__()
-        resolution_log2 = int(np.log2(img_resolution))
-        assert img_resolution == 2**resolution_log2 and img_resolution >= 4
-
-        self.num_layers = resolution_log2 * 2 - 3 * 2
-        self.img_resolution = img_resolution
-        self.resolution_log2 = resolution_log2
-
-        # first stage
-        self.first_stage = FirstStage(
-            img_channels,
-            img_resolution=img_resolution,
-            w_dim=w_dim,
-            use_noise=False,
-            demodulate=demodulate,
-        )
-
-        # second stage
-        self.enc = Encoder(
-            resolution_log2, img_channels, activation, patch_size=5, channels=16
-        )
-        self.to_square = FullyConnectedLayer(
-            in_features=w_dim, out_features=16 * 16, activation=activation
-        )
-        self.to_style = ToStyle(
-            in_channels=nf(4),
-            out_channels=nf(2) * 2,
-            activation=activation,
-            drop_rate=drop_rate,
-        )
-        style_dim = w_dim + nf(2) * 2
-        self.dec = Decoder(
-            resolution_log2, activation, style_dim, use_noise, demodulate, img_channels
-        )
-
-    def forward(self, images_in, masks_in, ws, noise_mode="random", return_stg1=False):
-        out_stg1 = self.first_stage(images_in, masks_in, ws, noise_mode=noise_mode)
-
-        # encoder
-        x = images_in * masks_in + out_stg1 * (1 - masks_in)
-        x = torch.cat([masks_in - 0.5, x, images_in * masks_in], dim=1)
-        E_features = self.enc(x)
-
-        fea_16 = E_features[4].to(x.device)
-        mul_map = torch.ones_like(fea_16) * 0.5
-        mul_map = F.dropout(mul_map, training=True).to(x.device)
-        add_n = self.to_square(ws[:, 0]).view(-1, 16, 16).unsqueeze(1)
-        add_n = F.interpolate(
-            add_n, size=fea_16.size()[-2:], mode="bilinear", align_corners=False
-        ).to(x.device)
-        fea_16 = fea_16 * mul_map + add_n * (1 - mul_map)
-        E_features[4] = fea_16
-
-        # style
-        gs = self.to_style(fea_16).to(x.device)
-
-        # decoder
-        img = self.dec(fea_16, ws, gs, E_features, noise_mode=noise_mode).to(x.device)
-
-        # ensemble
-        img = img * (1 - masks_in) + images_in * masks_in
-
-        if not return_stg1:
-            return img
-        else:
-            return img, out_stg1
-
-
-class Generator(nn.Module):
-    def __init__(
-        self,
-        z_dim,  # Input latent (Z) dimensionality, 0 = no latent.
-        c_dim,  # Conditioning label (C) dimensionality, 0 = no label.
-        w_dim,  # Intermediate latent (W) dimensionality.
-        img_resolution,  # resolution of generated image
-        img_channels,  # Number of input color channels.
-        synthesis_kwargs={},  # Arguments for SynthesisNetwork.
-        mapping_kwargs={},  # Arguments for MappingNetwork.
-    ):
-        super().__init__()
-        self.z_dim = z_dim
-        self.c_dim = c_dim
-        self.w_dim = w_dim
-        self.img_resolution = img_resolution
-        self.img_channels = img_channels
-
-        self.synthesis = SynthesisNet(
-            w_dim=w_dim,
-            img_resolution=img_resolution,
-            img_channels=img_channels,
-            **synthesis_kwargs,
-        )
-        self.mapping = MappingNet(
-            z_dim=z_dim,
-            c_dim=c_dim,
-            w_dim=w_dim,
-            num_ws=self.synthesis.num_layers,
-            **mapping_kwargs,
-        )
-
-    def forward(
-        self,
-        images_in,
-        masks_in,
-        z,
-        c,
-        truncation_psi=1,
-        truncation_cutoff=None,
-        skip_w_avg_update=False,
-        noise_mode="none",
-        return_stg1=False,
-    ):
-        ws = self.mapping(
-            z,
-            c,
-            truncation_psi=truncation_psi,
-            truncation_cutoff=truncation_cutoff,
-            skip_w_avg_update=skip_w_avg_update,
-        )
-        img = self.synthesis(images_in, masks_in, ws, noise_mode=noise_mode)
-        return img
-
-
-class MAT(nn.Module):
-    def __init__(self):
-        super().__init__()
-        self.model_arch = "MAT"
-
-        self.model = Generator(
-            z_dim=512, c_dim=0, w_dim=512, img_resolution=512, img_channels=3
-        )
-        self.z = torch.from_numpy(np.random.randn(1, self.model.z_dim))  # [1., 512]
-        self.label = torch.zeros([1, self.model.c_dim])
-
-    def forward(self, image, mask):
-        """Input images and output images have same size
-        images: [H, W, C] RGB
-        masks: [H, W] mask area == 255
-        return: BGR IMAGE
-        """
-
-        image = image * 2 - 1  # [0, 1] -> [-1, 1]
-        mask = 1 - mask
-
-        output = self.model(
-            image, mask, self.z, self.label, truncation_psi=1, noise_mode="none"
-        )
-
-        return output * 0.5 + 0.5
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/utils.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/utils.py
deleted file mode 100644
index 7009012..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/mat/arch/utils.py
+++ /dev/null
@@ -1,697 +0,0 @@
-# type: ignore
-"""Code used for this implementation of the MAT helper utils is modified from
-lama-cleaner, copyright of Sanster: https://github.com/fenglinglwb/MAT"""
-
-import collections
-from itertools import repeat
-from typing import Any
-
-import numpy as np
-import torch
-from torch import conv2d, conv_transpose2d
-
-
-def normalize_2nd_moment(x, dim=1, eps=1e-8):
-    return x * (x.square().mean(dim=dim, keepdim=True) + eps).rsqrt()
-
-
-class EasyDict(dict):
-    """Convenience class that behaves like a dict but allows access with the attribute syntax."""
-
-    def __getattr__(self, name: str) -> Any:
-        try:
-            return self[name]
-        except KeyError as ke:
-            raise AttributeError(name) from ke
-
-    def __setattr__(self, name: str, value: Any) -> None:
-        self[name] = value
-
-    def __delattr__(self, name: str) -> None:
-        del self[name]
-
-
-activation_funcs = {
-    "linear": EasyDict(
-        func=lambda x, **_: x,
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=1,
-        ref="",
-        has_2nd_grad=False,
-    ),
-    "relu": EasyDict(
-        func=lambda x, **_: torch.nn.functional.relu(x),
-        def_alpha=0,
-        def_gain=np.sqrt(2),
-        cuda_idx=2,
-        ref="y",
-        has_2nd_grad=False,
-    ),
-    "lrelu": EasyDict(
-        func=lambda x, alpha, **_: torch.nn.functional.leaky_relu(x, alpha),
-        def_alpha=0.2,
-        def_gain=np.sqrt(2),
-        cuda_idx=3,
-        ref="y",
-        has_2nd_grad=False,
-    ),
-    "tanh": EasyDict(
-        func=lambda x, **_: torch.tanh(x),
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=4,
-        ref="y",
-        has_2nd_grad=True,
-    ),
-    "sigmoid": EasyDict(
-        func=lambda x, **_: torch.sigmoid(x),
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=5,
-        ref="y",
-        has_2nd_grad=True,
-    ),
-    "elu": EasyDict(
-        func=lambda x, **_: torch.nn.functional.elu(x),
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=6,
-        ref="y",
-        has_2nd_grad=True,
-    ),
-    "selu": EasyDict(
-        func=lambda x, **_: torch.nn.functional.selu(x),
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=7,
-        ref="y",
-        has_2nd_grad=True,
-    ),
-    "softplus": EasyDict(
-        func=lambda x, **_: torch.nn.functional.softplus(x),
-        def_alpha=0,
-        def_gain=1,
-        cuda_idx=8,
-        ref="y",
-        has_2nd_grad=True,
-    ),
-    "swish": EasyDict(
-        func=lambda x, **_: torch.sigmoid(x) * x,
-        def_alpha=0,
-        def_gain=np.sqrt(2),
-        cuda_idx=9,
-        ref="x",
-        has_2nd_grad=True,
-    ),
-}
-
-
-def _bias_act_ref(x, b=None, dim=1, act="linear", alpha=None, gain=None, clamp=None):
-    """Slow reference implementation of `bias_act()` using standard TensorFlow ops."""
-    assert isinstance(x, torch.Tensor)
-    assert clamp is None or clamp >= 0
-    spec = activation_funcs[act]
-    alpha = float(alpha if alpha is not None else spec.def_alpha)
-    gain = float(gain if gain is not None else spec.def_gain)
-    clamp = float(clamp if clamp is not None else -1)
-
-    # Add bias.
-    if b is not None:
-        assert isinstance(b, torch.Tensor) and b.ndim == 1
-        assert 0 <= dim < x.ndim
-        assert b.shape[0] == x.shape[dim]
-        x = x + b.reshape([-1 if i == dim else 1 for i in range(x.ndim)]).to(x.device)
-
-    # Evaluate activation function.
-    alpha = float(alpha)
-    x = spec.func(x, alpha=alpha)
-
-    # Scale by gain.
-    gain = float(gain)
-    if gain != 1:
-        x = x * gain
-
-    # Clamp.
-    if clamp >= 0:
-        x = x.clamp(-clamp, clamp)  # pylint: disable=invalid-unary-operand-type
-    return x
-
-
-def bias_act(
-    x, b=None, dim=1, act="linear", alpha=None, gain=None, clamp=None, impl="ref"
-):
-    r"""Fused bias and activation function.
-    Adds bias `b` to activation tensor `x`, evaluates activation function `act`,
-    and scales the result by `gain`. Each of the steps is optional. In most cases,
-    the fused op is considerably more efficient than performing the same calculation
-    using standard PyTorch ops. It supports first and second order gradients,
-    but not third order gradients.
-    Args:
-        x:      Input activation tensor. Can be of any shape.
-        b:      Bias vector, or `None` to disable. Must be a 1D tensor of the same type
-                as `x`. The shape must be known, and it must match the dimension of `x`
-                corresponding to `dim`.
-        dim:    The dimension in `x` corresponding to the elements of `b`.
-                The value of `dim` is ignored if `b` is not specified.
-        act:    Name of the activation function to evaluate, or `"linear"` to disable.
-                Can be e.g. `"relu"`, `"lrelu"`, `"tanh"`, `"sigmoid"`, `"swish"`, etc.
-                See `activation_funcs` for a full list. `None` is not allowed.
-        alpha:  Shape parameter for the activation function, or `None` to use the default.
-        gain:   Scaling factor for the output tensor, or `None` to use default.
-                See `activation_funcs` for the default scaling of each activation function.
-                If unsure, consider specifying 1.
-        clamp:  Clamp the output values to `[-clamp, +clamp]`, or `None` to disable
-                the clamping (default).
-        impl:   Name of the implementation to use. Can be `"ref"` or `"cuda"` (default).
-    Returns:
-        Tensor of the same shape and datatype as `x`.
-    """
-    assert isinstance(x, torch.Tensor)
-    assert impl in ["ref", "cuda"]
-    return _bias_act_ref(
-        x=x, b=b, dim=dim, act=act, alpha=alpha, gain=gain, clamp=clamp
-    )
-
-
-def setup_filter(
-    f,
-    device=torch.device("cpu"),
-    normalize=True,
-    flip_filter=False,
-    gain=1,
-    separable=None,
-):
-    r"""Convenience function to setup 2D FIR filter for `upfirdn2d()`.
-    Args:
-        f:           Torch tensor, numpy array, or python list of the shape
-                     `[filter_height, filter_width]` (non-separable),
-                     `[filter_taps]` (separable),
-                     `[]` (impulse), or
-                     `None` (identity).
-        device:      Result device (default: cpu).
-        normalize:   Normalize the filter so that it retains the magnitude
-                     for constant input signal (DC)? (default: True).
-        flip_filter: Flip the filter? (default: False).
-        gain:        Overall scaling factor for signal magnitude (default: 1).
-        separable:   Return a separable filter? (default: select automatically).
-    Returns:
-        Float32 tensor of the shape
-        `[filter_height, filter_width]` (non-separable) or
-        `[filter_taps]` (separable).
-    """
-    # Validate.
-    if f is None:
-        f = 1
-    f = torch.as_tensor(f, dtype=torch.float32)
-    assert f.ndim in [0, 1, 2]
-    assert f.numel() > 0
-    if f.ndim == 0:
-        f = f[np.newaxis]
-
-    # Separable?
-    if separable is None:
-        separable = f.ndim == 1 and f.numel() >= 8
-    if f.ndim == 1 and not separable:
-        f = f.ger(f)
-    assert f.ndim == (1 if separable else 2)
-
-    # Apply normalize, flip, gain, and device.
-    if normalize:
-        f /= f.sum()
-    if flip_filter:
-        f = f.flip(list(range(f.ndim)))
-    f = f * (gain ** (f.ndim / 2))
-    f = f.to(device=device)
-    return f
-
-
-def _get_filter_size(f):
-    if f is None:
-        return 1, 1
-
-    assert isinstance(f, torch.Tensor) and f.ndim in [1, 2]
-    fw = f.shape[-1]
-    fh = f.shape[0]
-
-    fw = int(fw)
-    fh = int(fh)
-    assert fw >= 1 and fh >= 1
-    return fw, fh
-
-
-def _get_weight_shape(w):
-    shape = [int(sz) for sz in w.shape]
-    return shape
-
-
-def _parse_scaling(scaling):
-    if isinstance(scaling, int):
-        scaling = [scaling, scaling]
-    assert isinstance(scaling, (list, tuple))
-    assert all(isinstance(x, int) for x in scaling)
-    sx, sy = scaling
-    assert sx >= 1 and sy >= 1
-    return sx, sy
-
-
-def _parse_padding(padding):
-    if isinstance(padding, int):
-        padding = [padding, padding]
-    assert isinstance(padding, (list, tuple))
-    assert all(isinstance(x, int) for x in padding)
-    if len(padding) == 2:
-        padx, pady = padding
-        padding = [padx, padx, pady, pady]
-    padx0, padx1, pady0, pady1 = padding
-    return padx0, padx1, pady0, pady1
-
-
-def _ntuple(n):
-    def parse(x):
-        if isinstance(x, collections.abc.Iterable):
-            return x
-        return tuple(repeat(x, n))
-
-    return parse
-
-
-to_2tuple = _ntuple(2)
-
-
-def _upfirdn2d_ref(x, f, up=1, down=1, padding=0, flip_filter=False, gain=1):
-    """Slow reference implementation of `upfirdn2d()` using standard PyTorch ops."""
-    # Validate arguments.
-    assert isinstance(x, torch.Tensor) and x.ndim == 4
-    if f is None:
-        f = torch.ones([1, 1], dtype=torch.float32, device=x.device)
-    assert isinstance(f, torch.Tensor) and f.ndim in [1, 2]
-    assert f.dtype == torch.float32 and not f.requires_grad
-    batch_size, num_channels, in_height, in_width = x.shape
-    # upx, upy = _parse_scaling(up)
-    # downx, downy = _parse_scaling(down)
-
-    upx, upy = up, up
-    downx, downy = down, down
-
-    # padx0, padx1, pady0, pady1 = _parse_padding(padding)
-    padx0, padx1, pady0, pady1 = padding[0], padding[1], padding[2], padding[3]
-
-    # Upsample by inserting zeros.
-    x = x.reshape([batch_size, num_channels, in_height, 1, in_width, 1])
-    x = torch.nn.functional.pad(x, [0, upx - 1, 0, 0, 0, upy - 1])
-    x = x.reshape([batch_size, num_channels, in_height * upy, in_width * upx])
-
-    # Pad or crop.
-    x = torch.nn.functional.pad(
-        x, [max(padx0, 0), max(padx1, 0), max(pady0, 0), max(pady1, 0)]
-    )
-    x = x[
-        :,
-        :,
-        max(-pady0, 0) : x.shape[2] - max(-pady1, 0),
-        max(-padx0, 0) : x.shape[3] - max(-padx1, 0),
-    ]
-
-    # Setup filter.
-    f = f * (gain ** (f.ndim / 2))
-    f = f.to(x.dtype)
-    if not flip_filter:
-        f = f.flip(list(range(f.ndim)))
-
-    # Convolve with the filter.
-    f = f[np.newaxis, np.newaxis].repeat([num_channels, 1] + [1] * f.ndim)
-    if f.ndim == 4:
-        x = conv2d(input=x, weight=f, groups=num_channels)
-    else:
-        x = conv2d(input=x, weight=f.unsqueeze(2), groups=num_channels)
-        x = conv2d(input=x, weight=f.unsqueeze(3), groups=num_channels)
-
-    # Downsample by throwing away pixels.
-    x = x[:, :, ::downy, ::downx]
-    return x
-
-
-def upfirdn2d(x, f, up=1, down=1, padding=0, flip_filter=False, gain=1, impl="cuda"):
-    r"""Pad, upsample, filter, and downsample a batch of 2D images.
-    Performs the following sequence of operations for each channel:
-    1. Upsample the image by inserting N-1 zeros after each pixel (`up`).
-    2. Pad the image with the specified number of zeros on each side (`padding`).
-       Negative padding corresponds to cropping the image.
-    3. Convolve the image with the specified 2D FIR filter (`f`), shrinking it
-       so that the footprint of all output pixels lies within the input image.
-    4. Downsample the image by keeping every Nth pixel (`down`).
-    This sequence of operations bears close resemblance to scipy.signal.upfirdn().
-    The fused op is considerably more efficient than performing the same calculation
-    using standard PyTorch ops. It supports gradients of arbitrary order.
-    Args:
-        x:           Float32/float64/float16 input tensor of the shape
-                     `[batch_size, num_channels, in_height, in_width]`.
-        f:           Float32 FIR filter of the shape
-                     `[filter_height, filter_width]` (non-separable),
-                     `[filter_taps]` (separable), or
-                     `None` (identity).
-        up:          Integer upsampling factor. Can be a single int or a list/tuple
-                     `[x, y]` (default: 1).
-        down:        Integer downsampling factor. Can be a single int or a list/tuple
-                     `[x, y]` (default: 1).
-        padding:     Padding with respect to the upsampled image. Can be a single number
-                     or a list/tuple `[x, y]` or `[x_before, x_after, y_before, y_after]`
-                     (default: 0).
-        flip_filter: False = convolution, True = correlation (default: False).
-        gain:        Overall scaling factor for signal magnitude (default: 1).
-        impl:        Implementation to use. Can be `'ref'` or `'cuda'` (default: `'cuda'`).
-    Returns:
-        Tensor of the shape `[batch_size, num_channels, out_height, out_width]`.
-    """
-    # assert isinstance(x, torch.Tensor)
-    # assert impl in ['ref', 'cuda']
-    return _upfirdn2d_ref(
-        x, f, up=up, down=down, padding=padding, flip_filter=flip_filter, gain=gain
-    )
-
-
-def upsample2d(x, f, up=2, padding=0, flip_filter=False, gain=1, impl="cuda"):
-    r"""Upsample a batch of 2D images using the given 2D FIR filter.
-    By default, the result is padded so that its shape is a multiple of the input.
-    User-specified padding is applied on top of that, with negative values
-    indicating cropping. Pixels outside the image are assumed to be zero.
-    Args:
-        x:           Float32/float64/float16 input tensor of the shape
-                     `[batch_size, num_channels, in_height, in_width]`.
-        f:           Float32 FIR filter of the shape
-                     `[filter_height, filter_width]` (non-separable),
-                     `[filter_taps]` (separable), or
-                     `None` (identity).
-        up:          Integer upsampling factor. Can be a single int or a list/tuple
-                     `[x, y]` (default: 1).
-        padding:     Padding with respect to the output. Can be a single number or a
-                     list/tuple `[x, y]` or `[x_before, x_after, y_before, y_after]`
-                     (default: 0).
-        flip_filter: False = convolution, True = correlation (default: False).
-        gain:        Overall scaling factor for signal magnitude (default: 1).
-        impl:        Implementation to use. Can be `'ref'` or `'cuda'` (default: `'cuda'`).
-    Returns:
-        Tensor of the shape `[batch_size, num_channels, out_height, out_width]`.
-    """
-    upx, upy = _parse_scaling(up)
-    # upx, upy = up, up
-    padx0, padx1, pady0, pady1 = _parse_padding(padding)
-    # padx0, padx1, pady0, pady1 = padding, padding, padding, padding
-    fw, fh = _get_filter_size(f)
-    p = [
-        padx0 + (fw + upx - 1) // 2,
-        padx1 + (fw - upx) // 2,
-        pady0 + (fh + upy - 1) // 2,
-        pady1 + (fh - upy) // 2,
-    ]
-    return upfirdn2d(
-        x,
-        f,
-        up=up,
-        padding=p,
-        flip_filter=flip_filter,
-        gain=gain * upx * upy,
-        impl=impl,
-    )
-
-
-class FullyConnectedLayer(torch.nn.Module):
-    def __init__(
-        self,
-        in_features,  # Number of input features.
-        out_features,  # Number of output features.
-        bias=True,  # Apply additive bias before the activation function?
-        activation="linear",  # Activation function: 'relu', 'lrelu', etc.
-        lr_multiplier=1,  # Learning rate multiplier.
-        bias_init=0,  # Initial value for the additive bias.
-    ):
-        super().__init__()
-        self.weight = torch.nn.Parameter(
-            torch.randn([out_features, in_features]) / lr_multiplier
-        )
-        self.bias = (
-            torch.nn.Parameter(torch.full([out_features], np.float32(bias_init)))
-            if bias
-            else None
-        )
-        self.activation = activation
-
-        self.weight_gain = lr_multiplier / np.sqrt(in_features)
-        self.bias_gain = lr_multiplier
-
-    def forward(self, x):
-        w = self.weight * self.weight_gain
-        b = self.bias
-        if b is not None and self.bias_gain != 1:
-            b = b * self.bias_gain
-
-        if self.activation == "linear" and b is not None:
-            # out = torch.addmm(b.unsqueeze(0), x, w.t())
-            x = x.matmul(w.t().to(x.device))
-            out = x + b.reshape(
-                [-1 if i == x.ndim - 1 else 1 for i in range(x.ndim)]
-            ).to(x.device)
-        else:
-            x = x.matmul(w.t().to(x.device))
-            out = bias_act(x, b, act=self.activation, dim=x.ndim - 1).to(x.device)
-        return out
-
-
-def _conv2d_wrapper(
-    x, w, stride=1, padding=0, groups=1, transpose=False, flip_weight=True
-):
-    """Wrapper for the underlying `conv2d()` and `conv_transpose2d()` implementations."""
-    out_channels, in_channels_per_group, kh, kw = _get_weight_shape(w)
-
-    # Flip weight if requested.
-    if not flip_weight:  # conv2d() actually performs correlation (flip_weight=True) not convolution (flip_weight=False).
-        w = w.flip([2, 3])
-
-    # Workaround performance pitfall in cuDNN 8.0.5, triggered when using
-    # 1x1 kernel + memory_format=channels_last + less than 64 channels.
-    if (
-        kw == 1
-        and kh == 1
-        and stride == 1
-        and padding in [0, [0, 0], (0, 0)]
-        and not transpose
-    ):
-        if x.stride()[1] == 1 and min(out_channels, in_channels_per_group) < 64:
-            if out_channels <= 4 and groups == 1:
-                in_shape = x.shape
-                x = w.squeeze(3).squeeze(2) @ x.reshape(
-                    [in_shape[0], in_channels_per_group, -1]
-                )
-                x = x.reshape([in_shape[0], out_channels, in_shape[2], in_shape[3]])
-            else:
-                x = x.to(memory_format=torch.contiguous_format)
-                w = w.to(memory_format=torch.contiguous_format)
-                x = conv2d(x, w, groups=groups)
-            return x.to(memory_format=torch.channels_last)
-
-    # Otherwise => execute using conv2d_gradfix.
-    op = conv_transpose2d if transpose else conv2d
-    return op(x, w, stride=stride, padding=padding, groups=groups)
-
-
-def conv2d_resample(
-    x, w, f=None, up=1, down=1, padding=0, groups=1, flip_weight=True, flip_filter=False
-):
-    r"""2D convolution with optional up/downsampling.
-    Padding is performed only once at the beginning, not between the operations.
-    Args:
-        x:              Input tensor of shape
-                        `[batch_size, in_channels, in_height, in_width]`.
-        w:              Weight tensor of shape
-                        `[out_channels, in_channels//groups, kernel_height, kernel_width]`.
-        f:              Low-pass filter for up/downsampling. Must be prepared beforehand by
-                        calling setup_filter(). None = identity (default).
-        up:             Integer upsampling factor (default: 1).
-        down:           Integer downsampling factor (default: 1).
-        padding:        Padding with respect to the upsampled image. Can be a single number
-                        or a list/tuple `[x, y]` or `[x_before, x_after, y_before, y_after]`
-                        (default: 0).
-        groups:         Split input channels into N groups (default: 1).
-        flip_weight:    False = convolution, True = correlation (default: True).
-        flip_filter:    False = convolution, True = correlation (default: False).
-    Returns:
-        Tensor of the shape `[batch_size, num_channels, out_height, out_width]`.
-    """
-    # Validate arguments.
-    assert isinstance(x, torch.Tensor) and (x.ndim == 4)
-    assert isinstance(w, torch.Tensor) and (w.ndim == 4) and (w.dtype == x.dtype)
-    assert f is None or (
-        isinstance(f, torch.Tensor) and f.ndim in [1, 2] and f.dtype == torch.float32
-    )
-    assert isinstance(up, int) and (up >= 1)
-    assert isinstance(down, int) and (down >= 1)
-    # assert isinstance(groups, int) and (groups >= 1), f"!!!!!! groups: {groups} isinstance(groups, int)  {isinstance(groups, int)} {type(groups)}"
-    out_channels, in_channels_per_group, kh, kw = _get_weight_shape(w)
-    fw, fh = _get_filter_size(f)
-    # px0, px1, py0, py1 = _parse_padding(padding)
-    px0, px1, py0, py1 = padding, padding, padding, padding
-
-    # Adjust padding to account for up/downsampling.
-    if up > 1:
-        px0 += (fw + up - 1) // 2
-        px1 += (fw - up) // 2
-        py0 += (fh + up - 1) // 2
-        py1 += (fh - up) // 2
-    if down > 1:
-        px0 += (fw - down + 1) // 2
-        px1 += (fw - down) // 2
-        py0 += (fh - down + 1) // 2
-        py1 += (fh - down) // 2
-
-    # Fast path: 1x1 convolution with downsampling only => downsample first, then convolve.
-    if kw == 1 and kh == 1 and (down > 1 and up == 1):
-        x = upfirdn2d(
-            x=x, f=f, down=down, padding=[px0, px1, py0, py1], flip_filter=flip_filter
-        )
-        x = _conv2d_wrapper(x=x, w=w, groups=groups, flip_weight=flip_weight)
-        return x
-
-    # Fast path: 1x1 convolution with upsampling only => convolve first, then upsample.
-    if kw == 1 and kh == 1 and (up > 1 and down == 1):
-        x = _conv2d_wrapper(x=x, w=w, groups=groups, flip_weight=flip_weight)
-        x = upfirdn2d(
-            x=x,
-            f=f,
-            up=up,
-            padding=[px0, px1, py0, py1],
-            gain=up**2,
-            flip_filter=flip_filter,
-        )
-        return x
-
-    # Fast path: downsampling only => use strided convolution.
-    if down > 1 and up == 1:
-        x = upfirdn2d(x=x, f=f, padding=[px0, px1, py0, py1], flip_filter=flip_filter)
-        x = _conv2d_wrapper(
-            x=x, w=w, stride=down, groups=groups, flip_weight=flip_weight
-        )
-        return x
-
-    # Fast path: upsampling with optional downsampling => use transpose strided convolution.
-    if up > 1:
-        if groups == 1:
-            w = w.transpose(0, 1)
-        else:
-            w = w.reshape(groups, out_channels // groups, in_channels_per_group, kh, kw)
-            w = w.transpose(1, 2)
-            w = w.reshape(
-                groups * in_channels_per_group, out_channels // groups, kh, kw
-            )
-        px0 -= kw - 1
-        px1 -= kw - up
-        py0 -= kh - 1
-        py1 -= kh - up
-        pxt = max(min(-px0, -px1), 0)
-        pyt = max(min(-py0, -py1), 0)
-        x = _conv2d_wrapper(
-            x=x,
-            w=w,
-            stride=up,
-            padding=[pyt, pxt],
-            groups=groups,
-            transpose=True,
-            flip_weight=(not flip_weight),
-        )
-        x = upfirdn2d(
-            x=x,
-            f=f,
-            padding=[px0 + pxt, px1 + pxt, py0 + pyt, py1 + pyt],
-            gain=up**2,
-            flip_filter=flip_filter,
-        )
-        if down > 1:
-            x = upfirdn2d(x=x, f=f, down=down, flip_filter=flip_filter)
-        return x
-
-    # Fast path: no up/downsampling, padding supported by the underlying implementation => use plain conv2d.
-    if up == 1 and down == 1:
-        if px0 == px1 and py0 == py1 and px0 >= 0 and py0 >= 0:
-            return _conv2d_wrapper(
-                x=x, w=w, padding=[py0, px0], groups=groups, flip_weight=flip_weight
-            )
-
-    # Fallback: Generic reference implementation.
-    x = upfirdn2d(
-        x=x,
-        f=(f if up > 1 else None),
-        up=up,
-        padding=[px0, px1, py0, py1],
-        gain=up**2,
-        flip_filter=flip_filter,
-    )
-    x = _conv2d_wrapper(x=x, w=w, groups=groups, flip_weight=flip_weight)
-    if down > 1:
-        x = upfirdn2d(x=x, f=f, down=down, flip_filter=flip_filter)
-    return x
-
-
-class Conv2dLayer(torch.nn.Module):
-    def __init__(
-        self,
-        in_channels,  # Number of input channels.
-        out_channels,  # Number of output channels.
-        kernel_size,  # Width and height of the convolution kernel.
-        bias=True,  # Apply additive bias before the activation function?
-        activation="linear",  # Activation function: 'relu', 'lrelu', etc.
-        up=1,  # Integer upsampling factor.
-        down=1,  # Integer downsampling factor.
-        resample_filter=[
-            1,
-            3,
-            3,
-            1,
-        ],  # Low-pass filter to apply when resampling activations.
-        conv_clamp=None,  # Clamp the output to +-X, None = disable clamping.
-        channels_last=False,  # Expect the input to have memory_format=channels_last?
-        trainable=True,  # Update the weights of this layer during training?
-    ):
-        super().__init__()
-        self.activation = activation
-        self.up = up
-        self.down = down
-        self.register_buffer("resample_filter", setup_filter(resample_filter))
-        self.conv_clamp = conv_clamp
-        self.padding = kernel_size // 2
-        self.weight_gain = 1 / np.sqrt(in_channels * (kernel_size**2))
-        self.act_gain = activation_funcs[activation].def_gain
-
-        memory_format = (
-            torch.channels_last if channels_last else torch.contiguous_format
-        )
-        weight = torch.randn([out_channels, in_channels, kernel_size, kernel_size]).to(
-            memory_format=memory_format
-        )
-        bias = torch.zeros([out_channels]) if bias else None
-        if trainable:
-            self.weight = torch.nn.Parameter(weight)
-            self.bias = torch.nn.Parameter(bias) if bias is not None else None
-        else:
-            self.register_buffer("weight", weight)
-            if bias is not None:
-                self.register_buffer("bias", bias)
-            else:
-                self.bias = None
-
-    def forward(self, x, gain=1):
-        w = self.weight * self.weight_gain
-        x = conv2d_resample(
-            x=x,
-            w=w,
-            f=self.resample_filter,
-            up=self.up,
-            down=self.down,
-            padding=self.padding,
-        )
-
-        act_gain = self.act_gain * gain
-        act_clamp = self.conv_clamp * gain if self.conv_clamp is not None else None
-        out = bias_act(
-            x, self.bias, act=self.activation, gain=act_gain, clamp=act_clamp
-        )
-        return out
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/inpaint.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/inpaint.png
deleted file mode 100644
index 20a61c8..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/inpaint.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-17.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-17.png
deleted file mode 100644
index 1263f2b..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-17.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-65.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-65.png
deleted file mode 100644
index 06a3084..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-blur-65.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-input.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-input.png
deleted file mode 100644
index a183e71..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-input.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-lama.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-lama.png
deleted file mode 100644
index 96d4e63..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-lama.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-mat.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-mat.png
deleted file mode 100644
index e2f8e9e..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-mat.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-navier-stokes.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-navier-stokes.png
deleted file mode 100644
index 1aa6485..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-navier-stokes.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-neutral.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-neutral.png
deleted file mode 100644
index 46583f0..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-neutral.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-telea.png b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-telea.png
deleted file mode 100644
index 4949757..0000000
Binary files a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/media/preprocess-telea.png and /dev/null differ
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/nodes.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/nodes.py
deleted file mode 100644
index e397fa7..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/nodes.py
+++ /dev/null
@@ -1,493 +0,0 @@
-from __future__ import annotations
-from typing import Any
-import numpy as np
-import torch
-import torch.jit
-import torch.nn.functional as F
-
-from torch import Tensor
-from tqdm import trange
-
-from comfy.utils import ProgressBar
-from comfy.model_patcher import ModelPatcher
-from comfy.model_base import BaseModel
-from comfy.model_management import cast_to_device, get_torch_device
-from comfy import model_management
-import comfy.utils
-import comfy.lora
-import folder_paths
-import nodes
-
-from . import mat
-from .util import (
-    gaussian_blur,
-    binary_erosion,
-    binary_dilation,
-    make_odd,
-    mask_floor,
-    mask_unsqueeze,
-    to_torch,
-    to_comfy,
-    resize_square,
-    undo_resize_square,
-)
-
-
-class InpaintHead(torch.nn.Module):
-    def __init__(self, *args, **kwargs):
-        super().__init__(*args, **kwargs)
-        self.head = torch.nn.Parameter(torch.empty(size=(320, 5, 3, 3), device="cpu"))
-
-    def __call__(self, x):
-        x = F.pad(x, (1, 1, 1, 1), "replicate")
-        return F.conv2d(x, weight=self.head)
-
-
-def load_fooocus_patch(lora: dict, to_load: dict):
-    patch_dict = {}
-    loaded_keys = set()
-    for key in to_load.values():
-        if value := lora.get(key, None):
-            patch_dict[key] = ("fooocus", value)
-            loaded_keys.add(key)
-
-    not_loaded = sum(1 for x in lora if x not in loaded_keys)
-    if not_loaded > 0:
-        print(
-            f"[ApplyFooocusInpaint] {len(loaded_keys)} Lora keys loaded, {not_loaded} remaining keys not found in model."
-        )
-    return patch_dict
-
-
-if not hasattr(comfy.lora, "calculate_weight") and hasattr(ModelPatcher, "calculate_weight"):
-    too_old_msg = "comfyui-inpaint-nodes requires a newer version of ComfyUI (v0.1.1 or later), please update!"
-    raise RuntimeError(too_old_msg)
-
-
-original_calculate_weight = comfy.lora.calculate_weight
-injected_model_patcher_calculate_weight = False
-
-
-def calculate_weight_patched(
-    patches, weight, key, intermediate_dtype=torch.float32, original_weights=None
-):
-    remaining = []
-
-    for p in patches:
-        alpha = p[0]
-        v = p[1]
-
-        is_fooocus_patch = isinstance(v, tuple) and len(v) == 2 and v[0] == "fooocus"
-        if not is_fooocus_patch:
-            remaining.append(p)
-            continue
-
-        if alpha != 0.0:
-            v = v[1]
-            w1 = cast_to_device(v[0], weight.device, torch.float32)
-            if w1.shape == weight.shape:
-                w_min = cast_to_device(v[1], weight.device, torch.float32)
-                w_max = cast_to_device(v[2], weight.device, torch.float32)
-                w1 = (w1 / 255.0) * (w_max - w_min) + w_min
-                weight += alpha * cast_to_device(w1, weight.device, weight.dtype)
-            else:
-                print(
-                    f"[ApplyFooocusInpaint] Shape mismatch {key}, weight not merged ({w1.shape} != {weight.shape})"
-                )
-
-    if len(remaining) > 0:
-        return original_calculate_weight(remaining, weight, key, intermediate_dtype)
-    return weight
-
-
-def inject_patched_calculate_weight():
-    global injected_model_patcher_calculate_weight
-    if not injected_model_patcher_calculate_weight:
-        print(
-            "[comfyui-inpaint-nodes] Injecting patched comfy.model_patcher.ModelPatcher.calculate_weight"
-        )
-        comfy.lora.calculate_weight = calculate_weight_patched
-        injected_model_patcher_calculate_weight = True
-
-
-class LoadFooocusInpaint:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "head": (folder_paths.get_filename_list("inpaint"),),
-                "patch": (folder_paths.get_filename_list("inpaint"),),
-            }
-        }
-
-    RETURN_TYPES = ("INPAINT_PATCH",)
-    CATEGORY = "inpaint"
-    FUNCTION = "load"
-
-    def load(self, head: str, patch: str):
-        head_file = folder_paths.get_full_path("inpaint", head)
-        inpaint_head_model = InpaintHead()
-        sd = torch.load(head_file, map_location="cpu", weights_only=True)
-        inpaint_head_model.load_state_dict(sd)
-
-        patch_file = folder_paths.get_full_path("inpaint", patch)
-        inpaint_lora = comfy.utils.load_torch_file(patch_file, safe_load=True)
-
-        return ((inpaint_head_model, inpaint_lora),)
-
-
-class ApplyFooocusInpaint:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "model": ("MODEL",),
-                "patch": ("INPAINT_PATCH",),
-                "latent": ("LATENT",),
-            }
-        }
-
-    RETURN_TYPES = ("MODEL",)
-    CATEGORY = "inpaint"
-    FUNCTION = "patch"
-
-    _inpaint_head_feature: Tensor | None = None
-    _inpaint_block: Tensor | None = None
-
-    def patch(
-        self,
-        model: ModelPatcher,
-        patch: tuple[InpaintHead, dict[str, Tensor]],
-        latent: dict[str, Any],
-    ):
-        base_model: BaseModel = model.model
-        latent_pixels = base_model.process_latent_in(latent["samples"])
-        noise_mask = latent["noise_mask"].round()
-
-        latent_mask = F.max_pool2d(noise_mask, (8, 8)).round().to(latent_pixels)
-
-        inpaint_head_model, inpaint_lora = patch
-        feed = torch.cat([latent_mask, latent_pixels], dim=1)
-        inpaint_head_model.to(device=feed.device, dtype=feed.dtype)
-        self._inpaint_head_feature = inpaint_head_model(feed)
-        self._inpaint_block = None
-
-        lora_keys = comfy.lora.model_lora_keys_unet(model.model, {})
-        lora_keys.update({x: x for x in base_model.state_dict().keys()})
-        loaded_lora = load_fooocus_patch(inpaint_lora, lora_keys)
-
-        m = model.clone()
-        m.set_model_input_block_patch(self._input_block_patch)
-        patched = m.add_patches(loaded_lora, 1.0)
-
-        not_patched_count = sum(1 for x in loaded_lora if x not in patched)
-        if not_patched_count > 0:
-            print(f"[ApplyFooocusInpaint] Failed to patch {not_patched_count} keys")
-
-        inject_patched_calculate_weight()
-        return (m,)
-
-    def _input_block_patch(self, h: Tensor, transformer_options: dict):
-        if transformer_options["block"][1] == 0:
-            if self._inpaint_block is None or self._inpaint_block.shape != h.shape:
-                assert self._inpaint_head_feature is not None
-                batch = h.shape[0] // self._inpaint_head_feature.shape[0]
-                self._inpaint_block = self._inpaint_head_feature.to(h).repeat(batch, 1, 1, 1)
-            h = h + self._inpaint_block
-        return h
-
-
-class VAEEncodeInpaintConditioning:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "positive": ("CONDITIONING",),
-                "negative": ("CONDITIONING",),
-                "vae": ("VAE",),
-                "pixels": ("IMAGE",),
-                "mask": ("MASK",),
-            }
-        }
-
-    RETURN_TYPES = ("CONDITIONING", "CONDITIONING", "LATENT", "LATENT")
-    RETURN_NAMES = ("positive", "negative", "latent_inpaint", "latent_samples")
-    FUNCTION = "encode"
-    CATEGORY = "inpaint"
-
-    def encode(self, positive, negative, vae, pixels, mask):
-        try:
-            positive, negative, latent = nodes.InpaintModelConditioning().encode(
-                positive, negative, pixels, vae, mask, noise_mask=True
-            )
-        except TypeError:  # ComfyUI versions older than 2024-11-19
-            positive, negative, latent = nodes.InpaintModelConditioning().encode(
-                positive, negative, pixels, vae, mask
-            )
-        latent_inpaint = dict(
-            samples=positive[0][1]["concat_latent_image"],
-            noise_mask=latent["noise_mask"].round(),
-        )
-        return (positive, negative, latent_inpaint, latent)
-
-
-class MaskedFill:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "image": ("IMAGE",),
-                "mask": ("MASK",),
-                "fill": (["neutral", "telea", "navier-stokes"],),
-                "falloff": ("INT", {"default": 0, "min": 0, "max": 8191, "step": 1}),
-            }
-        }
-
-    RETURN_TYPES = ("IMAGE",)
-    CATEGORY = "inpaint"
-    FUNCTION = "fill"
-
-    def fill(self, image: Tensor, mask: Tensor, fill: str, falloff: int):
-        image = image.detach().clone()
-        alpha = mask_unsqueeze(mask_floor(mask))
-        assert alpha.shape[0] == image.shape[0], "Image and mask batch size does not match"
-
-        falloff = make_odd(falloff)
-        if falloff > 0:
-            erosion = binary_erosion(alpha, falloff)
-            alpha = alpha * gaussian_blur(erosion, falloff)
-
-        if fill == "neutral":
-            m = (1.0 - alpha).squeeze(1)
-            for i in range(3):
-                image[:, :, :, i] -= 0.5
-                image[:, :, :, i] *= m
-                image[:, :, :, i] += 0.5
-        else:
-            import cv2
-
-            method = cv2.INPAINT_TELEA if fill == "telea" else cv2.INPAINT_NS
-            for slice, alpha_slice in zip(image, alpha):
-                alpha_np = alpha_slice.squeeze().cpu().numpy()
-                alpha_bc = alpha_np.reshape(*alpha_np.shape, 1)
-                image_np = slice.cpu().numpy()
-                filled_np = cv2.inpaint(
-                    (255.0 * image_np).astype(np.uint8),
-                    (255.0 * alpha_np).astype(np.uint8),
-                    3,
-                    method,
-                )
-                filled_np = filled_np.astype(np.float32) / 255.0
-                filled_np = image_np * (1.0 - alpha_bc) + filled_np * alpha_bc
-                slice.copy_(torch.from_numpy(filled_np))
-
-        return (image,)
-
-
-class MaskedBlur:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "image": ("IMAGE",),
-                "mask": ("MASK",),
-                "blur": ("INT", {"default": 255, "min": 3, "max": 8191, "step": 1}),
-                "falloff": ("INT", {"default": 0, "min": 0, "max": 8191, "step": 1}),
-            }
-        }
-
-    RETURN_TYPES = ("IMAGE",)
-    CATEGORY = "inpaint"
-    FUNCTION = "fill"
-
-    def fill(self, image: Tensor, mask: Tensor, blur: int, falloff: int):
-        blur = make_odd(blur)
-        falloff = min(make_odd(falloff), blur - 2)
-        image, mask = to_torch(image, mask)
-
-        original = image.clone()
-        alpha = mask_floor(mask)
-        if falloff > 0:
-            erosion = binary_erosion(alpha, falloff)
-            alpha = alpha * gaussian_blur(erosion, falloff)
-        alpha = alpha.expand(-1, 3, -1, -1)
-
-        image = gaussian_blur(image, blur)
-        image = original + (image - original) * alpha
-        return (to_comfy(image),)
-
-
-class LoadInpaintModel:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "model_name": (folder_paths.get_filename_list("inpaint"),),
-            }
-        }
-
-    RETURN_TYPES = ("INPAINT_MODEL",)
-    CATEGORY = "inpaint"
-    FUNCTION = "load"
-
-    def load(self, model_name: str):
-        from spandrel import ModelLoader
-
-        model_file = folder_paths.get_full_path("inpaint", model_name)
-        if model_file is None:
-            raise RuntimeError(f"Model file not found: {model_name}")
-        if model_file.endswith(".pt"):
-            sd = torch.jit.load(model_file, map_location="cpu").state_dict()
-        else:
-            sd = comfy.utils.load_torch_file(model_file, safe_load=True)
-
-        if "synthesis.first_stage.conv_first.conv.resample_filter" in sd:  # MAT
-            model = mat.load(sd)
-        else:
-            model = ModelLoader().load_from_state_dict(sd)
-        model = model.eval()
-        return (model,)
-
-
-class InpaintWithModel:
-    @classmethod
-    def INPUT_TYPES(s):
-        return {
-            "required": {
-                "inpaint_model": ("INPAINT_MODEL",),
-                "image": ("IMAGE",),
-                "mask": ("MASK",),
-                "seed": ("INT", {"default": 0, "min": 0, "max": 0xFFFFFFFFFFFFFFFF}),
-            },
-            "optional": {
-                "optional_upscale_model": ("UPSCALE_MODEL",),
-            },
-        }
-
-    RETURN_TYPES = ("IMAGE",)
-    CATEGORY = "inpaint"
-    FUNCTION = "inpaint"
-
-    def inpaint(
-        self,
-        inpaint_model: mat.MAT | Any,
-        image: Tensor,
-        mask: Tensor,
-        seed: int,
-        optional_upscale_model=None,
-    ):
-        if isinstance(inpaint_model, mat.MAT):
-            required_size = 512
-        elif inpaint_model.architecture.id == "LaMa":
-            required_size = 256
-        else:
-            raise ValueError(f"Unknown model_arch {type(inpaint_model)}")
-
-        image, mask = to_torch(image, mask)
-        batch_size = image.shape[0]
-        if mask.shape[0] != batch_size:
-            mask = mask[0].unsqueeze(0).repeat(batch_size, 1, 1, 1)
-
-        image_device = image.device
-        device = get_torch_device()
-        inpaint_model.to(device)
-        batch_image = []
-        pbar = ProgressBar(batch_size)
-
-        for i in trange(batch_size):
-            work_image, work_mask = image[i].unsqueeze(0), mask[i].unsqueeze(0)
-            work_image, work_mask, original_size = resize_square(
-                work_image, work_mask, required_size
-            )
-            work_mask = mask_floor(work_mask)
-
-            torch.manual_seed(seed)
-            work_image = inpaint_model(work_image.to(device), work_mask.to(device))
-
-            if optional_upscale_model is not None:
-                work_image = self._upscale(optional_upscale_model, work_image, device)
-
-            work_image.to(image_device)
-            work_image = undo_resize_square(work_image.to(image_device), original_size)
-            work_image = image[i] + (work_image - image[i]) * mask_floor(mask[i])
-
-            batch_image.append(work_image)
-            pbar.update(1)
-
-        inpaint_model.cpu()
-        result = torch.cat(batch_image, dim=0)
-        return (to_comfy(result),)    
-    
-    def _upscale(self, upscale_model, image: Tensor, device):
-        memory_required = model_management.module_size(upscale_model.model)
-        memory_required += (512 * 512 * 3) * image.element_size() * max(upscale_model.scale, 1.0) * 384.0
-        memory_required += image.nelement() * image.element_size()
-        model_management.free_memory(memory_required, device)
-        upscale_model.to(device)
-
-        tile = 512
-        overlap = 32
-        oom = True
-        while oom:
-            try:
-                s = comfy.utils.tiled_scale(image, lambda a: upscale_model(a), tile_x=tile, tile_y=tile, overlap=overlap, upscale_amount=upscale_model.scale)
-                oom = False
-            except model_management.OOM_EXCEPTION as e:
-                tile //= 2
-                if tile < 128:
-                    raise e
-
-        upscale_model.to("cpu")
-        return torch.clamp(s, min=0, max=1.0)
-
-
-class DenoiseToCompositingMask:
-    @classmethod
-    def INPUT_TYPES(cls):
-        return {
-            "required": {
-                "mask": ("MASK",),
-                "offset": (
-                    "FLOAT",
-                    {"default": 0.1, "min": 0.0, "max": 1.0, "step": 0.01},
-                ),
-                "threshold": (
-                    "FLOAT",
-                    {"default": 0.2, "min": 0.01, "max": 1.0, "step": 0.01},
-                ),
-            }
-        }
-
-    RETURN_TYPES = ("MASK",)
-    CATEGORY = "inpaint"
-    FUNCTION = "convert"
-
-    def convert(self, mask: Tensor, offset: float, threshold: float):
-        assert 0.0 <= offset < threshold <= 1.0, "Threshold must be higher than offset"
-        mask = (mask - offset) * (1 / (threshold - offset))
-        mask = mask.clamp(0, 1)
-        return (mask,)
-
-
-class ExpandMask:
-    @classmethod
-    def INPUT_TYPES(cls):
-        return {
-            "required": {
-                "mask": ("MASK",),
-                "grow": ("INT", {"default": 16, "min": 0, "max": 8096, "step": 1}),
-                "blur": ("INT", {"default": 7, "min": 0, "max": 8096, "step": 1}),
-            }
-        }
-
-    RETURN_TYPES = ("MASK",)
-    CATEGORY = "inpaint"
-    FUNCTION = "expand"
-
-    def expand(self, mask: Tensor, grow: int, blur: int):
-        mask = mask_unsqueeze(mask)
-        if grow > 0:
-            mask = binary_dilation(mask, grow)
-        if blur > 0:
-            mask = gaussian_blur(mask, make_odd(blur))
-        return (mask.squeeze(1),)
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/pyproject.toml b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/pyproject.toml
deleted file mode 100644
index d4e2a5b..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/pyproject.toml
+++ /dev/null
@@ -1,17 +0,0 @@
-[project]
-name = "comfyui-inpaint-nodes"
-description = "Nodes for better inpainting with ComfyUI. Adds various ways to pre-process inpaint areas. Supports the Fooocus inpaint model, a small and flexible patch which can be applied to any SDXL checkpoint and will improve consistency when generating masked areas."
-version = "1.0.4"
-license = { file = "LICENSE" }
-
-[project.urls]
-Repository = "https://github.com/Acly/comfyui-inpaint-nodes"
-
-[tool.black]
-line-length = 100
-preview = true
-
-[tool.comfy]
-PublisherId = "acly"
-DisplayName = "comfyui-inpaint-nodes"
-Icon = ""
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/util.py b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/util.py
deleted file mode 100644
index bee773f..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/util.py
+++ /dev/null
@@ -1,108 +0,0 @@
-from __future__ import annotations
-import torch
-import torch.nn.functional as F
-import numpy as np
-import kornia.filters
-from torch import Tensor
-
-
-def mask_unsqueeze(mask: Tensor):
-    if len(mask.shape) == 3:  # BHW -> B1HW
-        mask = mask.unsqueeze(1)
-    elif len(mask.shape) == 2:  # HW -> B1HW
-        mask = mask.unsqueeze(0).unsqueeze(0)
-    return mask
-
-
-def to_torch(image: Tensor, mask: Tensor | None = None):
-    if len(image.shape) == 3:
-        image = image.unsqueeze(0)
-    image = image.permute(0, 3, 1, 2)  # BHWC -> BCHW
-    if mask is not None:
-        mask = mask_unsqueeze(mask)
-    if image.shape[2:] != mask.shape[2:]:
-        raise ValueError(
-            f"Image and mask must be the same size. {image.shape[2:]} != {mask.shape[2:]}"
-        )
-    return image, mask
-
-
-def to_comfy(image: Tensor):
-    return image.permute(0, 2, 3, 1)  # BCHW -> BHWC
-
-
-def mask_floor(mask: Tensor, threshold: float = 0.99):
-    return (mask >= threshold).to(mask.dtype)
-
-
-# torch pad does not support padding greater than image size with "reflect" mode
-def pad_reflect_once(x: Tensor, original_padding: tuple[int, int, int, int]):
-    _, _, h, w = x.shape
-    padding = np.array(original_padding)
-    size = np.array([w, w, h, h])
-
-    initial_padding = np.minimum(padding, size - 1)
-    additional_padding = padding - initial_padding
-
-    x = F.pad(x, tuple(initial_padding), mode="reflect")
-    if np.any(additional_padding > 0):
-        x = F.pad(x, tuple(additional_padding), mode="constant")
-    return x
-
-
-def resize_square(image: Tensor, mask: Tensor, size: int):
-    _, _, h, w = image.shape
-    pad_w, pad_h, prev_size = 0, 0, w
-    if w == size and h == size:
-        return image, mask, (pad_w, pad_h, prev_size)
-
-    if w < h:
-        pad_w = h - w
-        prev_size = h
-    elif h < w:
-        pad_h = w - h
-        prev_size = w
-    image = pad_reflect_once(image, (0, pad_w, 0, pad_h))
-    mask = pad_reflect_once(mask, (0, pad_w, 0, pad_h))
-
-    if image.shape[-1] != size:
-        image = F.interpolate(image, size=size, mode="nearest-exact")
-        mask = F.interpolate(mask, size=size, mode="nearest-exact")
-
-    return image, mask, (pad_w, pad_h, prev_size)
-
-
-def undo_resize_square(image: Tensor, original_size: tuple[int, int, int]):
-    _, _, h, w = image.shape
-    pad_w, pad_h, prev_size = original_size
-    if prev_size != w or prev_size != h:
-        image = F.interpolate(image, size=prev_size, mode="bilinear")
-    return image[:, :, 0 : prev_size - pad_h, 0 : prev_size - pad_w]
-
-
-def gaussian_blur(image: Tensor, radius: int, sigma: float = 0):
-    c = image.shape[-3]
-    if sigma <= 0:
-        sigma = 0.3 * (radius - 1) + 0.8
-    return kornia.filters.gaussian_blur2d(image, (radius, radius), (sigma, sigma))
-
-
-def binary_erosion(mask: Tensor, radius: int):
-    kernel = torch.ones(1, 1, radius * 2 + 1, radius * 2 + 1, device=mask.device)
-    mask = F.pad(mask, (radius, radius, radius, radius), mode="constant", value=1)
-    mask = F.conv2d(mask, kernel, groups=1)
-    mask = (mask == kernel.numel()).to(mask.dtype)
-    return mask
-
-
-def binary_dilation(mask: Tensor, radius: int):
-    kernel = torch.ones(1, radius * 2 + 1, device=mask.device)
-    mask = kornia.filters.filter2d_separable(mask, kernel, kernel, border_type="constant")
-    mask = (mask > 0).to(mask.dtype)
-    return mask
-
-
-def make_odd(x):
-    if x > 0 and x % 2 == 0:
-        return x + 1
-    return x
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-preprocess.json b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-preprocess.json
deleted file mode 100644
index 4a40207..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-preprocess.json
+++ /dev/null
@@ -1,1483 +0,0 @@
-{
-  "last_node_id": 66,
-  "last_link_id": 170,
-  "nodes": [
-    {
-      "id": 19,
-      "type": "CheckpointLoaderSimple",
-      "pos": [
-        -483,
-        1110
-      ],
-      "size": {
-        "0": 431,
-        "1": 98
-      },
-      "flags": {},
-      "order": 0,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            60
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "CLIP",
-          "type": "CLIP",
-          "links": [
-            35,
-            88
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "VAE",
-          "type": "VAE",
-          "links": [
-            43,
-            128
-          ],
-          "shape": 3,
-          "slot_index": 2
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CheckpointLoaderSimple"
-      },
-      "widgets_values": [
-        "juggernautXL_version6Rundiffusion.safetensors"
-      ]
-    },
-    {
-      "id": 10,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -474,
-        1381
-      ],
-      "size": [
-        417.5841689221421,
-        76
-      ],
-      "flags": {},
-      "order": 10,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 35
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            123
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "text, watermark"
-      ],
-      "color": "#322",
-      "bgcolor": "#533"
-    },
-    {
-      "id": 35,
-      "type": "INPAINT_LoadFooocusInpaint",
-      "pos": [
-        208,
-        1200
-      ],
-      "size": [
-        276.6825206658291,
-        82
-      ],
-      "flags": {},
-      "order": 1,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_PATCH",
-          "type": "INPAINT_PATCH",
-          "links": [
-            62
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadFooocusInpaint"
-      },
-      "widgets_values": [
-        "fooocus_inpaint_head.pth",
-        "inpaint_v26.fooocus.patch"
-      ],
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 44,
-      "type": "INPAINT_VAEEncodeInpaintConditioning",
-      "pos": [
-        194,
-        1330
-      ],
-      "size": {
-        "0": 292.20001220703125,
-        "1": 106
-      },
-      "flags": {},
-      "order": 24,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 122
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 123
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 128
-        },
-        {
-          "name": "pixels",
-          "type": "IMAGE",
-          "link": 140
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 138
-        }
-      ],
-      "outputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "links": [
-            124
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "links": [
-            125
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "latent_inpaint",
-          "type": "LATENT",
-          "links": [
-            127
-          ],
-          "shape": 3,
-          "slot_index": 2
-        },
-        {
-          "name": "latent_samples",
-          "type": "LATENT",
-          "links": [
-            126
-          ],
-          "shape": 3,
-          "slot_index": 3
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_VAEEncodeInpaintConditioning"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 55,
-      "type": "PreviewImage",
-      "pos": [
-        490,
-        800
-      ],
-      "size": [
-        210,
-        246
-      ],
-      "flags": {},
-      "order": 20,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 148
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 51,
-      "type": "Reroute",
-      "pos": [
-        505,
-        1075
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 22,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 167,
-          "slot_index": 0
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            142
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 50,
-      "type": "Reroute",
-      "pos": [
-        109,
-        1080
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 23,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 142
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            140
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 36,
-      "type": "INPAINT_ApplyFooocusInpaint",
-      "pos": [
-        581,
-        1155
-      ],
-      "size": [
-        191.45638474692714,
-        66
-      ],
-      "flags": {},
-      "order": 25,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 60
-        },
-        {
-          "name": "patch",
-          "type": "INPAINT_PATCH",
-          "link": 62
-        },
-        {
-          "name": "latent",
-          "type": "LATENT",
-          "link": 127
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            120
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_ApplyFooocusInpaint"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 47,
-      "type": "Reroute",
-      "pos": [
-        -85.70390089638016,
-        451.81675574263164
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 14,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 170
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "MASK",
-          "links": [
-            137,
-            138,
-            145,
-            151,
-            159
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 46,
-      "type": "Reroute",
-      "pos": [
-        -85.62200405782187,
-        401.364032722935
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 13,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 168
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            136,
-            144,
-            150,
-            154,
-            160
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 62,
-      "type": "Note",
-      "pos": [
-        281,
-        78
-      ],
-      "size": [
-        288.36252399942055,
-        58
-      ],
-      "flags": {},
-      "order": 2,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "pass-through: for refinement with denoise < 1"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 65,
-      "type": "ImageCompositeMasked",
-      "pos": [
-        900.6461852182938,
-        863.8659206207312
-      ],
-      "size": {
-        "0": 315,
-        "1": 146
-      },
-      "flags": {},
-      "order": 28,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "destination",
-          "type": "IMAGE",
-          "link": 160
-        },
-        {
-          "name": "source",
-          "type": "IMAGE",
-          "link": 156
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 159
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            155
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImageCompositeMasked"
-      },
-      "widgets_values": [
-        0,
-        0,
-        false
-      ]
-    },
-    {
-      "id": 14,
-      "type": "VAEDecode",
-      "pos": [
-        900.6461852182938,
-        1063.8659206207312
-      ],
-      "size": [
-        280.3295987363324,
-        47.345116898486594
-      ],
-      "flags": {},
-      "order": 27,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "samples",
-          "type": "LATENT",
-          "link": 97
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 43
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            156
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEDecode"
-      }
-    },
-    {
-      "id": 59,
-      "type": "SaveImage",
-      "pos": [
-        754,
-        76
-      ],
-      "size": [
-        490.8734709718178,
-        686.078138463666
-      ],
-      "flags": {},
-      "order": 29,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 155
-        }
-      ],
-      "properties": {},
-      "widgets_values": [
-        "ComfyUI"
-      ]
-    },
-    {
-      "id": 40,
-      "type": "KSampler",
-      "pos": [
-        912,
-        1169
-      ],
-      "size": {
-        "0": 315,
-        "1": 262
-      },
-      "flags": {},
-      "order": 26,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 120
-        },
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 124
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 125
-        },
-        {
-          "name": "latent_image",
-          "type": "LATENT",
-          "link": 126
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            97
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "KSampler"
-      },
-      "widgets_values": [
-        926268437509169,
-        "randomize",
-        24,
-        5,
-        "dpmpp_2m_sde_gpu",
-        "karras",
-        1
-      ]
-    },
-    {
-      "id": 43,
-      "type": "INPAINT_MaskedBlur",
-      "pos": [
-        120,
-        484
-      ],
-      "size": {
-        "0": 315,
-        "1": 102
-      },
-      "flags": {},
-      "order": 16,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 136
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 137
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            147
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedBlur"
-      },
-      "widgets_values": [
-        255,
-        11
-      ]
-    },
-    {
-      "id": 52,
-      "type": "INPAINT_LoadInpaintModel",
-      "pos": [
-        120,
-        769
-      ],
-      "size": {
-        "0": 315,
-        "1": 58
-      },
-      "flags": {},
-      "order": 3,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_MODEL",
-          "type": "INPAINT_MODEL",
-          "links": [
-            143
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadInpaintModel"
-      },
-      "widgets_values": [
-        "Places_512_FullData_G.pth"
-      ]
-    },
-    {
-      "id": 53,
-      "type": "PreviewImage",
-      "pos": [
-        487,
-        201
-      ],
-      "size": [
-        210,
-        246
-      ],
-      "flags": {},
-      "order": 21,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 146
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 54,
-      "type": "PreviewImage",
-      "pos": [
-        489,
-        491
-      ],
-      "size": [
-        210,
-        246
-      ],
-      "flags": {},
-      "order": 19,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 147
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 45,
-      "type": "ImagePadForOutpaint",
-      "pos": [
-        -482,
-        887
-      ],
-      "size": {
-        "0": 315,
-        "1": 174
-      },
-      "flags": {},
-      "order": 12,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 133
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImagePadForOutpaint"
-      },
-      "widgets_values": [
-        128,
-        0,
-        128,
-        0,
-        40
-      ]
-    },
-    {
-      "id": 66,
-      "type": "Note",
-      "pos": [
-        -466,
-        426
-      ],
-      "size": [
-        309.2648882293299,
-        64.0997455459651
-      ],
-      "flags": {},
-      "order": 4,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "Paint mask into image,\nOR load mask from file,\nOR generate outpainting mask"
-      ],
-      "color": "#2a363b",
-      "bgcolor": "#3f5159"
-    },
-    {
-      "id": 49,
-      "type": "INPAINT_InpaintWithModel",
-      "pos": [
-        121,
-        871
-      ],
-      "size": [
-        311.12821705664123,
-        95.89705449489816
-      ],
-      "flags": {},
-      "order": 17,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "inpaint_model",
-          "type": "INPAINT_MODEL",
-          "link": 143
-        },
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 144
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 145
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            148
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_InpaintWithModel"
-      }
-    },
-    {
-      "id": 61,
-      "type": "Reroute",
-      "pos": [
-        128,
-        88
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 15,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 154
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 56,
-      "type": "Note",
-      "pos": [
-        120,
-        350
-      ],
-      "size": [
-        301.34525467611184,
-        67.77167938795697
-      ],
-      "flags": {},
-      "order": 5,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "neutral: to add objects / make drastic changes\ntelea/navier-stokes: good for outpainting"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 57,
-      "type": "Note",
-      "pos": [
-        127,
-        627
-      ],
-      "size": [
-        301.4128003846947,
-        58
-      ],
-      "flags": {},
-      "order": 6,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "keeps average colors from masked area"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 58,
-      "type": "Note",
-      "pos": [
-        121,
-        997
-      ],
-      "size": [
-        311.85528871597717,
-        60.94014246080269
-      ],
-      "flags": {},
-      "order": 7,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "fill with fast inpaint model\ngood for removing objects"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 48,
-      "type": "INPAINT_MaskedFill",
-      "pos": [
-        110,
-        210
-      ],
-      "size": {
-        "0": 315,
-        "1": 102
-      },
-      "flags": {},
-      "order": 18,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 150
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 151
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            146,
-            167
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedFill"
-      },
-      "widgets_values": [
-        "neutral",
-        11
-      ]
-    },
-    {
-      "id": 34,
-      "type": "LoadImageMask",
-      "pos": [
-        -476,
-        534
-      ],
-      "size": {
-        "0": 315,
-        "1": 318
-      },
-      "flags": {},
-      "order": 8,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImageMask"
-      },
-      "widgets_values": [
-        "mask.png",
-        "red",
-        "image"
-      ]
-    },
-    {
-      "id": 33,
-      "type": "LoadImage",
-      "pos": [
-        -469,
-        71
-      ],
-      "size": {
-        "0": 315,
-        "1": 314
-      },
-      "flags": {},
-      "order": 9,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            133,
-            168
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [
-            170
-          ],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImage"
-      },
-      "widgets_values": [
-        "base.png",
-        "image"
-      ]
-    },
-    {
-      "id": 9,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -476,
-        1249
-      ],
-      "size": [
-        421.96778938051466,
-        88.26173063346437
-      ],
-      "flags": {},
-      "order": 11,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 88
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            122
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "positive prompt"
-      ],
-      "color": "#232",
-      "bgcolor": "#353"
-    }
-  ],
-  "links": [
-    [
-      35,
-      19,
-      1,
-      10,
-      0,
-      "CLIP"
-    ],
-    [
-      43,
-      19,
-      2,
-      14,
-      1,
-      "VAE"
-    ],
-    [
-      60,
-      19,
-      0,
-      36,
-      0,
-      "MODEL"
-    ],
-    [
-      62,
-      35,
-      0,
-      36,
-      1,
-      "INPAINT_PATCH"
-    ],
-    [
-      88,
-      19,
-      1,
-      9,
-      0,
-      "CLIP"
-    ],
-    [
-      97,
-      40,
-      0,
-      14,
-      0,
-      "LATENT"
-    ],
-    [
-      120,
-      36,
-      0,
-      40,
-      0,
-      "MODEL"
-    ],
-    [
-      122,
-      9,
-      0,
-      44,
-      0,
-      "CONDITIONING"
-    ],
-    [
-      123,
-      10,
-      0,
-      44,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      124,
-      44,
-      0,
-      40,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      125,
-      44,
-      1,
-      40,
-      2,
-      "CONDITIONING"
-    ],
-    [
-      126,
-      44,
-      3,
-      40,
-      3,
-      "LATENT"
-    ],
-    [
-      127,
-      44,
-      2,
-      36,
-      2,
-      "LATENT"
-    ],
-    [
-      128,
-      19,
-      2,
-      44,
-      2,
-      "VAE"
-    ],
-    [
-      133,
-      33,
-      0,
-      45,
-      0,
-      "IMAGE"
-    ],
-    [
-      136,
-      46,
-      0,
-      43,
-      0,
-      "IMAGE"
-    ],
-    [
-      137,
-      47,
-      0,
-      43,
-      1,
-      "MASK"
-    ],
-    [
-      138,
-      47,
-      0,
-      44,
-      4,
-      "MASK"
-    ],
-    [
-      140,
-      50,
-      0,
-      44,
-      3,
-      "IMAGE"
-    ],
-    [
-      142,
-      51,
-      0,
-      50,
-      0,
-      "*"
-    ],
-    [
-      143,
-      52,
-      0,
-      49,
-      0,
-      "INPAINT_MODEL"
-    ],
-    [
-      144,
-      46,
-      0,
-      49,
-      1,
-      "IMAGE"
-    ],
-    [
-      145,
-      47,
-      0,
-      49,
-      2,
-      "MASK"
-    ],
-    [
-      146,
-      48,
-      0,
-      53,
-      0,
-      "IMAGE"
-    ],
-    [
-      147,
-      43,
-      0,
-      54,
-      0,
-      "IMAGE"
-    ],
-    [
-      148,
-      49,
-      0,
-      55,
-      0,
-      "IMAGE"
-    ],
-    [
-      150,
-      46,
-      0,
-      48,
-      0,
-      "IMAGE"
-    ],
-    [
-      151,
-      47,
-      0,
-      48,
-      1,
-      "MASK"
-    ],
-    [
-      154,
-      46,
-      0,
-      61,
-      0,
-      "*"
-    ],
-    [
-      155,
-      65,
-      0,
-      59,
-      0,
-      "IMAGE"
-    ],
-    [
-      156,
-      14,
-      0,
-      65,
-      1,
-      "IMAGE"
-    ],
-    [
-      159,
-      47,
-      0,
-      65,
-      2,
-      "MASK"
-    ],
-    [
-      160,
-      46,
-      0,
-      65,
-      0,
-      "IMAGE"
-    ],
-    [
-      167,
-      48,
-      0,
-      51,
-      0,
-      "*"
-    ],
-    [
-      168,
-      33,
-      0,
-      46,
-      0,
-      "*"
-    ],
-    [
-      170,
-      33,
-      1,
-      47,
-      0,
-      "*"
-    ]
-  ],
-  "groups": [
-    {
-      "title": "Input Image and Mask",
-      "bounding": [
-        -496,
-        -2,
-        452,
-        1072
-      ],
-      "color": "#3f789e",
-      "font_size": 24
-    },
-    {
-      "title": "Preprocess",
-      "bounding": [
-        93,
-        -2,
-        623,
-        1087
-      ],
-      "color": "#b06634",
-      "font_size": 24
-    },
-    {
-      "title": "Postprocess",
-      "bounding": [
-        891,
-        790,
-        335,
-        331
-      ],
-      "color": "#8AA",
-      "font_size": 24
-    }
-  ],
-  "config": {},
-  "extra": {},
-  "version": 0.4
-}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-promptless.json b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-promptless.json
deleted file mode 100644
index 093f857..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-promptless.json
+++ /dev/null
@@ -1,1638 +0,0 @@
-{
-  "last_node_id": 71,
-  "last_link_id": 184,
-  "nodes": [
-    {
-      "id": 55,
-      "type": "PreviewImage",
-      "pos": [
-        490,
-        800
-      ],
-      "size": {
-        "0": 210,
-        "1": 246
-      },
-      "flags": {},
-      "order": 22,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 148
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 47,
-      "type": "Reroute",
-      "pos": [
-        -85.70390089638016,
-        451.81675574263164
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 15,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 184
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "MASK",
-          "links": [
-            137,
-            138,
-            145,
-            151,
-            159
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 62,
-      "type": "Note",
-      "pos": [
-        281,
-        78
-      ],
-      "size": {
-        "0": 288.3625183105469,
-        "1": 58
-      },
-      "flags": {},
-      "order": 0,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "pass-through: for refinement with denoise < 1"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 65,
-      "type": "ImageCompositeMasked",
-      "pos": [
-        900.6461852182938,
-        863.8659206207312
-      ],
-      "size": {
-        "0": 315,
-        "1": 146
-      },
-      "flags": {},
-      "order": 30,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "destination",
-          "type": "IMAGE",
-          "link": 160
-        },
-        {
-          "name": "source",
-          "type": "IMAGE",
-          "link": 156
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 159
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            155
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImageCompositeMasked"
-      },
-      "widgets_values": [
-        0,
-        0,
-        false
-      ]
-    },
-    {
-      "id": 59,
-      "type": "SaveImage",
-      "pos": [
-        754,
-        76
-      ],
-      "size": {
-        "0": 490.87347412109375,
-        "1": 686.078125
-      },
-      "flags": {},
-      "order": 31,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 155
-        }
-      ],
-      "properties": {},
-      "widgets_values": [
-        "ComfyUI"
-      ]
-    },
-    {
-      "id": 43,
-      "type": "INPAINT_MaskedBlur",
-      "pos": [
-        120,
-        484
-      ],
-      "size": {
-        "0": 315,
-        "1": 102
-      },
-      "flags": {},
-      "order": 18,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 136
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 137
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            147
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedBlur"
-      },
-      "widgets_values": [
-        255,
-        11
-      ]
-    },
-    {
-      "id": 53,
-      "type": "PreviewImage",
-      "pos": [
-        487,
-        201
-      ],
-      "size": {
-        "0": 210,
-        "1": 246
-      },
-      "flags": {},
-      "order": 23,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 146
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 54,
-      "type": "PreviewImage",
-      "pos": [
-        489,
-        491
-      ],
-      "size": {
-        "0": 210,
-        "1": 246
-      },
-      "flags": {},
-      "order": 21,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 147
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 45,
-      "type": "ImagePadForOutpaint",
-      "pos": [
-        -482,
-        887
-      ],
-      "size": {
-        "0": 315,
-        "1": 174
-      },
-      "flags": {},
-      "order": 13,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 133
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImagePadForOutpaint"
-      },
-      "widgets_values": [
-        128,
-        0,
-        128,
-        0,
-        40
-      ]
-    },
-    {
-      "id": 66,
-      "type": "Note",
-      "pos": [
-        -466,
-        426
-      ],
-      "size": {
-        "0": 309.264892578125,
-        "1": 64.09974670410156
-      },
-      "flags": {},
-      "order": 1,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "Paint mask into image,\nOR load mask from file,\nOR generate outpainting mask"
-      ],
-      "color": "#2a363b",
-      "bgcolor": "#3f5159"
-    },
-    {
-      "id": 61,
-      "type": "Reroute",
-      "pos": [
-        128,
-        88
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 16,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 154
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 56,
-      "type": "Note",
-      "pos": [
-        120,
-        350
-      ],
-      "size": {
-        "0": 301.3452453613281,
-        "1": 67.77168273925781
-      },
-      "flags": {},
-      "order": 2,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "neutral: to add objects / make drastic changes\ntelea/navier-stokes: good for outpainting"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 57,
-      "type": "Note",
-      "pos": [
-        127,
-        627
-      ],
-      "size": {
-        "0": 301.4128112792969,
-        "1": 58
-      },
-      "flags": {},
-      "order": 3,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "keeps average colors from masked area"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 48,
-      "type": "INPAINT_MaskedFill",
-      "pos": [
-        110,
-        210
-      ],
-      "size": {
-        "0": 315,
-        "1": 102
-      },
-      "flags": {},
-      "order": 20,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 150
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 151
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            146,
-            167
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedFill"
-      },
-      "widgets_values": [
-        "neutral",
-        11
-      ]
-    },
-    {
-      "id": 36,
-      "type": "INPAINT_ApplyFooocusInpaint",
-      "pos": [
-        679,
-        1339
-      ],
-      "size": {
-        "0": 191.45639038085938,
-        "1": 66
-      },
-      "flags": {},
-      "order": 27,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 181
-        },
-        {
-          "name": "patch",
-          "type": "INPAINT_PATCH",
-          "link": 62
-        },
-        {
-          "name": "latent",
-          "type": "LATENT",
-          "link": 127
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            120
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_ApplyFooocusInpaint"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 40,
-      "type": "KSampler",
-      "pos": [
-        907,
-        1200
-      ],
-      "size": {
-        "0": 321.14495849609375,
-        "1": 262
-      },
-      "flags": {},
-      "order": 28,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 120
-        },
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 124
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 125
-        },
-        {
-          "name": "latent_image",
-          "type": "LATENT",
-          "link": 126
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            97
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "KSampler"
-      },
-      "widgets_values": [
-        469445285154282,
-        "randomize",
-        24,
-        5,
-        "dpmpp_2m_sde_gpu",
-        "karras",
-        1
-      ]
-    },
-    {
-      "id": 19,
-      "type": "CheckpointLoaderSimple",
-      "pos": [
-        -483,
-        1110
-      ],
-      "size": {
-        "0": 401.11712646484375,
-        "1": 98
-      },
-      "flags": {},
-      "order": 4,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            178
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "CLIP",
-          "type": "CLIP",
-          "links": [
-            35,
-            88
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "VAE",
-          "type": "VAE",
-          "links": [
-            43,
-            128
-          ],
-          "shape": 3,
-          "slot_index": 2
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CheckpointLoaderSimple"
-      },
-      "widgets_values": [
-        "juggernautXL_version6Rundiffusion.safetensors"
-      ]
-    },
-    {
-      "id": 46,
-      "type": "Reroute",
-      "pos": [
-        -86,
-        401
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 14,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 168
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            136,
-            144,
-            150,
-            154,
-            160,
-            180
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 35,
-      "type": "INPAINT_LoadFooocusInpaint",
-      "pos": [
-        334,
-        1391
-      ],
-      "size": {
-        "0": 289.209716796875,
-        "1": 82
-      },
-      "flags": {},
-      "order": 5,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_PATCH",
-          "type": "INPAINT_PATCH",
-          "links": [
-            62
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadFooocusInpaint"
-      },
-      "widgets_values": [
-        "fooocus_inpaint_head.pth",
-        "inpaint_v26.fooocus.patch"
-      ],
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 34,
-      "type": "LoadImageMask",
-      "pos": [
-        -476,
-        534
-      ],
-      "size": {
-        "0": 315,
-        "1": 318
-      },
-      "flags": {},
-      "order": 6,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImageMask"
-      },
-      "widgets_values": [
-        "mask1024 (1).png",
-        "red",
-        "image"
-      ]
-    },
-    {
-      "id": 44,
-      "type": "INPAINT_VAEEncodeInpaintConditioning",
-      "pos": [
-        350,
-        1193
-      ],
-      "size": {
-        "0": 277.20001220703125,
-        "1": 113.80070495605469
-      },
-      "flags": {},
-      "order": 26,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 122
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 123
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 128
-        },
-        {
-          "name": "pixels",
-          "type": "IMAGE",
-          "link": 140
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 138
-        }
-      ],
-      "outputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "links": [
-            124
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "links": [
-            125
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "latent_inpaint",
-          "type": "LATENT",
-          "links": [
-            127
-          ],
-          "shape": 3,
-          "slot_index": 2
-        },
-        {
-          "name": "latent_samples",
-          "type": "LATENT",
-          "links": [
-            126
-          ],
-          "shape": 3,
-          "slot_index": 3
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_VAEEncodeInpaintConditioning"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 58,
-      "type": "Note",
-      "pos": [
-        124,
-        1033
-      ],
-      "size": {
-        "0": 311.85528564453125,
-        "1": 60.94014358520508
-      },
-      "flags": {},
-      "order": 7,
-      "mode": 0,
-      "properties": {
-        "text": ""
-      },
-      "widgets_values": [
-        "fill with fast inpaint model\ngood for removing objects"
-      ],
-      "color": "#432",
-      "bgcolor": "#653"
-    },
-    {
-      "id": 10,
-      "type": "CLIPTextEncode",
-      "pos": [
-        0,
-        1240
-      ],
-      "size": {
-        "0": 417.58416748046875,
-        "1": 76
-      },
-      "flags": {
-        "collapsed": true
-      },
-      "order": 11,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 35
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            123
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "text, watermark"
-      ],
-      "color": "#322",
-      "bgcolor": "#533"
-    },
-    {
-      "id": 9,
-      "type": "CLIPTextEncode",
-      "pos": [
-        0,
-        1193
-      ],
-      "size": {
-        "0": 421.9678039550781,
-        "1": 88.26173400878906
-      },
-      "flags": {
-        "collapsed": true
-      },
-      "order": 12,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 88
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            122
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        ""
-      ],
-      "color": "#232",
-      "bgcolor": "#353"
-    },
-    {
-      "id": 50,
-      "type": "Reroute",
-      "pos": [
-        127,
-        1110
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 25,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 142
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            140
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 14,
-      "type": "VAEDecode",
-      "pos": [
-        917,
-        1056
-      ],
-      "size": {
-        "0": 280.32958984375,
-        "1": 47.345115661621094
-      },
-      "flags": {},
-      "order": 29,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "samples",
-          "type": "LATENT",
-          "link": 97
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 43
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            156
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEDecode"
-      }
-    },
-    {
-      "id": 51,
-      "type": "Reroute",
-      "pos": [
-        514,
-        1070
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 24,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 167,
-          "slot_index": 0
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "IMAGE",
-          "links": [
-            142
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 71,
-      "type": "IPAdapter",
-      "pos": [
-        -14,
-        1304
-      ],
-      "size": {
-        "0": 315,
-        "1": 166
-      },
-      "flags": {},
-      "order": 17,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 179
-        },
-        {
-          "name": "ipadapter",
-          "type": "IPADAPTER",
-          "link": 183,
-          "slot_index": 1
-        },
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 180
-        },
-        {
-          "name": "attn_mask",
-          "type": "MASK",
-          "link": null
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            181
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "IPAdapter"
-      },
-      "widgets_values": [
-        1,
-        0,
-        1
-      ]
-    },
-    {
-      "id": 70,
-      "type": "IPAdapterUnifiedLoader",
-      "pos": [
-        -479,
-        1256
-      ],
-      "size": [
-        382.11956787109375,
-        78
-      ],
-      "flags": {},
-      "order": 10,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 178
-        },
-        {
-          "name": "ipadapter",
-          "type": "IPADAPTER",
-          "link": null
-        }
-      ],
-      "outputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "links": [
-            179
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "ipadapter",
-          "type": "IPADAPTER",
-          "links": [
-            183
-          ],
-          "shape": 3
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "IPAdapterUnifiedLoader"
-      },
-      "widgets_values": [
-        "STANDARD (medium strength)"
-      ]
-    },
-    {
-      "id": 33,
-      "type": "LoadImage",
-      "pos": [
-        -469,
-        71
-      ],
-      "size": {
-        "0": 315,
-        "1": 314
-      },
-      "flags": {},
-      "order": 8,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            133,
-            168
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [
-            184
-          ],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImage"
-      },
-      "widgets_values": [
-        "base1024 (1).png",
-        "image"
-      ]
-    },
-    {
-      "id": 52,
-      "type": "INPAINT_LoadInpaintModel",
-      "pos": [
-        121,
-        756
-      ],
-      "size": {
-        "0": 315,
-        "1": 58
-      },
-      "flags": {},
-      "order": 9,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_MODEL",
-          "type": "INPAINT_MODEL",
-          "links": [
-            143
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadInpaintModel"
-      },
-      "widgets_values": [
-        "Places_512_FullData_G.pth"
-      ]
-    },
-    {
-      "id": 49,
-      "type": "INPAINT_InpaintWithModel",
-      "pos": [
-        125,
-        859
-      ],
-      "size": {
-        "0": 311.1282043457031,
-        "1": 142
-      },
-      "flags": {},
-      "order": 19,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "inpaint_model",
-          "type": "INPAINT_MODEL",
-          "link": 143
-        },
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 144
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 145
-        },
-        {
-          "name": "optional_upscale_model",
-          "type": "UPSCALE_MODEL",
-          "link": null
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            148
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_InpaintWithModel"
-      },
-      "widgets_values": [
-        147163031900914,
-        "randomize"
-      ]
-    }
-  ],
-  "links": [
-    [
-      35,
-      19,
-      1,
-      10,
-      0,
-      "CLIP"
-    ],
-    [
-      43,
-      19,
-      2,
-      14,
-      1,
-      "VAE"
-    ],
-    [
-      62,
-      35,
-      0,
-      36,
-      1,
-      "INPAINT_PATCH"
-    ],
-    [
-      88,
-      19,
-      1,
-      9,
-      0,
-      "CLIP"
-    ],
-    [
-      97,
-      40,
-      0,
-      14,
-      0,
-      "LATENT"
-    ],
-    [
-      120,
-      36,
-      0,
-      40,
-      0,
-      "MODEL"
-    ],
-    [
-      122,
-      9,
-      0,
-      44,
-      0,
-      "CONDITIONING"
-    ],
-    [
-      123,
-      10,
-      0,
-      44,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      124,
-      44,
-      0,
-      40,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      125,
-      44,
-      1,
-      40,
-      2,
-      "CONDITIONING"
-    ],
-    [
-      126,
-      44,
-      3,
-      40,
-      3,
-      "LATENT"
-    ],
-    [
-      127,
-      44,
-      2,
-      36,
-      2,
-      "LATENT"
-    ],
-    [
-      128,
-      19,
-      2,
-      44,
-      2,
-      "VAE"
-    ],
-    [
-      133,
-      33,
-      0,
-      45,
-      0,
-      "IMAGE"
-    ],
-    [
-      136,
-      46,
-      0,
-      43,
-      0,
-      "IMAGE"
-    ],
-    [
-      137,
-      47,
-      0,
-      43,
-      1,
-      "MASK"
-    ],
-    [
-      138,
-      47,
-      0,
-      44,
-      4,
-      "MASK"
-    ],
-    [
-      140,
-      50,
-      0,
-      44,
-      3,
-      "IMAGE"
-    ],
-    [
-      142,
-      51,
-      0,
-      50,
-      0,
-      "*"
-    ],
-    [
-      143,
-      52,
-      0,
-      49,
-      0,
-      "INPAINT_MODEL"
-    ],
-    [
-      144,
-      46,
-      0,
-      49,
-      1,
-      "IMAGE"
-    ],
-    [
-      145,
-      47,
-      0,
-      49,
-      2,
-      "MASK"
-    ],
-    [
-      146,
-      48,
-      0,
-      53,
-      0,
-      "IMAGE"
-    ],
-    [
-      147,
-      43,
-      0,
-      54,
-      0,
-      "IMAGE"
-    ],
-    [
-      148,
-      49,
-      0,
-      55,
-      0,
-      "IMAGE"
-    ],
-    [
-      150,
-      46,
-      0,
-      48,
-      0,
-      "IMAGE"
-    ],
-    [
-      151,
-      47,
-      0,
-      48,
-      1,
-      "MASK"
-    ],
-    [
-      154,
-      46,
-      0,
-      61,
-      0,
-      "*"
-    ],
-    [
-      155,
-      65,
-      0,
-      59,
-      0,
-      "IMAGE"
-    ],
-    [
-      156,
-      14,
-      0,
-      65,
-      1,
-      "IMAGE"
-    ],
-    [
-      159,
-      47,
-      0,
-      65,
-      2,
-      "MASK"
-    ],
-    [
-      160,
-      46,
-      0,
-      65,
-      0,
-      "IMAGE"
-    ],
-    [
-      167,
-      48,
-      0,
-      51,
-      0,
-      "*"
-    ],
-    [
-      168,
-      33,
-      0,
-      46,
-      0,
-      "*"
-    ],
-    [
-      178,
-      19,
-      0,
-      70,
-      0,
-      "MODEL"
-    ],
-    [
-      179,
-      70,
-      0,
-      71,
-      0,
-      "MODEL"
-    ],
-    [
-      180,
-      46,
-      0,
-      71,
-      2,
-      "IMAGE"
-    ],
-    [
-      181,
-      71,
-      0,
-      36,
-      0,
-      "MODEL"
-    ],
-    [
-      183,
-      70,
-      1,
-      71,
-      1,
-      "IPADAPTER"
-    ],
-    [
-      184,
-      33,
-      1,
-      47,
-      0,
-      "*"
-    ]
-  ],
-  "groups": [
-    {
-      "title": "Input Image and Mask",
-      "bounding": [
-        -496,
-        -2,
-        452,
-        1072
-      ],
-      "color": "#3f789e",
-      "font_size": 24
-    },
-    {
-      "title": "Preprocess",
-      "bounding": [
-        93,
-        -2,
-        631,
-        1126
-      ],
-      "color": "#b06634",
-      "font_size": 24
-    },
-    {
-      "title": "Postprocess",
-      "bounding": [
-        891,
-        790,
-        335,
-        331
-      ],
-      "color": "#8AA",
-      "font_size": 24
-    }
-  ],
-  "config": {},
-  "extra": {},
-  "version": 0.4
-}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-refine.json b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-refine.json
deleted file mode 100644
index e104f3c..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-refine.json
+++ /dev/null
@@ -1,696 +0,0 @@
-{
-  "last_node_id": 66,
-  "last_link_id": 178,
-  "nodes": [
-    {
-      "id": 10,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -455,
-        557
-      ],
-      "size": [
-        321.6668823242188,
-        76
-      ],
-      "flags": {},
-      "order": 3,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 35
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            123
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "text, watermark"
-      ],
-      "color": "#322",
-      "bgcolor": "#533"
-    },
-    {
-      "id": 19,
-      "type": "CheckpointLoaderSimple",
-      "pos": [
-        -452,
-        672
-      ],
-      "size": [
-        409.4665283203125,
-        98
-      ],
-      "flags": {},
-      "order": 0,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            60
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "CLIP",
-          "type": "CLIP",
-          "links": [
-            35,
-            88
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "VAE",
-          "type": "VAE",
-          "links": [
-            43,
-            128
-          ],
-          "shape": 3,
-          "slot_index": 2
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CheckpointLoaderSimple"
-      },
-      "widgets_values": [
-        "juggernautXL_version6Rundiffusion.safetensors"
-      ]
-    },
-    {
-      "id": 44,
-      "type": "INPAINT_VAEEncodeInpaintConditioning",
-      "pos": [
-        -38,
-        250
-      ],
-      "size": {
-        "0": 292.20001220703125,
-        "1": 106
-      },
-      "flags": {},
-      "order": 5,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 122
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 123
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 128
-        },
-        {
-          "name": "pixels",
-          "type": "IMAGE",
-          "link": 178
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 177
-        }
-      ],
-      "outputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "links": [
-            124
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "links": [
-            125
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "latent_inpaint",
-          "type": "LATENT",
-          "links": [
-            127
-          ],
-          "shape": 3,
-          "slot_index": 2
-        },
-        {
-          "name": "latent_samples",
-          "type": "LATENT",
-          "links": [
-            126
-          ],
-          "shape": 3,
-          "slot_index": 3
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_VAEEncodeInpaintConditioning"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 35,
-      "type": "INPAINT_LoadFooocusInpaint",
-      "pos": [
-        -29,
-        400
-      ],
-      "size": {
-        "0": 276.6825256347656,
-        "1": 82
-      },
-      "flags": {},
-      "order": 1,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_PATCH",
-          "type": "INPAINT_PATCH",
-          "links": [
-            62
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadFooocusInpaint"
-      },
-      "widgets_values": [
-        "fooocus_inpaint_head.pth",
-        "inpaint_v26.fooocus.patch"
-      ],
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 36,
-      "type": "INPAINT_ApplyFooocusInpaint",
-      "pos": [
-        338,
-        509
-      ],
-      "size": {
-        "0": 191.45639038085938,
-        "1": 66
-      },
-      "flags": {},
-      "order": 6,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 60
-        },
-        {
-          "name": "patch",
-          "type": "INPAINT_PATCH",
-          "link": 62
-        },
-        {
-          "name": "latent",
-          "type": "LATENT",
-          "link": 127
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            120
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_ApplyFooocusInpaint"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 14,
-      "type": "VAEDecode",
-      "pos": [
-        673,
-        167
-      ],
-      "size": [
-        140,
-        49.74785232543945
-      ],
-      "flags": {},
-      "order": 8,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "samples",
-          "type": "LATENT",
-          "link": 97
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 43
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            156
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEDecode"
-      }
-    },
-    {
-      "id": 65,
-      "type": "ImageCompositeMasked",
-      "pos": [
-        840,
-        70
-      ],
-      "size": [
-        240.56597900390625,
-        146
-      ],
-      "flags": {},
-      "order": 9,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "destination",
-          "type": "IMAGE",
-          "link": 174
-        },
-        {
-          "name": "source",
-          "type": "IMAGE",
-          "link": 156
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 175
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            155
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImageCompositeMasked"
-      },
-      "widgets_values": [
-        0,
-        0,
-        false
-      ]
-    },
-    {
-      "id": 59,
-      "type": "SaveImage",
-      "pos": [
-        670,
-        280
-      ],
-      "size": [
-        420.46597900390634,
-        474.3479354858399
-      ],
-      "flags": {},
-      "order": 10,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 155
-        }
-      ],
-      "properties": {},
-      "widgets_values": [
-        "ComfyUI"
-      ]
-    },
-    {
-      "id": 9,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -456,
-        425
-      ],
-      "size": [
-        326.6668823242188,
-        95.14787673950195
-      ],
-      "flags": {},
-      "order": 4,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 88
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            122
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "POSITIVE PROMPT"
-      ],
-      "color": "#232",
-      "bgcolor": "#353"
-    },
-    {
-      "id": 33,
-      "type": "LoadImage",
-      "pos": [
-        -460,
-        74
-      ],
-      "size": [
-        295.56678466796876,
-        314
-      ],
-      "flags": {},
-      "order": 2,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            174,
-            178
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [
-            175,
-            177
-          ],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImage"
-      },
-      "widgets_values": [
-        "base1024.png",
-        "image"
-      ]
-    },
-    {
-      "id": 40,
-      "type": "KSampler",
-      "pos": [
-        331,
-        177
-      ],
-      "size": {
-        "0": 315,
-        "1": 262
-      },
-      "flags": {},
-      "order": 7,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 120
-        },
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 124
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 125
-        },
-        {
-          "name": "latent_image",
-          "type": "LATENT",
-          "link": 126
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            97
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "KSampler"
-      },
-      "widgets_values": [
-        949757093954838,
-        "randomize",
-        20,
-        5,
-        "dpmpp_2m_sde_gpu",
-        "karras",
-        0.7000000000000001
-      ]
-    }
-  ],
-  "links": [
-    [
-      35,
-      19,
-      1,
-      10,
-      0,
-      "CLIP"
-    ],
-    [
-      43,
-      19,
-      2,
-      14,
-      1,
-      "VAE"
-    ],
-    [
-      60,
-      19,
-      0,
-      36,
-      0,
-      "MODEL"
-    ],
-    [
-      62,
-      35,
-      0,
-      36,
-      1,
-      "INPAINT_PATCH"
-    ],
-    [
-      88,
-      19,
-      1,
-      9,
-      0,
-      "CLIP"
-    ],
-    [
-      97,
-      40,
-      0,
-      14,
-      0,
-      "LATENT"
-    ],
-    [
-      120,
-      36,
-      0,
-      40,
-      0,
-      "MODEL"
-    ],
-    [
-      122,
-      9,
-      0,
-      44,
-      0,
-      "CONDITIONING"
-    ],
-    [
-      123,
-      10,
-      0,
-      44,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      124,
-      44,
-      0,
-      40,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      125,
-      44,
-      1,
-      40,
-      2,
-      "CONDITIONING"
-    ],
-    [
-      126,
-      44,
-      3,
-      40,
-      3,
-      "LATENT"
-    ],
-    [
-      127,
-      44,
-      2,
-      36,
-      2,
-      "LATENT"
-    ],
-    [
-      128,
-      19,
-      2,
-      44,
-      2,
-      "VAE"
-    ],
-    [
-      155,
-      65,
-      0,
-      59,
-      0,
-      "IMAGE"
-    ],
-    [
-      156,
-      14,
-      0,
-      65,
-      1,
-      "IMAGE"
-    ],
-    [
-      174,
-      33,
-      0,
-      65,
-      0,
-      "IMAGE"
-    ],
-    [
-      175,
-      33,
-      1,
-      65,
-      2,
-      "MASK"
-    ],
-    [
-      177,
-      33,
-      1,
-      44,
-      4,
-      "MASK"
-    ],
-    [
-      178,
-      33,
-      0,
-      44,
-      3,
-      "IMAGE"
-    ]
-  ],
-  "groups": [],
-  "config": {},
-  "extra": {},
-  "version": 0.4
-}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-simple.json b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-simple.json
deleted file mode 100644
index e5f572e..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/inpaint-simple.json
+++ /dev/null
@@ -1,609 +0,0 @@
-{
-  "last_node_id": 42,
-  "last_link_id": 107,
-  "nodes": [
-    {
-      "id": 33,
-      "type": "LoadImage",
-      "pos": [
-        -325,
-        111
-      ],
-      "size": {
-        "0": 439.18682861328125,
-        "1": 485.00018310546875
-      },
-      "flags": {},
-      "order": 0,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            79
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [
-            99
-          ],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImage"
-      },
-      "widgets_values": [
-        "clipspace/clipspace-mask-6116028.100000143.png [input]",
-        "image"
-      ]
-    },
-    {
-      "id": 42,
-      "type": "Reroute",
-      "pos": [
-        168,
-        -138
-      ],
-      "size": [
-        75,
-        26
-      ],
-      "flags": {},
-      "order": 6,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "",
-          "type": "*",
-          "link": 102
-        }
-      ],
-      "outputs": [
-        {
-          "name": "",
-          "type": "INPAINT_PATCH",
-          "links": [
-            101
-          ],
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "showOutputText": false,
-        "horizontal": false
-      }
-    },
-    {
-      "id": 19,
-      "type": "CheckpointLoaderSimple",
-      "pos": [
-        -326,
-        -168
-      ],
-      "size": {
-        "0": 431,
-        "1": 98
-      },
-      "flags": {},
-      "order": 1,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            60
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "CLIP",
-          "type": "CLIP",
-          "links": [
-            103,
-            104
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "VAE",
-          "type": "VAE",
-          "links": [
-            81,
-            107
-          ],
-          "shape": 3,
-          "slot_index": 2
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CheckpointLoaderSimple"
-      },
-      "widgets_values": [
-        "juggernautXL_version6Rundiffusion.safetensors"
-      ]
-    },
-    {
-      "id": 9,
-      "type": "CLIPTextEncode",
-      "pos": [
-        200,
-        270
-      ],
-      "size": {
-        "0": 400,
-        "1": 200
-      },
-      "flags": {},
-      "order": 3,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 103
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            98
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "photo of a bear standing in a stony river bed, nature"
-      ]
-    },
-    {
-      "id": 14,
-      "type": "VAEDecode",
-      "pos": [
-        386,
-        171
-      ],
-      "size": {
-        "0": 210,
-        "1": 46
-      },
-      "flags": {},
-      "order": 9,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "samples",
-          "type": "LATENT",
-          "link": 97
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 107,
-          "slot_index": 1
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            46
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEDecode"
-      }
-    },
-    {
-      "id": 28,
-      "type": "PreviewImage",
-      "pos": [
-        664,
-        157
-      ],
-      "size": [
-        460,
-        430
-      ],
-      "flags": {},
-      "order": 10,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 46
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "PreviewImage"
-      }
-    },
-    {
-      "id": 10,
-      "type": "CLIPTextEncode",
-      "pos": [
-        204,
-        512
-      ],
-      "size": {
-        "0": 397.5622253417969,
-        "1": 76
-      },
-      "flags": {},
-      "order": 4,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 104
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            105
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "text, watermark"
-      ]
-    },
-    {
-      "id": 38,
-      "type": "VAEEncodeForInpaint",
-      "pos": [
-        187,
-        -38
-      ],
-      "size": {
-        "0": 315,
-        "1": 98
-      },
-      "flags": {},
-      "order": 5,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "pixels",
-          "type": "IMAGE",
-          "link": 79
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 81
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 99
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            91,
-            106
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEEncodeForInpaint"
-      },
-      "widgets_values": [
-        8
-      ]
-    },
-    {
-      "id": 40,
-      "type": "KSampler",
-      "pos": [
-        805,
-        -167
-      ],
-      "size": {
-        "0": 315,
-        "1": 262
-      },
-      "flags": {},
-      "order": 8,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 93
-        },
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 98
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 105
-        },
-        {
-          "name": "latent_image",
-          "type": "LATENT",
-          "link": 106,
-          "slot_index": 3
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            97
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "KSampler"
-      },
-      "widgets_values": [
-        923431948001835,
-        "fixed",
-        24,
-        5,
-        "dpmpp_2m_sde_gpu",
-        "karras",
-        1
-      ]
-    },
-    {
-      "id": 35,
-      "type": "INPAINT_LoadFooocusInpaint",
-      "pos": [
-        -321,
-        -26
-      ],
-      "size": {
-        "0": 418.0268249511719,
-        "1": 87.3501968383789
-      },
-      "flags": {},
-      "order": 2,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_PATCH",
-          "type": "INPAINT_PATCH",
-          "links": [
-            102
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadFooocusInpaint"
-      },
-      "widgets_values": [
-        "fooocus_inpaint_head.pth",
-        "inpaint_v26.fooocus.patch"
-      ],
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 36,
-      "type": "INPAINT_ApplyFooocusInpaint",
-      "pos": [
-        536,
-        -168
-      ],
-      "size": [
-        209,
-        71
-      ],
-      "flags": {},
-      "order": 7,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 60
-        },
-        {
-          "name": "patch",
-          "type": "INPAINT_PATCH",
-          "link": 101
-        },
-        {
-          "name": "latent",
-          "type": "LATENT",
-          "link": 91
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            93
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_ApplyFooocusInpaint"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    }
-  ],
-  "links": [
-    [
-      46,
-      14,
-      0,
-      28,
-      0,
-      "IMAGE"
-    ],
-    [
-      60,
-      19,
-      0,
-      36,
-      0,
-      "MODEL"
-    ],
-    [
-      79,
-      33,
-      0,
-      38,
-      0,
-      "IMAGE"
-    ],
-    [
-      81,
-      19,
-      2,
-      38,
-      1,
-      "VAE"
-    ],
-    [
-      91,
-      38,
-      0,
-      36,
-      2,
-      "LATENT"
-    ],
-    [
-      93,
-      36,
-      0,
-      40,
-      0,
-      "MODEL"
-    ],
-    [
-      97,
-      40,
-      0,
-      14,
-      0,
-      "LATENT"
-    ],
-    [
-      98,
-      9,
-      0,
-      40,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      99,
-      33,
-      1,
-      38,
-      2,
-      "MASK"
-    ],
-    [
-      101,
-      42,
-      0,
-      36,
-      1,
-      "INPAINT_PATCH"
-    ],
-    [
-      102,
-      35,
-      0,
-      42,
-      0,
-      "*"
-    ],
-    [
-      103,
-      19,
-      1,
-      9,
-      0,
-      "CLIP"
-    ],
-    [
-      104,
-      19,
-      1,
-      10,
-      0,
-      "CLIP"
-    ],
-    [
-      105,
-      10,
-      0,
-      40,
-      2,
-      "CONDITIONING"
-    ],
-    [
-      106,
-      38,
-      0,
-      40,
-      3,
-      "LATENT"
-    ],
-    [
-      107,
-      19,
-      2,
-      14,
-      1,
-      "VAE"
-    ]
-  ],
-  "groups": [],
-  "config": {},
-  "extra": {},
-  "version": 0.4
-}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/outpaint.json b/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/outpaint.json
deleted file mode 100644
index 152916a..0000000
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/custom_nodes/comfyui-inpaint-nodes/workflows/outpaint.json
+++ /dev/null
@@ -1,878 +0,0 @@
-{
-  "last_node_id": 74,
-  "last_link_id": 199,
-  "nodes": [
-    {
-      "id": 44,
-      "type": "INPAINT_VAEEncodeInpaintConditioning",
-      "pos": [
-        -24,
-        400
-      ],
-      "size": {
-        "0": 292.20001220703125,
-        "1": 106
-      },
-      "flags": {},
-      "order": 8,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 122
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 123
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 128
-        },
-        {
-          "name": "pixels",
-          "type": "IMAGE",
-          "link": 198
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 193
-        }
-      ],
-      "outputs": [
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "links": [
-            124
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "links": [
-            125
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "latent_inpaint",
-          "type": "LATENT",
-          "links": [
-            127
-          ],
-          "shape": 3,
-          "slot_index": 2
-        },
-        {
-          "name": "latent_samples",
-          "type": "LATENT",
-          "links": [
-            126
-          ],
-          "shape": 3,
-          "slot_index": 3
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_VAEEncodeInpaintConditioning"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 36,
-      "type": "INPAINT_ApplyFooocusInpaint",
-      "pos": [
-        367,
-        665
-      ],
-      "size": {
-        "0": 191.45639038085938,
-        "1": 66
-      },
-      "flags": {},
-      "order": 9,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 60
-        },
-        {
-          "name": "patch",
-          "type": "INPAINT_PATCH",
-          "link": 62
-        },
-        {
-          "name": "latent",
-          "type": "LATENT",
-          "link": 127
-        }
-      ],
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            120
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_ApplyFooocusInpaint"
-      },
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 35,
-      "type": "INPAINT_LoadFooocusInpaint",
-      "pos": [
-        -11,
-        571
-      ],
-      "size": {
-        "0": 276.6825256347656,
-        "1": 82
-      },
-      "flags": {},
-      "order": 0,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "INPAINT_PATCH",
-          "type": "INPAINT_PATCH",
-          "links": [
-            62
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_LoadFooocusInpaint"
-      },
-      "widgets_values": [
-        "fooocus_inpaint_head.pth",
-        "inpaint_v26.fooocus.patch"
-      ],
-      "color": "#323",
-      "bgcolor": "#535"
-    },
-    {
-      "id": 65,
-      "type": "ImageCompositeMasked",
-      "pos": [
-        870,
-        80
-      ],
-      "size": {
-        "0": 240.56597900390625,
-        "1": 146
-      },
-      "flags": {},
-      "order": 12,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "destination",
-          "type": "IMAGE",
-          "link": 189
-        },
-        {
-          "name": "source",
-          "type": "IMAGE",
-          "link": 156
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 190
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            155
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImageCompositeMasked"
-      },
-      "widgets_values": [
-        0,
-        0,
-        false
-      ]
-    },
-    {
-      "id": 14,
-      "type": "VAEDecode",
-      "pos": [
-        700,
-        180
-      ],
-      "size": {
-        "0": 140,
-        "1": 49.74785232543945
-      },
-      "flags": {},
-      "order": 11,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "samples",
-          "type": "LATENT",
-          "link": 97
-        },
-        {
-          "name": "vae",
-          "type": "VAE",
-          "link": 43
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            156
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "VAEDecode"
-      }
-    },
-    {
-      "id": 67,
-      "type": "ImagePadForOutpaint",
-      "pos": [
-        -127,
-        79
-      ],
-      "size": [
-        238.84862258353508,
-        174
-      ],
-      "flags": {},
-      "order": 3,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 179
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            180,
-            189
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [
-            181,
-            190,
-            193,
-            197
-          ],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "ImagePadForOutpaint"
-      },
-      "widgets_values": [
-        128,
-        0,
-        128,
-        0,
-        40
-      ]
-    },
-    {
-      "id": 59,
-      "type": "SaveImage",
-      "pos": [
-        687,
-        291
-      ],
-      "size": [
-        434.77541218136935,
-        440.62990692496203
-      ],
-      "flags": {},
-      "order": 13,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "images",
-          "type": "IMAGE",
-          "link": 155
-        }
-      ],
-      "properties": {},
-      "widgets_values": [
-        "ComfyUI"
-      ]
-    },
-    {
-      "id": 33,
-      "type": "LoadImage",
-      "pos": [
-        -460,
-        74
-      ],
-      "size": [
-        300.6123144221898,
-        309.42733495308704
-      ],
-      "flags": {},
-      "order": 1,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            179
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "MASK",
-          "type": "MASK",
-          "links": [],
-          "shape": 3,
-          "slot_index": 1
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "LoadImage"
-      },
-      "widgets_values": [
-        "base1024.png",
-        "image"
-      ]
-    },
-    {
-      "id": 19,
-      "type": "CheckpointLoaderSimple",
-      "pos": [
-        -461,
-        662
-      ],
-      "size": [
-        406.4723173048857,
-        98
-      ],
-      "flags": {},
-      "order": 2,
-      "mode": 0,
-      "outputs": [
-        {
-          "name": "MODEL",
-          "type": "MODEL",
-          "links": [
-            60
-          ],
-          "shape": 3,
-          "slot_index": 0
-        },
-        {
-          "name": "CLIP",
-          "type": "CLIP",
-          "links": [
-            35,
-            88
-          ],
-          "shape": 3,
-          "slot_index": 1
-        },
-        {
-          "name": "VAE",
-          "type": "VAE",
-          "links": [
-            43,
-            128
-          ],
-          "shape": 3,
-          "slot_index": 2
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CheckpointLoaderSimple"
-      },
-      "widgets_values": [
-        "juggernautXL_version6Rundiffusion.safetensors"
-      ]
-    },
-    {
-      "id": 9,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -458,
-        419
-      ],
-      "size": {
-        "0": 326.6668701171875,
-        "1": 95.14787292480469
-      },
-      "flags": {},
-      "order": 5,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 88
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            122
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "POSITIVE PROMPT"
-      ],
-      "color": "#232",
-      "bgcolor": "#353"
-    },
-    {
-      "id": 10,
-      "type": "CLIPTextEncode",
-      "pos": [
-        -456,
-        551
-      ],
-      "size": {
-        "0": 321.6668701171875,
-        "1": 76
-      },
-      "flags": {},
-      "order": 4,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "clip",
-          "type": "CLIP",
-          "link": 35
-        }
-      ],
-      "outputs": [
-        {
-          "name": "CONDITIONING",
-          "type": "CONDITIONING",
-          "links": [
-            123
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "CLIPTextEncode"
-      },
-      "widgets_values": [
-        "text, watermark"
-      ],
-      "color": "#322",
-      "bgcolor": "#533"
-    },
-    {
-      "id": 68,
-      "type": "INPAINT_MaskedFill",
-      "pos": [
-        170,
-        170
-      ],
-      "size": [
-        210,
-        102
-      ],
-      "flags": {},
-      "order": 6,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 180
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 181
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            196
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedFill"
-      },
-      "widgets_values": [
-        "navier-stokes",
-        0
-      ]
-    },
-    {
-      "id": 73,
-      "type": "INPAINT_MaskedBlur",
-      "pos": [
-        410,
-        170
-      ],
-      "size": [
-        210,
-        102
-      ],
-      "flags": {},
-      "order": 7,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "image",
-          "type": "IMAGE",
-          "link": 196
-        },
-        {
-          "name": "mask",
-          "type": "MASK",
-          "link": 197
-        }
-      ],
-      "outputs": [
-        {
-          "name": "IMAGE",
-          "type": "IMAGE",
-          "links": [
-            198
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "INPAINT_MaskedBlur"
-      },
-      "widgets_values": [
-        65,
-        0
-      ]
-    },
-    {
-      "id": 40,
-      "type": "KSampler",
-      "pos": [
-        341,
-        348
-      ],
-      "size": {
-        "0": 315,
-        "1": 262
-      },
-      "flags": {},
-      "order": 10,
-      "mode": 0,
-      "inputs": [
-        {
-          "name": "model",
-          "type": "MODEL",
-          "link": 120
-        },
-        {
-          "name": "positive",
-          "type": "CONDITIONING",
-          "link": 124
-        },
-        {
-          "name": "negative",
-          "type": "CONDITIONING",
-          "link": 125
-        },
-        {
-          "name": "latent_image",
-          "type": "LATENT",
-          "link": 126
-        }
-      ],
-      "outputs": [
-        {
-          "name": "LATENT",
-          "type": "LATENT",
-          "links": [
-            97
-          ],
-          "shape": 3,
-          "slot_index": 0
-        }
-      ],
-      "properties": {
-        "Node name for S&R": "KSampler"
-      },
-      "widgets_values": [
-        439968554343941,
-        "randomize",
-        28,
-        6,
-        "dpmpp_2m_sde_gpu",
-        "karras",
-        1
-      ]
-    }
-  ],
-  "links": [
-    [
-      35,
-      19,
-      1,
-      10,
-      0,
-      "CLIP"
-    ],
-    [
-      43,
-      19,
-      2,
-      14,
-      1,
-      "VAE"
-    ],
-    [
-      60,
-      19,
-      0,
-      36,
-      0,
-      "MODEL"
-    ],
-    [
-      62,
-      35,
-      0,
-      36,
-      1,
-      "INPAINT_PATCH"
-    ],
-    [
-      88,
-      19,
-      1,
-      9,
-      0,
-      "CLIP"
-    ],
-    [
-      97,
-      40,
-      0,
-      14,
-      0,
-      "LATENT"
-    ],
-    [
-      120,
-      36,
-      0,
-      40,
-      0,
-      "MODEL"
-    ],
-    [
-      122,
-      9,
-      0,
-      44,
-      0,
-      "CONDITIONING"
-    ],
-    [
-      123,
-      10,
-      0,
-      44,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      124,
-      44,
-      0,
-      40,
-      1,
-      "CONDITIONING"
-    ],
-    [
-      125,
-      44,
-      1,
-      40,
-      2,
-      "CONDITIONING"
-    ],
-    [
-      126,
-      44,
-      3,
-      40,
-      3,
-      "LATENT"
-    ],
-    [
-      127,
-      44,
-      2,
-      36,
-      2,
-      "LATENT"
-    ],
-    [
-      128,
-      19,
-      2,
-      44,
-      2,
-      "VAE"
-    ],
-    [
-      155,
-      65,
-      0,
-      59,
-      0,
-      "IMAGE"
-    ],
-    [
-      156,
-      14,
-      0,
-      65,
-      1,
-      "IMAGE"
-    ],
-    [
-      179,
-      33,
-      0,
-      67,
-      0,
-      "IMAGE"
-    ],
-    [
-      180,
-      67,
-      0,
-      68,
-      0,
-      "IMAGE"
-    ],
-    [
-      181,
-      67,
-      1,
-      68,
-      1,
-      "MASK"
-    ],
-    [
-      189,
-      67,
-      0,
-      65,
-      0,
-      "IMAGE"
-    ],
-    [
-      190,
-      67,
-      1,
-      65,
-      2,
-      "MASK"
-    ],
-    [
-      193,
-      67,
-      1,
-      44,
-      4,
-      "MASK"
-    ],
-    [
-      196,
-      68,
-      0,
-      73,
-      0,
-      "IMAGE"
-    ],
-    [
-      197,
-      67,
-      1,
-      73,
-      1,
-      "MASK"
-    ],
-    [
-      198,
-      73,
-      0,
-      44,
-      3,
-      "IMAGE"
-    ]
-  ],
-  "groups": [],
-  "config": {},
-  "extra": {},
-  "version": 0.4
-}
\ No newline at end of file
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/manager_requirements.txt b/packages/official-plugins/comfyui/src/comfyui/manager_requirements.txt
index 5ef0d3a..2300f0c 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/manager_requirements.txt
+++ b/packages/official-plugins/comfyui/src/comfyui/manager_requirements.txt
@@ -1 +1 @@
-comfyui_manager==4.0.3b5
+comfyui_manager==4.0.3b7
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/nodes.py b/packages/official-plugins/comfyui/src/comfyui/nodes.py
index 3fa5432..7d83ecb 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/nodes.py
+++ b/packages/official-plugins/comfyui/src/comfyui/nodes.py
@@ -343,7 +343,7 @@ class VAEEncode:
     CATEGORY = "latent"
 
     def encode(self, vae, pixels):
-        t = vae.encode(pixels[:,:,:,:3])
+        t = vae.encode(pixels)
         return ({"samples":t}, )
 
 class VAEEncodeTiled:
@@ -361,7 +361,7 @@ class VAEEncodeTiled:
     CATEGORY = "_for_testing"
 
     def encode(self, vae, pixels, tile_size, overlap, temporal_size=64, temporal_overlap=8):
-        t = vae.encode_tiled(pixels[:,:,:,:3], tile_x=tile_size, tile_y=tile_size, overlap=overlap, tile_t=temporal_size, overlap_t=temporal_overlap)
+        t = vae.encode_tiled(pixels, tile_x=tile_size, tile_y=tile_size, overlap=overlap, tile_t=temporal_size, overlap_t=temporal_overlap)
         return ({"samples": t}, )
 
 class VAEEncodeForInpaint:
@@ -970,7 +970,7 @@ class DualCLIPLoader:
     def INPUT_TYPES(s):
         return {"required": { "clip_name1": (folder_paths.get_filename_list("text_encoders"), ),
                               "clip_name2": (folder_paths.get_filename_list("text_encoders"), ),
-                              "type": (["sdxl", "sd3", "flux", "hunyuan_video", "hidream", "hunyuan_image", "hunyuan_video_15", "kandinsky5", "kandinsky5_image"], ),
+                              "type": (["sdxl", "sd3", "flux", "hunyuan_video", "hidream", "hunyuan_image", "hunyuan_video_15", "kandinsky5", "kandinsky5_image", "newbie"], ),
                               },
                 "optional": {
                               "device": (["default", "cpu"], {"advanced": True}),
@@ -980,7 +980,7 @@ class DualCLIPLoader:
 
     CATEGORY = "advanced/loaders"
 
-    DESCRIPTION = "[Recipes]\n\nsdxl: clip-l, clip-g\nsd3: clip-l, clip-g / clip-l, t5 / clip-g, t5\nflux: clip-l, t5\nhidream: at least one of t5 or llama, recommended t5 and llama\nhunyuan_image: qwen2.5vl 7b and byt5 small"
+    DESCRIPTION = "[Recipes]\n\nsdxl: clip-l, clip-g\nsd3: clip-l, clip-g / clip-l, t5 / clip-g, t5\nflux: clip-l, t5\nhidream: at least one of t5 or llama, recommended t5 and llama\nhunyuan_image: qwen2.5vl 7b and byt5 small\nnewbie: gemma-3-4b-it, jina clip v2"
 
     def load_clip(self, clip_name1, clip_name2, type, device="default"):
         clip_type = getattr(comfy.sd.CLIPType, type.upper(), comfy.sd.CLIPType.STABLE_DIFFUSION)
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/requirements.txt b/packages/official-plugins/comfyui/src/comfyui/requirements.txt
index 9b9e616..5469639 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/requirements.txt
+++ b/packages/official-plugins/comfyui/src/comfyui/requirements.txt
@@ -1,5 +1,5 @@
 comfyui-frontend-package==1.34.9
-comfyui-workflow-templates==0.7.59
+comfyui-workflow-templates==0.7.60
 comfyui-embedded-docs==0.3.1
 torch
 torchsde
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/server.py b/packages/official-plugins/comfyui/src/comfyui/server.py
index ac4f422..c27f8be 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/server.py
+++ b/packages/official-plugins/comfyui/src/comfyui/server.py
@@ -7,6 +7,7 @@ import time
 import nodes
 import folder_paths
 import execution
+from comfy_execution.jobs import JobStatus, get_job, get_all_jobs
 import uuid
 import urllib
 import json
@@ -47,6 +48,12 @@ from middleware.cache_middleware import cache_control
 if args.enable_manager:
     import comfyui_manager
 
+
+def _remove_sensitive_from_queue(queue: list) -> list:
+    """Remove sensitive data (index 5) from queue item tuples."""
+    return [item[:5] for item in queue]
+
+
 async def send_socket_catch_exception(function, message):
     try:
         await function(message)
@@ -694,6 +701,129 @@ class PromptServer():
                 out[node_class] = node_info(node_class)
             return web.json_response(out)
 
+        @routes.get("/api/jobs")
+        async def get_jobs(request):
+            """List all jobs with filtering, sorting, and pagination.
+
+            Query parameters:
+                status: Filter by status (comma-separated): pending, in_progress, completed, failed
+                workflow_id: Filter by workflow ID
+                sort_by: Sort field: created_at (default), execution_duration
+                sort_order: Sort direction: asc, desc (default)
+                limit: Max items to return (positive integer)
+                offset: Items to skip (non-negative integer, default 0)
+            """
+            query = request.rel_url.query
+
+            status_param = query.get('status')
+            workflow_id = query.get('workflow_id')
+            sort_by = query.get('sort_by', 'created_at').lower()
+            sort_order = query.get('sort_order', 'desc').lower()
+
+            status_filter = None
+            if status_param:
+                status_filter = [s.strip().lower() for s in status_param.split(',') if s.strip()]
+                invalid_statuses = [s for s in status_filter if s not in JobStatus.ALL]
+                if invalid_statuses:
+                    return web.json_response(
+                        {"error": f"Invalid status value(s): {', '.join(invalid_statuses)}. Valid values: {', '.join(JobStatus.ALL)}"},
+                        status=400
+                    )
+
+            if sort_by not in {'created_at', 'execution_duration'}:
+                return web.json_response(
+                    {"error": "sort_by must be 'created_at' or 'execution_duration'"},
+                    status=400
+                )
+
+            if sort_order not in {'asc', 'desc'}:
+                return web.json_response(
+                    {"error": "sort_order must be 'asc' or 'desc'"},
+                    status=400
+                )
+
+            limit = None
+
+            # If limit is provided, validate that it is a positive integer, else continue without a limit
+            if 'limit' in query:
+                try:
+                    limit = int(query.get('limit'))
+                    if limit <= 0:
+                        return web.json_response(
+                            {"error": "limit must be a positive integer"},
+                            status=400
+                        )
+                except (ValueError, TypeError):
+                    return web.json_response(
+                        {"error": "limit must be an integer"},
+                        status=400
+                    )
+
+            offset = 0
+            if 'offset' in query:
+                try:
+                    offset = int(query.get('offset'))
+                    if offset < 0:
+                        offset = 0
+                except (ValueError, TypeError):
+                    return web.json_response(
+                        {"error": "offset must be an integer"},
+                        status=400
+                    )
+
+            running, queued = self.prompt_queue.get_current_queue_volatile()
+            history = self.prompt_queue.get_history()
+
+            running = _remove_sensitive_from_queue(running)
+            queued = _remove_sensitive_from_queue(queued)
+
+            jobs, total = get_all_jobs(
+                running, queued, history,
+                status_filter=status_filter,
+                workflow_id=workflow_id,
+                sort_by=sort_by,
+                sort_order=sort_order,
+                limit=limit,
+                offset=offset
+            )
+
+            has_more = (offset + len(jobs)) < total
+
+            return web.json_response({
+                'jobs': jobs,
+                'pagination': {
+                    'offset': offset,
+                    'limit': limit,
+                    'total': total,
+                    'has_more': has_more
+                }
+            })
+
+        @routes.get("/api/jobs/{job_id}")
+        async def get_job_by_id(request):
+            """Get a single job by ID."""
+            job_id = request.match_info.get("job_id", None)
+            if not job_id:
+                return web.json_response(
+                    {"error": "job_id is required"},
+                    status=400
+                )
+
+            running, queued = self.prompt_queue.get_current_queue_volatile()
+            history = self.prompt_queue.get_history(prompt_id=job_id)
+
+            running = _remove_sensitive_from_queue(running)
+            queued = _remove_sensitive_from_queue(queued)
+
+            job = get_job(job_id, running, queued, history)
+            if job is None:
+                return web.json_response(
+                    {"error": "Job not found"},
+                    status=404
+                )
+
+            return web.json_response(job)
+
         @routes.get("/history")
         async def get_history(request):
             max_items = request.rel_url.query.get("max_items", None)
@@ -717,9 +847,8 @@ class PromptServer():
         async def get_queue(request):
             queue_info = {}
             current_queue = self.prompt_queue.get_current_queue_volatile()
-            remove_sensitive = lambda queue: [x[:5] for x in queue]
-            queue_info['queue_running'] = remove_sensitive(current_queue[0])
-            queue_info['queue_pending'] = remove_sensitive(current_queue[1])
+            queue_info['queue_running'] = _remove_sensitive_from_queue(current_queue[0])
+            queue_info['queue_pending'] = _remove_sensitive_from_queue(current_queue[1])
             return web.json_response(queue_info)
 
         @routes.post("/prompt")
diff --git a/packages/official-plugins/comfyui/src/local_overrides/comfyui/tests/execution/test_execution.py b/packages/official-plugins/comfyui/src/comfyui/tests/execution/test_execution.py
index ace0d22..f73ca7e 100644
--- a/packages/official-plugins/comfyui/src/local_overrides/comfyui/tests/execution/test_execution.py
+++ b/packages/official-plugins/comfyui/src/comfyui/tests/execution/test_execution.py
@@ -99,6 +99,37 @@ class ComfyClient:
         with urllib.request.urlopen(url) as response:
             return json.loads(response.read())
 
+    def get_jobs(self, status=None, limit=None, offset=None, sort_by=None, sort_order=None):
+        url = "http://{}/api/jobs".format(self.server_address)
+        params = {}
+        if status is not None:
+            params["status"] = status
+        if limit is not None:
+            params["limit"] = limit
+        if offset is not None:
+            params["offset"] = offset
+        if sort_by is not None:
+            params["sort_by"] = sort_by
+        if sort_order is not None:
+            params["sort_order"] = sort_order
+
+        if params:
+            url_values = urllib.parse.urlencode(params)
+            url = "{}?{}".format(url, url_values)
+
+        with urllib.request.urlopen(url) as response:
+            return json.loads(response.read())
+
+    def get_job(self, job_id):
+        url = "http://{}/api/jobs/{}".format(self.server_address, job_id)
+        try:
+            with urllib.request.urlopen(url) as response:
+                return json.loads(response.read())
+        except urllib.error.HTTPError as e:
+            if e.code == 404:
+                return None
+            raise
+
     def set_test_name(self, name):
         self.test_name = name
 
@@ -877,3 +908,106 @@ class TestExecution:
         result = client.get_all_history(max_items=5, offset=len(all_history) - 1)
 
         assert len(result) <= 1, "Should return at most 1 item when offset is near end"
+
+    # Jobs API tests
+    def test_jobs_api_job_structure(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test that job objects have required fields"""
+        self._create_history_item(client, builder)
+
+        jobs_response = client.get_jobs(status="completed", limit=1)
+        assert len(jobs_response["jobs"]) > 0, "Should have at least one job"
+
+        job = jobs_response["jobs"][0]
+        assert "id" in job, "Job should have id"
+        assert "status" in job, "Job should have status"
+        assert "create_time" in job, "Job should have create_time"
+        assert "outputs_count" in job, "Job should have outputs_count"
+        assert "preview_output" in job, "Job should have preview_output"
+
+    def test_jobs_api_preview_output_structure(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test that preview_output has correct structure"""
+        self._create_history_item(client, builder)
+
+        jobs_response = client.get_jobs(status="completed", limit=1)
+        job = jobs_response["jobs"][0]
+
+        if job["preview_output"] is not None:
+            preview = job["preview_output"]
+            assert "filename" in preview, "Preview should have filename"
+            assert "nodeId" in preview, "Preview should have nodeId"
+            assert "mediaType" in preview, "Preview should have mediaType"
+
+    def test_jobs_api_pagination(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test jobs API pagination"""
+        for _ in range(5):
+            self._create_history_item(client, builder)
+
+        first_page = client.get_jobs(limit=2, offset=0)
+        second_page = client.get_jobs(limit=2, offset=2)
+
+        assert len(first_page["jobs"]) <= 2, "First page should have at most 2 jobs"
+        assert len(second_page["jobs"]) <= 2, "Second page should have at most 2 jobs"
+
+        first_ids = {j["id"] for j in first_page["jobs"]}
+        second_ids = {j["id"] for j in second_page["jobs"]}
+        assert first_ids.isdisjoint(second_ids), "Pages should have different jobs"
+
+    def test_jobs_api_sorting(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test jobs API sorting"""
+        for _ in range(3):
+            self._create_history_item(client, builder)
+
+        desc_jobs = client.get_jobs(sort_order="desc")
+        asc_jobs = client.get_jobs(sort_order="asc")
+
+        if len(desc_jobs["jobs"]) >= 2:
+            desc_times = [j["create_time"] for j in desc_jobs["jobs"] if j["create_time"]]
+            asc_times = [j["create_time"] for j in asc_jobs["jobs"] if j["create_time"]]
+            if len(desc_times) >= 2:
+                assert desc_times == sorted(desc_times, reverse=True), "Desc should be newest first"
+            if len(asc_times) >= 2:
+                assert asc_times == sorted(asc_times), "Asc should be oldest first"
+
+    def test_jobs_api_status_filter(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test jobs API status filtering"""
+        self._create_history_item(client, builder)
+
+        completed_jobs = client.get_jobs(status="completed")
+        assert len(completed_jobs["jobs"]) > 0, "Should have completed jobs from history"
+
+        for job in completed_jobs["jobs"]:
+            assert job["status"] == "completed", "Should only return completed jobs"
+
+        # Pending jobs are transient - just verify filter doesn't error
+        pending_jobs = client.get_jobs(status="pending")
+        for job in pending_jobs["jobs"]:
+            assert job["status"] == "pending", "Should only return pending jobs"
+
+    def test_get_job_by_id(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test getting a single job by ID"""
+        result = self._create_history_item(client, builder)
+        prompt_id = result.get_prompt_id()
+
+        job = client.get_job(prompt_id)
+        assert job is not None, "Should find the job"
+        assert job["id"] == prompt_id, "Job ID should match"
+        assert "outputs" in job, "Single job should include outputs"
+
+    def test_get_job_not_found(
+        self, client: ComfyClient, builder: GraphBuilder
+    ):
+        """Test getting a non-existent job returns 404"""
+        job = client.get_job("nonexistent-job-id")
+        assert job is None, "Non-existent job should return None"
diff --git a/packages/official-plugins/comfyui/src/comfyui/tests/execution/test_jobs.py b/packages/official-plugins/comfyui/src/comfyui/tests/execution/test_jobs.py
new file mode 100644
index 0000000..918c808
--- /dev/null
+++ b/packages/official-plugins/comfyui/src/comfyui/tests/execution/test_jobs.py
@@ -0,0 +1,361 @@
+"""Unit tests for comfy_execution/jobs.py"""
+
+from comfy_execution.jobs import (
+    JobStatus,
+    is_previewable,
+    normalize_queue_item,
+    normalize_history_item,
+    get_outputs_summary,
+    apply_sorting,
+)
+
+
+class TestJobStatus:
+    """Test JobStatus constants."""
+
+    def test_status_values(self):
+        """Status constants should have expected string values."""
+        assert JobStatus.PENDING == 'pending'
+        assert JobStatus.IN_PROGRESS == 'in_progress'
+        assert JobStatus.COMPLETED == 'completed'
+        assert JobStatus.FAILED == 'failed'
+
+    def test_all_contains_all_statuses(self):
+        """ALL should contain all status values."""
+        assert JobStatus.PENDING in JobStatus.ALL
+        assert JobStatus.IN_PROGRESS in JobStatus.ALL
+        assert JobStatus.COMPLETED in JobStatus.ALL
+        assert JobStatus.FAILED in JobStatus.ALL
+        assert len(JobStatus.ALL) == 4
+
+
+class TestIsPreviewable:
+    """Unit tests for is_previewable()"""
+
+    def test_previewable_media_types(self):
+        """Images, video, audio media types should be previewable."""
+        for media_type in ['images', 'video', 'audio']:
+            assert is_previewable(media_type, {}) is True
+
+    def test_non_previewable_media_types(self):
+        """Other media types should not be previewable."""
+        for media_type in ['latents', 'text', 'metadata', 'files']:
+            assert is_previewable(media_type, {}) is False
+
+    def test_3d_extensions_previewable(self):
+        """3D file extensions should be previewable regardless of media_type."""
+        for ext in ['.obj', '.fbx', '.gltf', '.glb']:
+            item = {'filename': f'model{ext}'}
+            assert is_previewable('files', item) is True
+
+    def test_3d_extensions_case_insensitive(self):
+        """3D extension check should be case insensitive."""
+        item = {'filename': 'MODEL.GLB'}
+        assert is_previewable('files', item) is True
+
+    def test_video_format_previewable(self):
+        """Items with video/ format should be previewable."""
+        item = {'format': 'video/mp4'}
+        assert is_previewable('files', item) is True
+
+    def test_audio_format_previewable(self):
+        """Items with audio/ format should be previewable."""
+        item = {'format': 'audio/wav'}
+        assert is_previewable('files', item) is True
+
+    def test_other_format_not_previewable(self):
+        """Items with other format should not be previewable."""
+        item = {'format': 'application/json'}
+        assert is_previewable('files', item) is False
+
+
+class TestGetOutputsSummary:
+    """Unit tests for get_outputs_summary()"""
+
+    def test_empty_outputs(self):
+        """Empty outputs should return 0 count and None preview."""
+        count, preview = get_outputs_summary({})
+        assert count == 0
+        assert preview is None
+
+    def test_counts_across_multiple_nodes(self):
+        """Outputs from multiple nodes should all be counted."""
+        outputs = {
+            'node1': {'images': [{'filename': 'a.png', 'type': 'output'}]},
+            'node2': {'images': [{'filename': 'b.png', 'type': 'output'}]},
+            'node3': {'images': [
+                {'filename': 'c.png', 'type': 'output'},
+                {'filename': 'd.png', 'type': 'output'}
+            ]}
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert count == 4
+
+    def test_skips_animated_key_and_non_list_values(self):
+        """The 'animated' key and non-list values should be skipped."""
+        outputs = {
+            'node1': {
+                'images': [{'filename': 'test.png', 'type': 'output'}],
+                'animated': [True],  # Should skip due to key name
+                'metadata': 'string',  # Should skip due to non-list
+                'count': 42  # Should skip due to non-list
+            }
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert count == 1
+
+    def test_preview_prefers_type_output(self):
+        """Items with type='output' should be preferred for preview."""
+        outputs = {
+            'node1': {
+                'images': [
+                    {'filename': 'temp.png', 'type': 'temp'},
+                    {'filename': 'output.png', 'type': 'output'}
+                ]
+            }
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert count == 2
+        assert preview['filename'] == 'output.png'
+
+    def test_preview_fallback_when_no_output_type(self):
+        """If no type='output', should use first previewable."""
+        outputs = {
+            'node1': {
+                'images': [
+                    {'filename': 'temp1.png', 'type': 'temp'},
+                    {'filename': 'temp2.png', 'type': 'temp'}
+                ]
+            }
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert preview['filename'] == 'temp1.png'
+
+    def test_non_previewable_media_types_counted_but_no_preview(self):
+        """Non-previewable media types should be counted but not used as preview."""
+        outputs = {
+            'node1': {
+                'latents': [
+                    {'filename': 'latent1.safetensors'},
+                    {'filename': 'latent2.safetensors'}
+                ]
+            }
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert count == 2
+        assert preview is None
+
+    def test_previewable_media_types(self):
+        """Images, video, and audio media types should be previewable."""
+        for media_type in ['images', 'video', 'audio']:
+            outputs = {
+                'node1': {
+                    media_type: [{'filename': 'test.file', 'type': 'output'}]
+                }
+            }
+            count, preview = get_outputs_summary(outputs)
+            assert preview is not None, f"{media_type} should be previewable"
+
+    def test_3d_files_previewable(self):
+        """3D file extensions should be previewable."""
+        for ext in ['.obj', '.fbx', '.gltf', '.glb']:
+            outputs = {
+                'node1': {
+                    'files': [{'filename': f'model{ext}', 'type': 'output'}]
+                }
+            }
+            count, preview = get_outputs_summary(outputs)
+            assert preview is not None, f"3D file {ext} should be previewable"
+
+    def test_format_mime_type_previewable(self):
+        """Files with video/ or audio/ format should be previewable."""
+        for fmt in ['video/x-custom', 'audio/x-custom']:
+            outputs = {
+                'node1': {
+                    'files': [{'filename': 'file.custom', 'format': fmt, 'type': 'output'}]
+                }
+            }
+            count, preview = get_outputs_summary(outputs)
+            assert preview is not None, f"Format {fmt} should be previewable"
+
+    def test_preview_enriched_with_node_metadata(self):
+        """Preview should include nodeId, mediaType, and original fields."""
+        outputs = {
+            'node123': {
+                'images': [{'filename': 'test.png', 'type': 'output', 'subfolder': 'outputs'}]
+            }
+        }
+        count, preview = get_outputs_summary(outputs)
+        assert preview['nodeId'] == 'node123'
+        assert preview['mediaType'] == 'images'
+        assert preview['subfolder'] == 'outputs'
+
+
+class TestApplySorting:
+    """Unit tests for apply_sorting()"""
+
+    def test_sort_by_create_time_desc(self):
+        """Default sort by create_time descending."""
+        jobs = [
+            {'id': 'a', 'create_time': 100},
+            {'id': 'b', 'create_time': 300},
+            {'id': 'c', 'create_time': 200},
+        ]
+        result = apply_sorting(jobs, 'created_at', 'desc')
+        assert [j['id'] for j in result] == ['b', 'c', 'a']
+
+    def test_sort_by_create_time_asc(self):
+        """Sort by create_time ascending."""
+        jobs = [
+            {'id': 'a', 'create_time': 100},
+            {'id': 'b', 'create_time': 300},
+            {'id': 'c', 'create_time': 200},
+        ]
+        result = apply_sorting(jobs, 'created_at', 'asc')
+        assert [j['id'] for j in result] == ['a', 'c', 'b']
+
+    def test_sort_by_execution_duration(self):
+        """Sort by execution_duration should order by duration."""
+        jobs = [
+            {'id': 'a', 'create_time': 100, 'execution_start_time': 100, 'execution_end_time': 5100},  # 5s
+            {'id': 'b', 'create_time': 300, 'execution_start_time': 300, 'execution_end_time': 1300},  # 1s
+            {'id': 'c', 'create_time': 200, 'execution_start_time': 200, 'execution_end_time': 3200},  # 3s
+        ]
+        result = apply_sorting(jobs, 'execution_duration', 'desc')
+        assert [j['id'] for j in result] == ['a', 'c', 'b']
+
+    def test_sort_with_none_values(self):
+        """Jobs with None values should sort as 0."""
+        jobs = [
+            {'id': 'a', 'create_time': 100, 'execution_start_time': 100, 'execution_end_time': 5100},
+            {'id': 'b', 'create_time': 300, 'execution_start_time': None, 'execution_end_time': None},
+            {'id': 'c', 'create_time': 200, 'execution_start_time': 200, 'execution_end_time': 3200},
+        ]
+        result = apply_sorting(jobs, 'execution_duration', 'asc')
+        assert result[0]['id'] == 'b'  # None treated as 0, comes first
+
+
+class TestNormalizeQueueItem:
+    """Unit tests for normalize_queue_item()"""
+
+    def test_basic_normalization(self):
+        """Queue item should be normalized to job dict."""
+        item = (
+            10,  # priority/number
+            'prompt-123',  # prompt_id
+            {'nodes': {}},  # prompt
+            {
+                'create_time': 1234567890,
+                'extra_pnginfo': {'workflow': {'id': 'workflow-abc'}}
+            },  # extra_data
+            ['node1'],  # outputs_to_execute
+        )
+        job = normalize_queue_item(item, JobStatus.PENDING)
+
+        assert job['id'] == 'prompt-123'
+        assert job['status'] == 'pending'
+        assert job['priority'] == 10
+        assert job['create_time'] == 1234567890
+        assert 'execution_start_time' not in job
+        assert 'execution_end_time' not in job
+        assert 'execution_error' not in job
+        assert 'preview_output' not in job
+        assert job['outputs_count'] == 0
+        assert job['workflow_id'] == 'workflow-abc'
+
+
+class TestNormalizeHistoryItem:
+    """Unit tests for normalize_history_item()"""
+
+    def test_completed_job(self):
+        """Completed history item should have correct status and times from messages."""
+        history_item = {
+            'prompt': (
+                5,  # priority
+                'prompt-456',
+                {'nodes': {}},
+                {
+                    'create_time': 1234567890000,
+                    'extra_pnginfo': {'workflow': {'id': 'workflow-xyz'}}
+                },
+                ['node1'],
+            ),
+            'status': {
+                'status_str': 'success',
+                'completed': True,
+                'messages': [
+                    ('execution_start', {'prompt_id': 'prompt-456', 'timestamp': 1234567890500}),
+                    ('execution_success', {'prompt_id': 'prompt-456', 'timestamp': 1234567893000}),
+                ]
+            },
+            'outputs': {},
+        }
+        job = normalize_history_item('prompt-456', history_item)
+
+        assert job['id'] == 'prompt-456'
+        assert job['status'] == 'completed'
+        assert job['priority'] == 5
+        assert job['execution_start_time'] == 1234567890500
+        assert job['execution_end_time'] == 1234567893000
+        assert job['workflow_id'] == 'workflow-xyz'
+
+    def test_failed_job(self):
+        """Failed history item should have failed status and error from messages."""
+        history_item = {
+            'prompt': (
+                5,
+                'prompt-789',
+                {'nodes': {}},
+                {'create_time': 1234567890000},
+                ['node1'],
+            ),
+            'status': {
+                'status_str': 'error',
+                'completed': False,
+                'messages': [
+                    ('execution_start', {'prompt_id': 'prompt-789', 'timestamp': 1234567890500}),
+                    ('execution_error', {
+                        'prompt_id': 'prompt-789',
+                        'node_id': '5',
+                        'node_type': 'KSampler',
+                        'exception_message': 'CUDA out of memory',
+                        'exception_type': 'RuntimeError',
+                        'traceback': ['Traceback...', 'RuntimeError: CUDA out of memory'],
+                        'timestamp': 1234567891000,
+                    })
+                ]
+            },
+            'outputs': {},
+        }
+
+        job = normalize_history_item('prompt-789', history_item)
+        assert job['status'] == 'failed'
+        assert job['execution_start_time'] == 1234567890500
+        assert job['execution_end_time'] == 1234567891000
+        assert job['execution_error']['node_id'] == '5'
+        assert job['execution_error']['node_type'] == 'KSampler'
+        assert job['execution_error']['exception_message'] == 'CUDA out of memory'
+
+    def test_include_outputs(self):
+        """When include_outputs=True, should include full output data."""
+        history_item = {
+            'prompt': (
+                5,
+                'prompt-123',
+                {'nodes': {'1': {}}},
+                {'create_time': 1234567890, 'client_id': 'abc'},
+                ['node1'],
+            ),
+            'status': {'status_str': 'success', 'completed': True, 'messages': []},
+            'outputs': {'node1': {'images': [{'filename': 'test.png'}]}},
+        }
+        job = normalize_history_item('prompt-123', history_item, include_outputs=True)
+
+        assert 'outputs' in job
+        assert 'workflow' in job
+        assert 'execution_status' in job
+        assert job['outputs'] == {'node1': {'images': [{'filename': 'test.png'}]}}
+        assert job['workflow'] == {
+            'prompt': {'nodes': {'1': {}}},
+            'extra_data': {'create_time': 1234567890, 'client_id': 'abc'},
+        }
